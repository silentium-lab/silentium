const t=t=>null!=t;function e(t){return null!==t&&"object"==typeof t&&"then"in t&&"function"==typeof t.then}function n(t){return null!==t&&"object"==typeof t&&"use"in t&&"function"==typeof t.use}function r(t){return null!==t&&"object"==typeof t&&"destroy"in t&&"function"==typeof t.destroy}function s(t){return null!==t&&"object"==typeof t&&"destroyed"in t&&"function"==typeof t.destroyed}function o(t){return new c(t)}class c{constructor(t){this.base=t}destroy(){return r(this.base)&&this.base.destroy(),"function"==typeof this.base&&this.base(),this}}var i=Object.defineProperty,u=(t,e,n)=>((t,e,n)=>e in t?i(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n);function h(){return new a}class a{constructor(){u(this,"destructors",[]),u(this,"_destroyed",!1)}add(t){return this.destructors.push(o(t)),t}many(t){return t.forEach((t=>{this.add(t)})),this}destroy(){return this._destroyed=!0,this.destructors.forEach((t=>t.destroy())),this.destructors.length=0,this}destroyed(){return this._destroyed}destructor(){return this.destroy.bind(this)}}var l=Object.defineProperty,f=(t,e,n)=>((t,e,n)=>e in t?l(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n);class d{constructor(){f(this,"catchers",[]),f(this,"lastRejectReason",null),f(this,"reject",(t=>{this.lastRejectReason=t,this.catchers.forEach((e=>{e(t)}))}))}catch(t){return null!==this.lastRejectReason&&t(this.lastRejectReason),this.catchers.push(t),this}destroy(){return this.catchers.length=0,this}}const y=Symbol("reset-silence-cache");function b(e){let n;return r=>{r===y&&(n=void 0,r=void 0),t(r)&&r!==n&&(n=r,e(r))}}function p(t,e){if("function"!=typeof t)throw new Error(`${e}: is not function`)}function v(t,n){if(!e(t))throw new Error(`${n}: is not message`)}var m=Object.defineProperty,w=(t,e,n)=>((t,e,n)=>e in t?m(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n);function g(t){return new j(t)}class j{constructor(t){this.executor=t,w(this,"rejections",new d),w(this,"dc",h()),p(t,"Message: executor")}then(t){if(this.dc.destroyed())return this;try{this.dc.add(this.executor(b(t),this.rejections.reject))}catch(t){this.rejections.reject(t)}return this}catch(t){return this.dc.destroyed()||this.rejections.catch(t),this}destroy(){return this.dc.destroy(),this.rejections.destroy(),this}}function E(t){return g((function(e){e(t)}))}function x(t){return e(t)?t:E(t)}function R(...t){const e=h();return e.many(t),g(((n,r)=>(t[0].catch(r).then(n),t.slice(1).forEach((t=>{t.catch(r)})),e.destructor())))}function $(t){const e=x(t);return g((function(t,n){let r=!1;return e.then((e=>{r||t(e)})),e.catch(n),()=>{r=!0}}))}var P=Object.defineProperty,V=(t,e,n)=>((t,e,n)=>e in t?P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,e+"",n);function O(t,e){return new k(t,e)}class k{constructor(t,e){this.sourceExecutor=e,V(this,"message"),this.message=g(t)}use(t){return this.sourceExecutor(t),this}then(t){return this.message.then(t),this}catch(t){return this.message.catch(t),this}destroy(){return this.message.destroy(),this}chain(t){return t.then(this.use.bind(this)),this}}function S(t){return g((function(e){e(t())}))}function T(){return()=>{}}function z(...t){const e=t.map(x);return g((function(n,r){const s=new Set(Object.keys(t)),o=new Set,c=[];0!==s.size?e.map(((t,e)=>{t.catch(r),t.then((t=>{var r,i;o.add(e.toString()),c[e]=t,i=s,(r=o).size>0&&r.size===i.size&&n(c.slice())}))})):n([])}))}function C(...t){const e=t.map(x);return g((function(t,n){e.forEach((e=>{e.catch(n),e.then(t)}))}))}function D(t,n){const r=x(t);return g((function(t,s){const o=h();r.catch(s),r.then((r=>{const c=n(r);e(c)?(o.destroy(),o.add(c),c.catch(s).then(t)):t(c)}))}))}function M(t,e){return D(t,(function(t){return e(...t)}))}var W=Object.defineProperty,_=(t,e,n)=>((t,e,n)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,e+"",n);function J(t,e=null){return new L(t,e)}class L{constructor(t,e=null){this.$base=t,this.theValue=e,_(this,"touched",!1)}ensureTouched(){this.touched||this.$base.then((t=>{this.theValue=t})),this.touched=!0}[Symbol.toPrimitive](){return this.ensureTouched(),this.theValue}primitive(){return this.ensureTouched(),this.theValue}primitiveWithException(){if(this.ensureTouched(),null===this.theValue)throw new Error("Primitive value is null");return this.theValue}}var N=Object.defineProperty,q=(t,e,n)=>((t,e,n)=>e in t?N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n);function A(t){return new B(t)}class B{constructor(t){this.$base=t,q(this,"resolver",(t=>{this.lastV=t,this.resolvers.forEach((e=>{e(t)}))})),q(this,"lastV"),q(this,"resolvers",new Set),q(this,"source"),n(t)&&(this.source=t)}then(e){return this.resolvers.add((t=>e(t))),1===this.resolvers.size?this.$base.then(this.resolver):t(this.lastV)&&e(this.lastV),this}use(t){return this.source?this.source.use(t):this.resolver(t),this}catch(t){return this.$base.catch(t),this}destroy(){return this.resolvers.clear(),r(this.$base)&&this.$base.destroy(),this}value(){return J(this)}chain(t){return t.then(this.use.bind(this)),this}}var F=Object.defineProperty,G=(t,e,n)=>((t,e,n)=>e in t?F(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n);function H(t){return A(new I(t))}class I{constructor(e){this.v=e,G(this,"rejections",new d),G(this,"lateR",null),G(this,"notify",(()=>{if(t(this.v)&&this.lateR)try{this.lateR(this.v)}catch(t){this.rejections.reject(t)}}))}then(t){if(this.lateR)throw new Error("Late component gets new resolver, when another was already connected!");return this.lateR=b(t),this.notify(),this}use(t){return this.v=t,this.notify(),this}catch(t){return this.rejections.catch(t),this}chain(t){return t.then(this.use.bind(this)),this}}function K(t){const e=new d;t.catch(e.reject);const n=H();return e.catch((t=>{n.use(t)})),n}function Q(...t){const e=t.map(x);return g((function(t,n){let r;const s=o=>{const c=e[o];c.catch(n);const i=e[o+1];c.then((e=>{!function(e,n,o){n||(r=e);r&&t(r);n&&!r&&s(o+1)}(e,i,o)}))};s(0)}))}function U(t,...e){return M(z(...e),t)}function X(t,e={}){const n=M(z(x(t),x(e)),((t,e)=>({transport:t,params:e,result:void 0,error:void 0})));return O(((t,e)=>{n.then((n=>{const r=X.transport.get(n.transport);if(void 0===r)throw new Error(`Context: unknown transport ${n.transport}`);n.result||(n.result=t),n.error||(n.error=e);try{r(n)}catch(t){e(t)}}))}),(t=>{const e=J(n).primitive();if(null===e)throw new Error("Context: sourcing impossible message not existed");const r=X.transport.get(e.transport);if(void 0===r)throw new Error(`Context: sourcing unknown transport ${e.transport}`);r({...e,value:t})}))}function Y(t){const e=x(t);return r=>{if(r.value&&n(t))t.use(r.value);else{if(!r.result)throw new Error("ContextChain did not find result field in message");e.then(r.result)}}}function Z(t){const e=H();return X.transport.set(t,e.use.bind(e)),g(((t,n)=>{e.catch(n),e.then(t)}))}function tt(t,e){const n=x(e),r=D(K(t),(()=>n));return g((e=>{t.then(e),r.then(e)}))}function et(t,e){const n=J(t);return g(((r,s)=>{try{t.then(r).catch(s),e||n.primitiveWithException(),e?.then((()=>{s("Empty: no value after message!")}))}catch{s("Empty: no value in base message!")}}))}function nt(t,e){return g((function(n,r){t.catch(r),t.then(e(n))}))}function rt(t,e,n){const r=x(t);return g((function(t,s){r.catch(s),r.then((r=>{e(r)?t(r):void 0!==n&&t(n)}))}))}function st(t,e,n){return U(((t,n)=>t.reduce(e,n)),x(t),x(n))}function ot(t,e){let n=null;return g((function(r,s){t.catch(s),t.then((t=>{null===n&&(n=t),r(n)})),e?.then((()=>{n=null}))}))}function ct(t,e,n,r){const s=x(t),o=x(e),c=x(n),i=x(r);return g(((t,e)=>{s.catch(e),o.catch(e),c.catch(e),i.catch(e);let n=null;const r=t=>{n&&n(t)};return z(s,o,c).then((([e,s,o])=>{n=t,e?.[o]&&e[o](s,r)})),()=>{n=null,i&&z(s,o,i).then((([t,e,n])=>{t?.[n]?.(e,r)}))}}))}function it(t){return g(((e,n)=>{const s=t();return s.catch(n).then(e),()=>{r(s)&&s.destroy()}}))}function ut(t,n){const r=x(t);return g(((t,s)=>{r.catch(s);const o=[],c=h();r.then((r=>{o.length=0,c.destroy(),r.forEach((t=>{let r=t;e(r)||(r=E(r));const s=n(r);c.add(s),o.push(s)})),z(...o).then(t)}))}))}function ht(t){return g(((e,n)=>{let r=!1;t.catch(n),t.then((t=>{r||(r=!0,e(t))}))}))}function at(t,...e){return e.reduce(((t,e)=>x(e(t))),x(t))}function lt(t,e){return g(((n,r)=>{const s=H(),o=h();return t.then((t=>{o.destroy();const n=e(t);o.add(n),s.chain(n),n.catch(r)})),t.catch(r),s.then(n),()=>{o.destroy()}}))}function ft(...t){const e=t.map(x);return g(((t,n)=>{let r=!1;e.forEach((e=>{e.catch(n).then((e=>{!1===r&&(r=!0,t(e))}))}))}))}function dt(t){return g(((e,n)=>{const r=[];t.catch(n),t.then((t=>{r.push(t),e(r.slice())}))}))}function yt(t){const e=x(t);return g(((t,n)=>{e.catch(n),e.then((e=>{e.forEach((e=>{t(e)}))}))}))}function bt(t,n){return X("trackable",{name:t,action:"created"}).then((()=>{})),e(n)&&n.then((e=>{X("trackable",{name:t,action:"value",value:e}).then((()=>{}))})),new Proxy(n,{get:(e,n,r)=>("then"===n&&X("trackable",{name:t,action:"executed"}).then((()=>{})),"destroy"===n&&X("trackable",{name:t,action:"destroyed"}).then((()=>{})),Reflect.get(e,n,r))})}function pt(t){const e=J(t);return new Proxy(t,{get:(t,n,r)=>"value"===n?e.primitive():Reflect.get(t,n,r)})}X.transport=new Map;const vt=(...t)=>{D(z(...t.map((t=>A(t)))),JSON.stringify).then(console.log)},mt=t=>J(t).primitive();class wt{constructor(t){this.onDestroy=t}then(t){return t(`Wait destroy ${Date.now()}`),this}catch(){return this}destroy(){return this.onDestroy(),this}}const gt=t=>new wt(t);function jt(){"undefined"!=typeof globalThis&&(globalThis.silentiumDebug={value:mt,print:vt,destroyable:gt})}export{x as Actual,z as All,C as Any,D as Applied,K as Catch,Q as Chain,U as Computed,R as Connected,X as Context,Y as ContextChain,Z as ContextOf,tt as Default,h as DestroyContainer,a as DestroyContainerImpl,o as Destroyable,c as DestroyableImpl,M as Destructured,jt as DevTools,et as Empty,nt as ExecutorApplied,rt as Filtered,st as Fold,ot as Freeze,ct as FromEvent,H as Late,I as LateImpl,it as Lazy,$ as Local,ut as Map,g as Message,wt as MessageDestroyable,j as MessageImpl,S as New,E as Of,ht as Once,at as Piped,J as Primitive,L as PrimitiveImpl,lt as Process,ft as Race,d as Rejections,y as ResetSilenceCache,dt as Sequence,A as Shared,B as SharedImpl,b as Silence,O as Source,k as SourceImpl,yt as Stream,bt as Trackable,pt as Value,T as Void,p as ensureFunction,v as ensureMessage,r as isDestroyable,s as isDestroyed,t as isFilled,e as isMessage,n as isSource};
//# sourceMappingURL=silentium.min.mjs.map
