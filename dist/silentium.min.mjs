const t=t=>null!=t;function e(t){return null!==t&&"object"==typeof t&&"then"in t&&"function"==typeof t.then}function n(t){return null!==t&&"object"==typeof t&&"use"in t&&"function"==typeof t.use}function r(t){return null!==t&&"object"==typeof t&&"destroy"in t&&"function"==typeof t.destroy}function s(t){return null!==t&&"object"==typeof t&&"destroyed"in t&&"function"==typeof t.destroyed}function i(t){return new o(t)}class o{constructor(t){this.base=t}destroy(){return r(this.base)&&this.base.destroy(),"function"==typeof this.base&&this.base(),this}}var c=Object.defineProperty,u=(t,e,n)=>((t,e,n)=>e in t?c(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,e+"",n);function h(){return new a}class a{constructor(){u(this,"destructors",[])}add(t){return this.destructors.push(i(t)),t}destroy(){return this.destructors.forEach(t=>t.destroy()),this.destructors.length=0,this}}var l=Object.defineProperty,f=(t,e,n)=>((t,e,n)=>e in t?l(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n);class d{constructor(){f(this,"catchers",[]),f(this,"lastRejectReason",null),f(this,"reject",t=>{this.lastRejectReason=t,this.catchers.forEach(e=>{e(t)})})}catch(t){return null!==this.lastRejectReason&&t(this.lastRejectReason),this.catchers.push(t),this}destroy(){return this.catchers.length=0,this}}var b=Object.defineProperty,y=(t,e,n)=>((t,e,n)=>e in t?b(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n);function p(t){return new w(t)}class w{constructor(e){this.v=e,y(this,"rejections",new d),y(this,"lateR",null),y(this,"notify",()=>{if(t(this.v)&&this.lateR)try{this.lateR(this.v)}catch(t){this.rejections.reject(t)}})}then(t){if(this.lateR)throw new Error("Late component gets new resolver, when another was already connected!");return this.lateR=t,this.notify(),this}use(t){return this.v=t,this.notify(),this}catch(t){return this.rejections.catch(t),this}}var v=Object.defineProperty,j=(t,e,n)=>((t,e,n)=>e in t?v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,e+"",n);function m(t,e=null){return new g(t,e)}class g{constructor(t,e=null){this.$base=t,this.theValue=e,j(this,"touched",!1)}ensureTouched(){this.touched||this.$base.then(t=>{this.theValue=t}),this.touched=!0}[Symbol.toPrimitive](){return this.ensureTouched(),this.theValue}primitive(){return this.ensureTouched(),this.theValue}primitiveWithException(){if(this.ensureTouched(),null===this.theValue)throw new Error("Primitive value is null");return this.theValue}}var E=Object.defineProperty,R=(t,e,n)=>((t,e,n)=>e in t?E(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n);function V(t,e){return new x(t,e)}class x{constructor(t,e){this.$base=t,this.source=e,R(this,"resolver",t=>{this.lastV=t,this.resolvers.forEach(e=>{e(t)})}),R(this,"lastV"),R(this,"resolvers",new Set),n(t)&&(this.source=t)}then(e){return this.resolvers.add(e),1===this.resolvers.size?this.$base.then(this.resolver):t(this.lastV)&&e(this.lastV),this}use(t){return this.source?this.source.use(t):this.resolver(t),this}catch(t){return this.$base.catch(t),this}destroy(){return this.resolvers.clear(),this}value(){return m(this)}chain(t){return t.then(this.use.bind(this)),this}}function P(t){const e=p(t);return V(e,e)}function O(t,e){if("function"!=typeof t)throw new Error(`${e}: is not function`)}function $(t,n){if(!e(t))throw new Error(`${n}: is not message`)}var z=Object.defineProperty,S=(t,e,n)=>((t,e,n)=>e in t?z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n);function T(t){return new C(t)}class C{constructor(t){this.executor=t,S(this,"rejections",new d),S(this,"dc",h()),O(t,"Message: executor")}then(t){const n=P();try{const r=r=>{const s=t(r);this.dc.add(s),e(s)?n.chain(s):n.use(r)};this.dc.add(this.executor(r,this.rejections.reject))}catch(t){this.rejections.reject(t)}return n}catch(t){return this.rejections.catch(t),this}destroy(){return this.dc.destroy(),this.rejections.destroy(),this}}function M(t){return T(function(e){e(t)})}function k(t){return e(t)?t:M(t)}function L(t){return new W(t)}class W{constructor(t){this.src=t}chain(t){return t.then(this.src.use.bind(this.src)),this}}function q(t){const e=k(t);return T(function(t){let n=!1;return e.then(e=>{n||t(e)}),()=>{n=!0}})}var A=Object.defineProperty,B=(t,e,n)=>((t,e,n)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,e+"",n);function D(t,e){return new F(t,e)}class F{constructor(t,e){this.sourceExecutor=e,B(this,"message"),this.message=T(t)}use(t){return this.sourceExecutor(t),this}then(t){return this.message.then(t),this}catch(t){return this.message.catch(t),this}}function G(t){return T(function(e){e(t())})}function H(){return()=>{}}function I(...t){const e=t.map(k);return T(function(n){const r=new Set(Object.keys(t)),s=new Set,i=[];0!==r.size?e.map((t,e)=>{t.then(t=>{var o,c;s.add(e.toString()),i[e]=t,c=r,(o=s).size>0&&o.size===c.size&&n(i)})}):n([])})}function J(...t){const e=t.map(k);return T(function(t){e.forEach(e=>{e.then(t)})})}function K(t,e){const n=k(t);return T(function(t){n.then(n=>{t(e(n))})})}function N(t,e){return K(t,function(t){return e(...t)})}function Q(t){const e=new d;t.catch(e.reject);const n=p();return e.catch(t=>{n.use(t)}),n}function U(...t){const e=t.map(k);return T(function(t){let n;const r=s=>{const i=e[s],o=e[s+1];i.then(e=>{!function(e,s,i){s||(n=e);n&&t(n);s&&!n&&r(i+1)}(e,o,s)})};r(0)})}function X(t){const e=k(t);return T((t,n)=>{e.then(e=>{const r=X.transport.get(e.transport);if(void 0===r)throw new Error(`Context: unknown transport ${e.transport}`);e.result||(e.result=t),e.error||(e.error=n);try{r(e)}catch(t){n(t)}})})}function Y(t){const e=k(t);return t=>{if(!t.result)throw new Error("ContextChain did not find result in rpc message");e.then(t.result)}}function Z(t){const e=P();return X.transport.set(t,e.use.bind(e)),T(t=>{e.then(t)})}function _(t,e){return T(function(n){t.then(e(n))})}function tt(t,e,n){const r=k(t);return T(function(t){r.then(r=>{e(r)?t(r):void 0!==n&&t(n)})})}function et(t,e,n,r){const s=k(t),i=k(e),o=k(n),c=k(r);return T(t=>{let e=null;const n=t=>{e&&e(t)};return I(s,i,o).then(([r,s,i])=>{e=t,r?.[i]&&r[i](s,n)}),()=>{e=null,c&&I(s,i,c).then(([t,e,r])=>{t?.[r]?.(e,n)})}})}function nt(t,n){const r=k(t);return T(t=>{const s=[],i=h();r.then(r=>{i.destroy(),r.forEach(t=>{let r=t;e(r)||(r=M(r));const o=n(r);i.add(o),s.push(o)}),I(...s).then(t)})})}function rt(t){return T(e=>{let n=!1;t.then(t=>{n||(n=!0,e(t))})})}function st(t,e){return T((n,r)=>{const s=P(),i=h();return t.then(t=>{const n=e(t);i.add(n),s.chain(n),n.catch(r)}),t.catch(r),s.then(n),()=>{i.destroy()}})}function it(t){return T(e=>{const n=[];t.then(t=>{n.push(t),e(n)})})}function ot(t){const e=k(t);return T(t=>{e.then(e=>{e.forEach(e=>{t(e)})})})}X.transport=new Map;export{k as ActualMessage,I as All,J as Any,K as Applied,N as AppliedDestructured,Q as Catch,U as Chain,L as Chainable,W as ChainableImpl,X as Context,Y as ContextChain,Z as ContextOf,h as DestroyContainer,a as DestroyContainerImpl,i as Destroyable,o as DestroyableImpl,_ as ExecutorApplied,tt as Filtered,et as FromEvent,p as Late,w as LateImpl,P as LateShared,q as Local,nt as Map,T as Message,C as MessageRx,D as MessageSource,F as MessageSourceImpl,G as New,M as Of,rt as Once,m as Primitive,g as PrimitiveImpl,st as Process,d as Rejections,it as Sequence,V as Shared,x as SharedImpl,ot as Stream,H as Void,O as ensureFunction,$ as ensureMessage,r as isDestroyable,s as isDestroyed,t as isFilled,e as isMessage,n as isSource};
//# sourceMappingURL=silentium.min.mjs.map
