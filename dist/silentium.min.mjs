const e=(e,t)=>{if(null==e)throw new Error("value didn't receive source argument");if(void 0===t||null===e)throw new Error("value didn't receive guest argument");return"function"==typeof e?e(t):"object"==typeof e&&"value"in e&&"function"==typeof e.value?e.value(t):i(e,t),e},t=(t,r)=>{if(null==t)throw new Error("value didn't receive source argument");if(void 0===r||null===t)throw new Error("value didn't receive guest argument");return Array.isArray(r)?r.forEach((r=>{e(t,r)})):e(t,r),t},r=e=>null!==e&&"object"==typeof e&&"value"in e&&"function"==typeof e.value||null!=e,o=e=>{if(void 0===e)throw new Error("Source constructor didn't receive executor function");return r=>{t(e,r)}},i=(e,t)=>{if(void 0===e)throw new Error("give didn't receive data argument");return void 0===t?o(e):("function"==typeof t?t(e):t.give(e),t)},n=e=>{if(void 0===e)throw new Error("isGuest didnt receive mbGuest argument");return"function"==typeof e||"function"==typeof e?.give},s=e=>{if(!e)throw new Error("receiver function was not passed to Guest constructor");const t={give:r=>(e(r),t)};return t},u=e=>{let t=!1;return()=>{t||e(),t=!0}},a=(e,t)=>{if(void 0===e)throw new Error("GuestCast didn't receive sourceGuest argument");if(void 0===t)throw new Error("GuestCast didn't receive targetGuest argument");const r={disposed(t){const r=e;return!!r.disposed&&r.disposed(t)},give:e=>(i(e,t),r),introduction:()=>"function"==typeof e?"guest":e.introduction?e.introduction():"guest"};return r},c=e=>{const t={give:r=>(e=r,t),value(){if(void 0===e)throw new Error("no value in GuestSync!");return e}};return t},d=(e,t)=>{if(void 0===e)throw new Error("GuestDisposable didn't receive guest argument");if(void 0===t)throw new Error("GuestDisposable didn't receive disposeCheck argument");const r={disposed:e=>t(e),give:t=>(i(t,e),r)};return r},l=(e,t)=>{const r={give:o=>(i(t(o),e),r)};return r},h=(e,t)=>({give:t((t=>i(t,e)))}),v=e=>{let t=100;return"priority"in e&&"function"==typeof e.priority&&(t=e.priority()),t},f=e=>"object"==typeof e&&null!==e&&"patron"===e?.introduction?.(),p=()=>"patron",g=e=>{if(void 0===e)throw new Error("Patron didn't receive willBePatron argument");const t={give:r=>(i(r,e),t),disposed(t){const r=e;return r?.disposed?.(t)||!1},introduction:p};return t},m=e=>({...g(e),priority:()=>200}),w=(e,t)=>({...e,priority:()=>t}),y=e=>{if(void 0===e)throw new Error("PatronOnce didn't receive baseGuest argument");let t=!1;const r={give:o=>(t||(t=!0,i(o,e)),r),disposed(r){if(t)return!0;const o=e;return!!o.disposed&&o.disposed(r)},introduction:p};return r};var E=Object.defineProperty,b=(e,t,r)=>((e,t,r)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class I{constructor(){b(this,"items"),b(this,"sortedItems"),this.items=new Map,this.sortedItems=[]}findInsertPosition(e){let t=0,r=this.sortedItems.length;for(;t<r;){const o=Math.floor((t+r)/2);this.sortedItems[o].priority>=e?t=o+1:r=o}return t}findItemIndex(e){return this.sortedItems.findIndex((t=>t.value===e))}add(e,t=100){const r=this.items.get(e);if(r){if(r.priority!==t){const o=this.findItemIndex(e);-1!==o&&this.sortedItems.splice(o,1),r.priority=t;const i=this.findInsertPosition(t);this.sortedItems.splice(i,0,r)}}else{const r={value:e,priority:t};this.items.set(e,r);const o=this.findInsertPosition(t);this.sortedItems.splice(o,0,r)}return this}delete(e){if(!this.items.get(e))return!1;this.items.delete(e);const t=this.findItemIndex(e);return-1!==t&&this.sortedItems.splice(t,1),!0}has(e){return this.items.has(e)}get size(){return this.items.size}clear(){this.items.clear(),this.sortedItems=[]}getPriority(e){const t=this.items.get(e);return t?.priority}setPriority(e,t){return!!this.items.has(e)&&(this.add(e,t),!0)}forEach(e){this.sortedItems.forEach((t=>{e(t.value,t.priority,this)}))}values(){return this.sortedItems.map((e=>e.value))[Symbol.iterator]()}entries(){return this.sortedItems.map((e=>[e.value,e.priority]))[Symbol.iterator]()}[Symbol.iterator](){return this.values()}toArray(){return this.sortedItems.map((e=>e.value))}toArrayWithPriorities(){return[...this.sortedItems]}debug(){console.log("Map size:",this.items.size),console.log("Sorted array length:",this.sortedItems.length),console.log("Sorted items:",this.sortedItems)}}var S=Object.defineProperty,P=(e,t,r)=>((e,t,r)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const G=new Map,z=new Map,j=new Map,M=new Map,C=[],x=()=>{C.forEach((e=>e()))},A={poolsCount:0,patronsCount:0},D=o((e=>{i(A,e),C.push((()=>{let t=0;G.forEach((e=>{t+=e.size})),A.poolsCount=G.size,A.patronsCount=t,i(A,e)}))})),O=(e,t)=>(j.has(t)||j.set(t,[]),M.has(e)||M.set(e,[]),j.get(t)?.push(e),M.get(e)?.push(t),e),V=(e,t)=>(t.forEach((t=>{O(e,t)})),e),k=e=>"object"==typeof e&&null!==e&&"destroy"in e&&"function"==typeof e.destroy,F=(...e)=>{e.forEach((e=>{k(e)&&e.destroy();const t=z.get(e);t?.destroy();const r=j.get(e);j.delete(e),r&&F(...r)}))},T=(...e)=>{e.forEach((e=>{F(e);const t=M.get(e);t&&T(...t)}))},q=e=>{const t=[];return G.forEach(((r,o)=>{r.has(e)&&t.push(o)})),t},W=e=>{if(void 0===e)throw new Error("removePatronFromPools didn't receive patron argument");G.forEach((t=>{t.delete(e)})),x()},B=e=>{if(void 0===e)throw new Error("isPatronInPools didn't receive patron argument");let t=!1;return G.forEach((r=>{t||(t=r.has(e))})),t},N=()=>{let e=[];return G.forEach((t=>{e=e.concat(Array.from(t.values()))})),e};class R{constructor(e){this.initiator=e,P(this,"patrons"),P(this,"give"),this.patrons=new I,G.set(this,this.patrons),z.set(this.initiator,this);const t=e=>{this.patrons.forEach((t=>{this.sendValueToGuest(e,t)}))};this.give=e=>(t(e),this),x()}size(){return this.patrons.size}add(e){if(void 0===e)throw new Error("PatronPool add method received nothing!");return"function"!=typeof e&&e.introduction&&"patron"===e.introduction()&&this.patrons.add(e,v(e)),x(),this}remove(e){return this.patrons.delete(e),x(),this}distribute(e,t){return this.add(t),this.sendValueToGuest(e,t),this}destroy(){return this.patrons.forEach((e=>{this.remove(e)})),G.delete(this),z.delete(this.initiator),x(),this}sendValueToGuest(e,t){return this.guestDisposed(e,t)||i(e,t),this}guestDisposed(e,t){return!!t.disposed?.(e)&&(this.remove(t),!0)}}const _=(e,t)=>{const r=l(e,t),o={give:e=>(r.give(e),o),introduction:p};return o},H=(e,t)=>{const r=h(e,t),o={give:e=>(r.give(e),o),introduction:p};return o},J=(e,t)=>new Proxy(e,{get:(e,r)=>"name"===r?t:e[r]}),K=(e,r)=>{const o=c(r);t(e,m(o));const i={value(r){return t(e,r),this},syncValue(){try{return o.value()}catch{throw new Error("No value in SourceSync")}}};return O(i,e),i},L=e=>null==e,Q=e=>{const o={},i=new R(o);let n=L(e);return!n&&r(e)&&t(e,y((t=>{n=L(t),e=t}))),o.value=t=>n?(f(t)&&i.add(t),o):("function"==typeof t?i.distribute(e,s(t)):i.distribute(e,t),o),o.give=t=>(n=L(t),e=t,n||i.give(e),o),o},U=e=>{const t=Q(e),r=K(t,null),o={value:t.value,give:e=>(r.syncValue()!==e&&i(e,t.give),o)};return e?(O(o,e),O(r,e),O(t,e)):(O(t,o),O(r,o)),o},X=e=>{const r=new Set(Object.keys(e)),o=new Set,n=Q({}),c=[],d=u((()=>{Object.entries(e).forEach((([e,i])=>{O(n,i),r.add(e);const u=J(m((t=>{n.value(s((r=>{o.add(e);const i={...r,[e]:t};n.give(i)})))})),"all_key-patron");c.push(u),t(i,u)}))}));return{value(e){d();const t=J(a(e,(t=>{o.size>0&&o.size===r.size&&i(Object.values(t),e)})),"mb-patron");c.push(t),n.value(t)},destroy(){c.forEach((e=>{W(e)})),F(n)}}},Y=(e,o)=>{if(void 0===e)throw new Error("SourceSequence didn't receive baseSource argument");if(void 0===o)throw new Error("SourceSequence didn't receive targetSource argument");const n=n=>{const s=Q(),u=o.get(s);O(s,e),t(e,a(n,(o=>{let a=0;const c=[];o.forEach((()=>{const t=Q();c.push(t),O(t,e)}));const d=()=>{void 0!==o[a+1]&&(a+=1,l())};function l(){const e=c[a],i=o[a];r(i)?t(i,y((r=>{s.give(r),t(u,e),d()}))):(s.give(i),t(u,e),d())}void 0!==o[a]?(l(),t(X(c),n)):i([],n)})))};return O(n,e),n},Z=(e,r)=>{if(void 0===e)throw new Error("SourceMap didn't receive baseSource argument");if(void 0===r)throw new Error("SourceMap didn't receive targetSource argument");const o=Q(),n=u((()=>{t(e,m((n=>{const s=[];n.forEach((t=>{const o=r.get(t);O(o,e),s.push(o)})),t(X(s),y((e=>{F(...s),i(e,o)})))})))})),s=e=>{n(),o.value(e)};return O(o,s),s},$=e=>{if(void 0===e)throw new Error("SourceRace didnt receive sources argument");return r=>{let o=null;e.forEach((e=>{t(e,a(r,(t=>{o&&o!==e||(i(t,r),o=e)})))}))}},ee=(...e)=>{const r=Q(),o=new WeakMap,i=n=>{const s=e[n],u=e[n+1];t(s,m((e=>{let a=s;"object"==typeof s&&null!==s||"function"==typeof s||Array.isArray(s)||(a={source:s}),u&&t(r,r),u?o.has(a)||i(n+1):r.give(e),o.set(a,1)})))},n=u((()=>{i(0)})),s=e=>{n(),r.value(e)};return V(s,e),V(r,e),s},te=(e,r)=>{if(void 0===e)throw new Error("SourceDynamic didn't receive baseGuest argument");if(void 0===r)throw new Error("SourceDynamic didn't receive baseSource argument");const o={value:e=>(t(r,e),o),give(t){return i(t,e),this}};return o},re=(e,r)=>{const o=o=>{t(e,a(o,(e=>{i(r(e),o)})))};return O(o,e),o},oe=(e,r)=>o=>{t(e,a(o,r((e=>{i(e,o)}))))},ie=(e,r,o)=>n=>{t(e,a(n,(e=>{!0===r(e)?i(e,n):void 0!==o&&i(o,n)})))},ne=e=>{let r=void 0!==e;const o=Q(e);return{value(e){return t(o,e),this},give(e){return r||(o.give(e),r=!0),this},destroy(){F(o)}}},se=(...e)=>r=>{const o=Q();return V(o,e),t(X(e),m((e=>{r(o.give,...e)}))),o.value},ue=(e,r)=>{const o=Q(),n=u((()=>{t(r,m((()=>{i(null,o)}))),t(e,m(o)),O(o,e)}));return te(o.give,(e=>{n(),o.value(e)}))},ae=e=>{const r=Q(),o=u((()=>{e.forEach((e=>{t(e,m(r)),O(r,e)}))})),i=e=>{o(),r.value(e)};return V(i,e),i},ce=(e,r,o)=>{let i=null;const n=Q(),s=ue(n,o??Q());let u=!1;o&&t(o,m((()=>{F(i),i=null})));const a=o=>{var c;c=a,u||(u=!0,t(X(r),m((()=>{i||(i=e.get(...r),t(i,m(n)),O(n,c),O(s,c))})))),t(s,o)};return a},de=e=>{let t=null;const r={value(r){return t=e(r),this},destroy(){return null!==t&&"function"==typeof t&&t(),this}};return O(r,e),r},le=(e,t={})=>{if(void 0===e)throw new Error("PrivateClass didn't receive constructorFn argument");return{get:(...r)=>new e(...r,t)}},he=e=>{if(void 0===e)throw new Error("lazy didn't receive buildingFn argument");return{get:(...t)=>e(...t)}};export{R as PatronPool,N as allPatrons,F as destroy,T as destroyFromSubSource,u as firstVisit,i as give,s as guest,l as guestApplied,a as guestCast,d as guestDisposable,h as guestExecutorApplied,c as guestSync,p as introduction,k as isDestroyable,n as isGuest,f as isPatron,B as isPatronInPools,r as isSource,he as lazy,le as lazyClass,g as patron,_ as patronApplied,H as patronExecutorApplied,y as patronOnce,q as patronPools,D as patronPoolsStatistic,v as patronPriority,W as removePatronFromPools,o as source,X as sourceAll,ae as sourceAny,re as sourceApplied,ee as sourceChain,se as sourceCombined,de as sourceDestroyable,te as sourceDynamic,oe as sourceExecutorApplied,ie as sourceFiltered,ce as sourceLazy,Z as sourceMap,U as sourceMemoOf,Q as sourceOf,ne as sourceOnce,$ as sourceRace,ue as sourceResettable,Y as sourceSequence,K as sourceSync,O as subSource,V as subSourceMany,m as systemPatron,t as value,J as withName,w as withPriority};
//# sourceMappingURL=silentium.min.mjs.map
