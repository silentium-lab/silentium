{"version":3,"file":"silentium.js","sources":["../src/helpers/guards.ts","../src/base/Destroyable.ts","../src/base/DestroyContainer.ts","../src/base/Rejections.ts","../src/helpers/ensures.ts","../src/base/Message.ts","../src/base/Of.ts","../src/base/ActualMessage.ts","../src/base/Chainable.ts","../src/base/Local.ts","../src/base/MessageSource.ts","../src/base/New.ts","../src/base/Void.ts","../src/components/All.ts","../src/components/Any.ts","../src/components/Applied.ts","../src/components/AppliedDestructured.ts","../src/components/Late.ts","../src/components/Catch.ts","../src/components/Chain.ts","../src/components/Context.ts","../src/components/ContextChain.ts","../src/components/Primitive.ts","../src/components/Shared.ts","../src/components/LateShared.ts","../src/components/ContextOf.ts","../src/components/Filtered.ts","../src/components/Empty.ts","../src/components/ExecutorApplied.ts","../src/components/Freeze.ts","../src/components/FromEvent.ts","../src/components/Map.ts","../src/components/Once.ts","../src/components/Process.ts","../src/components/Sequence.ts","../src/components/Stream.ts"],"sourcesContent":["import { DestroyableType, DestroyedType } from \"types/DestroyableType\";\nimport { MessageType } from \"types/MessageType\";\nimport { SourceType } from \"types/SourceType\";\n\n/**\n * Checks that the value is neither undefined nor null\n */\nexport const isFilled = <T>(\n  value?: T,\n): value is Exclude<T, null | undefined> => {\n  return value !== undefined && value !== null;\n};\n\n/**\n * Checks that the object is an message\n */\nexport function isMessage(o: unknown): o is MessageType {\n  return (\n    o !== null &&\n    typeof o === \"object\" &&\n    \"then\" in o &&\n    typeof (o as any).then === \"function\"\n  );\n}\n\n/**\n * Checks that the object is an message\n */\nexport function isSource(o: unknown): o is SourceType {\n  return (\n    o !== null &&\n    typeof o === \"object\" &&\n    \"use\" in o &&\n    typeof (o as any).use === \"function\"\n  );\n}\n\n/**\n * Checks that the object is destroyable\n */\nexport function isDestroyable(o: unknown): o is DestroyableType {\n  return (\n    o !== null &&\n    typeof o === \"object\" &&\n    \"destroy\" in o &&\n    typeof (o as any).destroy === \"function\"\n  );\n}\n\n/**\n * Checks that the object can indicate whether it has been destroyed or not\n */\nexport function isDestroyed(o: unknown): o is DestroyedType {\n  return (\n    o !== null &&\n    typeof o === \"object\" &&\n    \"destroyed\" in o &&\n    typeof (o as any).destroyed === \"function\"\n  );\n}\n","import { isDestroyable } from \"helpers/guards\";\nimport { DestroyableType } from \"types/DestroyableType\";\n\n/**\n * Allows creating an object that definitely has a destructor,\n * useful to avoid creating unnecessary conditions\n */\nexport function Destroyable<T>(base: T) {\n  return new DestroyableImpl(base);\n}\n\nexport class DestroyableImpl<T> implements DestroyableType {\n  public constructor(private base: T) {}\n\n  public destroy(): this {\n    if (isDestroyable(this.base)) {\n      this.base.destroy();\n    }\n\n    if (typeof this.base === \"function\") {\n      this.base();\n    }\n\n    return this;\n  }\n}\n","import { Destroyable } from \"base/Destroyable\";\nimport { DestroyableType } from \"types/DestroyableType\";\n\n/**\n * An object that allows collecting all disposable objects and\n * disposing them later all together\n */\nexport function DestroyContainer() {\n  return new DestroyContainerImpl();\n}\n\nexport class DestroyContainerImpl implements DestroyableType {\n  private destructors: DestroyableType[] = [];\n\n  public add<R>(e: R): R {\n    this.destructors.push(Destroyable(e));\n    return e;\n  }\n\n  public destroy() {\n    this.destructors.forEach((d) => d.destroy());\n    this.destructors.length = 0;\n    return this;\n  }\n}\n","import { ConstructorType } from \"types/ConstructorType\";\n\n/**\n * Handles rejections collection\n */\nexport class Rejections {\n  private catchers: ConstructorType<[unknown]>[] = [];\n  private lastRejectReason: unknown = null;\n\n  public reject = (reason: unknown) => {\n    this.lastRejectReason = reason;\n    this.catchers.forEach((catcher) => {\n      catcher(reason);\n    });\n  };\n\n  public catch(rejected: ConstructorType<[unknown]>) {\n    if (this.lastRejectReason !== null) {\n      rejected(this.lastRejectReason);\n    }\n    this.catchers.push(rejected);\n    return this;\n  }\n\n  public destroy() {\n    this.catchers.length = 0;\n    return this;\n  }\n}\n","import { isMessage } from \"helpers/guards\";\n\nexport function ensureFunction(v: unknown, label: string) {\n  if (typeof v !== \"function\") {\n    throw new Error(`${label}: is not function`);\n  }\n}\n\nexport function ensureMessage(v: unknown, label: string) {\n  if (!isMessage(v)) {\n    throw new Error(`${label}: is not message`);\n  }\n}\n","import { DestroyContainer } from \"base/DestroyContainer\";\nimport { Rejections } from \"base/Rejections\";\nimport { ensureFunction } from \"helpers/ensures\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { DestroyableType } from \"types/DestroyableType\";\nimport { MessageType } from \"types/MessageType\";\n\nexport type MessageExecutorType<T> = (\n  resolve: ConstructorType<[T]>,\n  reject: ConstructorType<[unknown]>,\n) => MessageType | (() => void) | void;\n\n/**\n * A message created from an executor function.\n * The executor function can return a message destruction function.\n */\nexport function Message<T>(executor: MessageExecutorType<T>) {\n  return new MessageRx<T>(executor);\n}\n\n/**\n * Reactive message implementation\n */\nexport class MessageRx<T> implements MessageType<T>, DestroyableType {\n  private rejections = new Rejections();\n  private dc = DestroyContainer();\n\n  public constructor(private executor: MessageExecutorType<T>) {\n    ensureFunction(executor, \"Message: executor\");\n  }\n\n  public then(resolve: ConstructorType<[T]>) {\n    try {\n      this.dc.add(this.executor(resolve, this.rejections.reject));\n    } catch (e: any) {\n      this.rejections.reject(e);\n    }\n    return this;\n  }\n\n  public catch(rejected: ConstructorType<[unknown]>) {\n    this.rejections.catch(rejected);\n    return this;\n  }\n\n  public destroy() {\n    this.dc.destroy();\n    this.rejections.destroy();\n    return this;\n  }\n}\n","import { Message } from \"base/Message\";\n\n/**\n * Helps convert a value into a message\n */\nexport function Of<T>(value: T) {\n  return Message<T>(function OfImpl(r) {\n    r(value);\n  });\n}\n","import { Of } from \"base/Of\";\nimport { isMessage } from \"helpers/guards\";\nimport { MaybeMessage, MessageType } from \"types/MessageType\";\n\n/**\n * A function that helps to ensure that\n * the message is indeed a message object\n * and not just a value\n */\nexport function ActualMessage<T>(message: MaybeMessage<T>): MessageType<T> {\n  return isMessage(message) ? message : Of(message);\n}\n","import { ChainableType } from \"types/ChainableType\";\nimport { MessageType } from \"types/MessageType\";\nimport { SourceType } from \"types/SourceType\";\n\n/**\n * Helps to connect Different\n * message and source\n */\nexport function Chainable<T>(src: SourceType<T>) {\n  return new ChainableImpl(src);\n}\n\nexport class ChainableImpl<T> implements ChainableType<T> {\n  public constructor(private src: SourceType<T>) {}\n\n  public chain($m: MessageType<T>) {\n    $m.then(this.src.use.bind(this.src));\n    return this;\n  }\n}\n","import { ActualMessage } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { MaybeMessage } from \"types/MessageType\";\n\n/**\n * Create local copy of source what can be destroyed\n */\nexport function Local<T>(_base: MaybeMessage<T>) {\n  const $base = ActualMessage(_base);\n  return Message<T>(function LocalImpl(r) {\n    let destroyed = false;\n    $base.then((v) => {\n      if (!destroyed) {\n        r(v);\n      }\n    });\n    return () => {\n      destroyed = true;\n    };\n  });\n}\n","import { Message, MessageExecutorType, MessageRx } from \"base/Message\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { MessageSourceType } from \"types/SourceType\";\n\n/**\n * Base message source object\n */\nexport function MessageSource<T>(\n  messageExecutor: MessageExecutorType<T>,\n  sourceExecutor: ConstructorType<[T]>,\n) {\n  return new MessageSourceImpl(messageExecutor, sourceExecutor);\n}\n\nexport class MessageSourceImpl<T> implements MessageSourceType<T> {\n  private message: MessageRx<T>;\n\n  public constructor(\n    messageExecutor: MessageExecutorType<T>,\n    private sourceExecutor: ConstructorType<[T]>,\n  ) {\n    this.message = Message(messageExecutor);\n  }\n\n  public use(value: T): this {\n    this.sourceExecutor(value);\n    return this;\n  }\n\n  public then(resolved: ConstructorType<[T]>): this {\n    this.message.then(resolved);\n    return this;\n  }\n\n  public catch(rejected: ConstructorType<[unknown]>): this {\n    this.message.catch(rejected);\n    return this;\n  }\n}\n","import { Message } from \"base/Message\";\nimport { ConstructorType } from \"types/ConstructorType\";\n\n/**\n * A component that, on each access, returns a new instance\n * of a reference type based on the constructor function\n */\nexport function New<T>(construct: ConstructorType<[], T>) {\n  return Message<T>(function NewImpl(resolve) {\n    resolve(construct());\n  });\n}\n","/**\n * Resolver that does nothing with the passed value,\n * needed for silent message triggering\n */\nexport function Void() {\n  return () => {};\n}\n","import { ActualMessage } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { MaybeMessage } from \"types/MessageType\";\n\ntype ExtractTypeS<T> = T extends MaybeMessage<infer U> ? U : never;\n\ntype ExtractTypesFromArrayS<T extends MaybeMessage<any>[]> = {\n  [K in keyof T]: ExtractTypeS<T[K]>;\n};\n\nconst isAllFilled = (keysFilled: Set<string>, keysKnown: Set<string>) => {\n  return keysFilled.size > 0 && keysFilled.size === keysKnown.size;\n};\n\n/**\n * A message that represents values from\n * all provided messages as an array.\n * When all messages emit their values,\n * the combined value will be returned.\n * If at least one message later emits a new\n * value, the updated array with the new value\n * will be emitted by All.\n */\nexport function All<const T extends MaybeMessage[]>(...messages: T) {\n  const $messages = messages.map(ActualMessage);\n  return Message<ExtractTypesFromArrayS<T>>(function AllImpl(resolve, reject) {\n    const known = new Set<string>(Object.keys(messages));\n    const filled = new Set<string>();\n    const result: unknown[] = [];\n    if (known.size === 0) {\n      resolve([] as ExtractTypesFromArrayS<T>);\n      return;\n    }\n    $messages.map((m, key) => {\n      m.catch(reject);\n      m.then((v) => {\n        filled.add(key.toString());\n        result[key] = v;\n        if (isAllFilled(filled, known)) {\n          resolve(result as ExtractTypesFromArrayS<T>);\n        }\n      });\n    });\n  });\n}\n","import { ActualMessage } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { MaybeMessage } from \"types/MessageType\";\n\n/**\n * A message that emits values received from\n * any of its bound messages\n */\nexport function Any<const T>(...messages: MaybeMessage<T>[]) {\n  const $messages = messages.map(ActualMessage);\n  return Message<T>(function AnyImpl(resolve, reject) {\n    $messages.forEach((message) => {\n      message.catch(reject);\n      message.then(resolve);\n    });\n  });\n}\n","import { ActualMessage } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { MaybeMessage } from \"types/MessageType\";\n\n/**\n * An message that applies a function\n * to the value of the base message\n */\nexport function Applied<const T, R>(\n  base: MaybeMessage<T>,\n  applier: ConstructorType<[T], R>,\n) {\n  const $base = ActualMessage(base);\n  return Message<R>(function AppliedImpl(resolve, reject) {\n    $base.catch(reject);\n    $base.then((v) => {\n      resolve(applier(v));\n    });\n  });\n}\n","import { Applied } from \"components/Applied\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { MaybeMessage } from \"types/MessageType\";\n\n/**\n * Allows applying variables from an message that passes an array to a function,\n * where each element of the array will be passed as a separate argument\n */\nexport function AppliedDestructured<const T extends any[], R>(\n  $base: MaybeMessage<T>,\n  applier: ConstructorType<T[number][], R>,\n) {\n  return Applied($base, function AppliedDestructuredImpl(args) {\n    return applier(...args);\n  });\n}\n","import { Rejections } from \"base/Rejections\";\nimport { isFilled } from \"helpers/guards\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { MessageSourceType } from \"types/SourceType\";\n\n/**\n * A component that allows creating linked objects of information and its owner\n * in such a way that if a new value is assigned to the owner, this value\n * will become the value of the linked information source\n * https://silentium-lab.github.io/silentium/#/en/information/of\n */\nexport function Late<T>(v?: T) {\n  return new LateImpl<T>(v);\n}\n\nexport class LateImpl<T> implements MessageSourceType<T> {\n  private rejections = new Rejections();\n  private lateR: ConstructorType<[T]> | null = null;\n  private notify = () => {\n    if (isFilled(this.v) && this.lateR) {\n      try {\n        this.lateR(this.v);\n      } catch (e: any) {\n        this.rejections.reject(e);\n      }\n    }\n  };\n\n  public constructor(private v?: T) {}\n\n  public then(r: ConstructorType<[T]>): this {\n    if (this.lateR) {\n      throw new Error(\n        \"Late component gets new resolver, when another was already connected!\",\n      );\n    }\n    this.lateR = r;\n    this.notify();\n    return this;\n  }\n\n  public use(value: T): this {\n    this.v = value;\n    this.notify();\n    return this;\n  }\n\n  public catch(rejected: ConstructorType<[unknown]>) {\n    this.rejections.catch(rejected);\n    return this;\n  }\n}\n","import { Rejections } from \"base/Rejections\";\nimport { Late } from \"components/Late\";\nimport { MessageType } from \"types/MessageType\";\n\n/**\n * Message with error catched\n * inside another message\n */\nexport function Catch<T>($base: MessageType) {\n  const rejections = new Rejections();\n  $base.catch(rejections.reject);\n  const $error = Late<T>();\n  rejections.catch((e) => {\n    $error.use(e as T);\n  });\n\n  return $error;\n}\n","import { ActualMessage } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { MessageType, MessageTypeValue } from \"types/MessageType\";\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\ntype Last<T extends readonly any[]> = T extends readonly [...infer _, infer L]\n  ? L\n  : never;\n\n/**\n * Chains messages together and triggers\n * the last message only when all previous messages\n * have emitted their values. The value of Chain will be the value\n * of the last message. If any messages\n * emit a value again after the overall Chain response was already returned,\n * then Chain emits again with the value of the last message.\n */\nexport function Chain<T extends readonly MessageType[]>(...messages: T) {\n  const $messages = messages.map(ActualMessage);\n  return Message<MessageTypeValue<Last<T>>>(\n    function ChainImpl(resolve, reject) {\n      let $latest: MessageTypeValue<Last<T>> | undefined;\n      const handleMessage = (index: number) => {\n        const message = $messages[index] as Last<T>;\n        message.catch(reject);\n        const next = $messages[index + 1] as Last<T> | undefined;\n        message.then((v) => {\n          oneMessage(v as MessageTypeValue<Last<T>>, next, index);\n        });\n      };\n      function oneMessage(\n        v: MessageTypeValue<Last<T>>,\n        next: Last<T> | undefined,\n        index: number,\n      ) {\n        if (!next) {\n          $latest = v as MessageTypeValue<Last<T>>;\n        }\n        if ($latest) {\n          resolve($latest);\n        }\n        if (next && !$latest) {\n          handleMessage(index + 1);\n        }\n      }\n      handleMessage(0);\n    },\n  );\n}\n","import { ActualMessage } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { ContextType } from \"types/ContextType\";\nimport { MaybeMessage } from \"types/MessageType\";\n\nContext.transport = new Map<any, ConstructorType<[ContextType]>>();\n\n/**\n * The ability to call an external system through\n * sending a message in a standardized format\n * ContextType, the list of transport should be defined via\n * the Context.transport map object\n */\nexport function Context<T>(msg: MaybeMessage<ContextType>) {\n  const $msg = ActualMessage(msg);\n  return Message<T>((resolve, reject) => {\n    $msg.then((message) => {\n      const transport = Context.transport.get(message.transport);\n      if (transport === undefined) {\n        throw new Error(`Context: unknown transport ${message.transport}`);\n      }\n      if (!message.result) {\n        message.result = resolve;\n      }\n      if (!message.error) {\n        message.error = reject;\n      }\n      try {\n        transport(message);\n      } catch (error) {\n        reject(error);\n      }\n    });\n  });\n}\n","import { ActualMessage } from \"base/ActualMessage\";\nimport { MaybeMessage } from \"types/MessageType\";\nimport { ContextType } from \"types/ContextType\";\n\n/**\n * Connects an external message to an RPC message chain\n */\nexport function ContextChain(base: MaybeMessage) {\n  const $base = ActualMessage(base);\n  return (context: ContextType) => {\n    if (!context.result) {\n      throw new Error(\"ContextChain did not find result in rpc message\");\n    }\n    $base.then(context.result);\n  };\n}\n","import { MessageType } from \"types/MessageType\";\n\n/**\n * Helps represent an message as a primitive type, which can be useful\n * for cases when you need to always have a reference to the current value\n * without updating the shared value when the current one changes.\n * For example, this could be used when passing an authorization token.\n * It can also be useful for testing or logging purposes.\n */\nexport function Primitive<T>($base: MessageType<T>, theValue: T | null = null) {\n  return new PrimitiveImpl<T>($base, theValue);\n}\n\nexport class PrimitiveImpl<T> {\n  private touched = false;\n\n  public constructor(\n    private $base: MessageType<T>,\n    private theValue: T | null = null,\n  ) {}\n\n  private ensureTouched() {\n    if (!this.touched) {\n      this.$base.then((v) => {\n        this.theValue = v;\n      });\n    }\n    this.touched = true;\n  }\n\n  public [Symbol.toPrimitive]() {\n    this.ensureTouched();\n    return this.theValue;\n  }\n\n  public primitive() {\n    this.ensureTouched();\n    return this.theValue;\n  }\n\n  public primitiveWithException() {\n    this.ensureTouched();\n    if (this.theValue === null) {\n      throw new Error(\"Primitive value is null\");\n    }\n    return this.theValue;\n  }\n}\n","import { MessageType } from \"types/MessageType\";\nimport { MessageSourceType, SourceType } from \"types/SourceType\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { isFilled, isSource } from \"helpers/guards\";\nimport { Primitive } from \"components/Primitive\";\nimport { ChainableType } from \"types/ChainableType\";\n\n/**\n * An information object that helps multiple owners access\n * a single another information object\n */\nexport function Shared<T>($base: MessageType<T> | MessageSourceType<T>) {\n  return new SharedImpl<T>($base);\n}\n\nexport class SharedImpl<T> implements MessageSourceType<T>, ChainableType<T> {\n  private resolver = (v: T) => {\n    this.lastV = v;\n    this.resolvers.forEach((r) => {\n      r(v);\n    });\n  };\n  private lastV: T | undefined;\n  private resolvers = new Set<ConstructorType<[T]>>();\n  private source?: SourceType<T>;\n\n  public constructor(private $base: MessageType<T> | MessageSourceType<T>) {\n    if (isSource($base)) {\n      this.source = $base;\n    }\n  }\n\n  public then(resolved: ConstructorType<[T]>) {\n    this.resolvers.add(resolved);\n    if (this.resolvers.size === 1) {\n      this.$base.then(this.resolver);\n    } else if (isFilled(this.lastV)) {\n      resolved(this.lastV);\n    }\n    return this;\n  }\n\n  public use(value: T) {\n    if (this.source) {\n      this.source.use(value);\n    } else {\n      this.resolver(value);\n    }\n    return this;\n  }\n\n  public catch(rejected: ConstructorType<[unknown]>) {\n    this.$base.catch(rejected);\n    return this;\n  }\n\n  public destroy() {\n    this.resolvers.clear();\n    return this;\n  }\n\n  public value() {\n    return Primitive(this);\n  }\n\n  public chain(m: MessageType<T>) {\n    m.then(this.use.bind(this));\n    return this;\n  }\n}\n","import { Late } from \"components/Late\";\nimport { Shared } from \"components/Shared\";\n\n/**\n * An message with a value that will be set later,\n * capable of responding to many resolvers\n */\nexport function LateShared<T>(value?: T) {\n  const l = Late(value);\n  return Shared(l);\n}\n","import { Message } from \"base/Message\";\nimport { LateShared } from \"components/LateShared\";\nimport { Context } from \"components/Context\";\nimport { ContextType } from \"types/ContextType\";\n\n/**\n * Message for the arrival of a specific RPC message\n * for specific transport\n */\nexport function ContextOf(transport: string) {\n  const $msg = LateShared<ContextType>();\n  Context.transport.set(transport, $msg.use.bind($msg));\n  return Message<ContextType>((resolve, reject) => {\n    $msg.catch(reject);\n    $msg.then(resolve);\n  });\n}\n","import { ActualMessage } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { MaybeMessage, MessageType } from \"types/MessageType\";\n\n/**\n * Filters values from the source message based on a predicate function,\n * optionally providing a default value when the predicate fails.\n */\nexport function Filtered<T>(\n  base: MaybeMessage<T>,\n  predicate: ConstructorType<[T], boolean>,\n  defaultValue?: T,\n): MessageType<T> {\n  const $base = ActualMessage(base);\n  return Message<T>(function FilteredImpl(resolve, reject) {\n    $base.catch(reject);\n    $base.then((v) => {\n      if (predicate(v)) {\n        resolve(v);\n      } else if (defaultValue !== undefined) {\n        resolve(defaultValue);\n      }\n    });\n  });\n}\n","import { Filtered } from \"components/Filtered\";\nimport { LateShared } from \"components/LateShared\";\nimport { Shared } from \"components/Shared\";\nimport { EmptyType } from \"types/EmptyType\";\nimport { MessageType } from \"types/MessageType\";\n\nexport const Nothing = Symbol(\"nothing\");\n\n/**\n * Helps to split message and empty\n * response\n */\nexport function Empty<T>($base: MessageType<T>) {\n  return new EmptyImpl<T>($base);\n}\n\nexport class EmptyImpl<T> implements EmptyType {\n  private $empty = LateShared<boolean>();\n\n  public constructor(private $base: MessageType<T>) {}\n\n  public message() {\n    Shared(this.$base).then((v) => {\n      if (v === Nothing) {\n        this.$empty.use(true);\n      }\n    });\n    return Filtered(this.$base, (v) => v !== Nothing);\n  }\n\n  public empty(): MessageType<boolean> {\n    return this.$empty;\n  }\n}\n","import { Message } from \"base/Message\";\nimport { MessageType } from \"types/MessageType\";\n\ntype ExecutorApplier<T> = (executor: (v: T) => void) => (v: T) => void;\n\n/**\n * Applies a value transfer function to the resolver\n * and returns the same value transfer function for the resolver\n * Useful for applying functions like debounced or throttle\n */\nexport function ExecutorApplied<T>(\n  $base: MessageType<T>,\n  applier: ExecutorApplier<T>,\n) {\n  return Message<T>(function ExecutorAppliedImpl(resolve, reject) {\n    $base.catch(reject);\n    $base.then(applier(resolve));\n  });\n}\n","import { Message } from \"base/Message\";\nimport { MessageType } from \"types/MessageType\";\n\n/**\n * Message what freezes first known value\n */\nexport function Freeze<T>($base: MessageType<T>, $invalidate?: MessageType<T>) {\n  let freezedValue: T | null = null;\n  return Message<T>(function FreezeImpl(resolve, reject) {\n    $base.catch(reject);\n    $base.then((v) => {\n      if (freezedValue === null) {\n        freezedValue = v;\n      }\n      resolve(freezedValue as T);\n    });\n\n    $invalidate?.then(() => {\n      freezedValue = null;\n    });\n  });\n}\n","import { MaybeMessage } from \"types/MessageType\";\nimport { All } from \"components/All\";\nimport { ActualMessage } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { ConstructorType } from \"types/ConstructorType\";\n\n/**\n * A message derived from event with a different\n * method call interface, based on callbacks.\n * Allows attaching a custom handler to an existing event source\n * and presenting it as a silentium message\n */\nexport function FromEvent<T>(\n  emitter: MaybeMessage<any>,\n  eventName: MaybeMessage<string>,\n  subscribeMethod: MaybeMessage<string>,\n  unsubscribeMethod?: MaybeMessage<string>,\n) {\n  const $emitter = ActualMessage(emitter);\n  const $eventName = ActualMessage(eventName);\n  const $subscribeMethod = ActualMessage(subscribeMethod);\n  const $unsubscribeMethod = ActualMessage(unsubscribeMethod);\n  return Message<T>((resolve, reject) => {\n    $emitter.catch(reject);\n    $eventName.catch(reject);\n    $subscribeMethod.catch(reject);\n    $unsubscribeMethod.catch(reject);\n    let lastR: ConstructorType<[T]> | null = null;\n    const handler = (v: T) => {\n      if (lastR) {\n        lastR(v);\n      }\n    };\n    All($emitter, $eventName, $subscribeMethod).then(\n      ([emitter, eventName, subscribe]) => {\n        lastR = resolve;\n        if (!emitter?.[subscribe]) {\n          return;\n        }\n        emitter[subscribe](eventName, handler);\n      },\n    );\n    return () => {\n      lastR = null;\n      if (!$unsubscribeMethod) {\n        return;\n      }\n      All($emitter, $eventName, $unsubscribeMethod).then(\n        ([emitter, eventName, unsubscribe]) => {\n          emitter?.[unsubscribe as string]?.(eventName, handler);\n        },\n      );\n    };\n  });\n}\n","import { MaybeMessage, MessageType } from \"types/MessageType\";\nimport { All } from \"components/All\";\nimport { isMessage } from \"helpers/guards\";\nimport { Of } from \"base/Of\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { Message } from \"base/Message\";\nimport { ActualMessage } from \"base/ActualMessage\";\nimport { DestroyContainer } from \"base/DestroyContainer\";\n\n/**\n * Component that applies an info object constructor to each data item,\n * producing an information source with new values\n */\nexport function Map<T, TG>(\n  base: MaybeMessage<T[]>,\n  target: ConstructorType<[any], MessageType<TG>>,\n) {\n  const $base = ActualMessage(base);\n  return Message<TG[]>((resolve, reject) => {\n    $base.catch(reject);\n    const infos: MessageType<TG>[] = [];\n    const dc = DestroyContainer();\n    $base.then((v) => {\n      dc.destroy();\n      v.forEach((val) => {\n        let $val: MessageType<T> | T = val;\n        if (!isMessage($val as object)) {\n          $val = Of($val);\n        }\n        const info = target($val);\n        dc.add(info);\n        infos.push(info);\n      });\n      All(...infos).then(resolve);\n    });\n  });\n}\n","import { Message } from \"base/Message\";\nimport { MessageType } from \"types/MessageType\";\n\n/**\n * Limits the number of values from the information source\n * to a single value - once the first value is emitted, no more\n * values are delivered from the source\n */\nexport function Once<T>($base: MessageType<T>) {\n  return Message<T>((resolve, reject) => {\n    let isFilled = false;\n    $base.catch(reject);\n    $base.then((v) => {\n      if (!isFilled) {\n        isFilled = true;\n        resolve(v);\n      }\n    });\n  });\n}\n","import { DestroyContainer } from \"base/DestroyContainer\";\nimport { Message } from \"base/Message\";\nimport { LateShared } from \"components/LateShared\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { MessageType } from \"types/MessageType\";\n\nexport function Process<T, R = unknown>(\n  $base: MessageType<T>,\n  builder: ConstructorType<[T], MessageType<R>>,\n) {\n  return Message<R>((resolve, reject) => {\n    const $res = LateShared<R>();\n    const dc = DestroyContainer();\n\n    $base.then((v) => {\n      dc.destroy();\n      const $msg = builder(v);\n      dc.add($msg);\n      $res.chain($msg);\n      $msg.catch(reject);\n    });\n    $base.catch(reject);\n    $res.then(resolve);\n\n    return () => {\n      dc.destroy();\n    };\n  });\n}\n","import { Message } from \"base/Message\";\nimport { MessageType } from \"types/MessageType\";\n\n/**\n * Creates a sequence that accumulates all values from the source into an array,\n * emitting the growing array with each new value.\n */\nexport function Sequence<T>($base: MessageType<T>) {\n  return Message<T[]>((resolve, reject) => {\n    const result: T[] = [];\n    $base.catch(reject);\n    $base.then((v) => {\n      result.push(v);\n      resolve(result);\n    });\n  });\n}\n","import { ActualMessage } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { MaybeMessage } from \"types/MessageType\";\n\n/**\n * Component that receives a data array and yields values one by one\n */\nexport function Stream<T>(base: MaybeMessage<T[]>) {\n  const $base = ActualMessage(base);\n  return Message<T>((resolve, reject) => {\n    $base.catch(reject);\n    $base.then((v) => {\n      v.forEach((cv) => {\n        resolve(cv);\n      });\n    });\n  });\n}\n"],"names":["__publicField","emitter","eventName","Map"],"mappings":"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"}