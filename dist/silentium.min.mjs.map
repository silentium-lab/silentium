{"version":3,"file":"silentium.min.mjs","sources":["../src/helpers/guards.ts","../src/base/Destroyable.ts","../src/base/DestroyContainer.ts","../src/base/Rejections.ts","../src/base/Silence.ts","../src/helpers/ensures.ts","../src/base/Message.ts","../src/base/Of.ts","../src/base/ActualMessage.ts","../src/base/Connected.ts","../src/base/Local.ts","../src/base/MessageSource.ts","../src/base/New.ts","../src/base/Void.ts","../src/components/All.ts","../src/components/Any.ts","../src/components/Applied.ts","../src/components/AppliedDestructured.ts","../src/components/Primitive.ts","../src/components/Shared.ts","../src/components/Late.ts","../src/components/Catch.ts","../src/components/Chain.ts","../src/components/Computed.ts","../src/components/Context.ts","../src/components/ContextChain.ts","../src/components/ContextOf.ts","../src/components/Default.ts","../src/components/Empty.ts","../src/components/ExecutorApplied.ts","../src/components/Filtered.ts","../src/components/Fold.ts","../src/components/Freeze.ts","../src/components/FromEvent.ts","../src/components/Lazy.ts","../src/components/Map.ts","../src/components/Once.ts","../src/components/Piped.ts","../src/components/Process.ts","../src/components/Race.ts","../src/components/Sequence.ts","../src/components/Stream.ts","../src/components/Trackable.ts","../src/components/Value.ts","../src/helpers/DevTools.ts"],"sourcesContent":["import { DestroyableType, DestroyedType } from \"types/DestroyableType\";\nimport { MessageType } from \"types/MessageType\";\nimport { SourceType } from \"types/SourceType\";\n\n/**\n * Checks that the value is neither undefined nor null\n */\nexport const isFilled = <T>(\n  value?: T,\n): value is Exclude<T, null | undefined> => {\n  return value !== undefined && value !== null;\n};\n\n/**\n * Checks that the object is an message\n */\nexport function isMessage(o: unknown): o is MessageType {\n  return (\n    o !== null &&\n    typeof o === \"object\" &&\n    \"then\" in o &&\n    typeof (o as any).then === \"function\"\n  );\n}\n\n/**\n * Checks that the object is an message\n */\nexport function isSource(o: unknown): o is SourceType {\n  return (\n    o !== null &&\n    typeof o === \"object\" &&\n    \"use\" in o &&\n    typeof (o as any).use === \"function\"\n  );\n}\n\n/**\n * Checks that the object is destroyable\n */\nexport function isDestroyable(o: unknown): o is DestroyableType {\n  return (\n    o !== null &&\n    typeof o === \"object\" &&\n    \"destroy\" in o &&\n    typeof (o as any).destroy === \"function\"\n  );\n}\n\n/**\n * Checks that the object can indicate whether it has been destroyed or not\n */\nexport function isDestroyed(o: unknown): o is DestroyedType {\n  return (\n    o !== null &&\n    typeof o === \"object\" &&\n    \"destroyed\" in o &&\n    typeof (o as any).destroyed === \"function\"\n  );\n}\n","import { isDestroyable } from \"helpers/guards\";\nimport { DestroyableType } from \"types/DestroyableType\";\n\n/**\n * Allows creating an object that definitely has a destructor,\n * useful to avoid creating unnecessary conditions\n */\nexport function Destroyable<T>(base: T) {\n  return new DestroyableImpl(base);\n}\n\nexport class DestroyableImpl<T> implements DestroyableType {\n  public constructor(private base: T) {}\n\n  public destroy(): this {\n    if (isDestroyable(this.base)) {\n      this.base.destroy();\n    }\n\n    if (typeof this.base === \"function\") {\n      this.base();\n    }\n\n    return this;\n  }\n}\n","import { Destroyable } from \"base/Destroyable\";\nimport { DestroyableType } from \"types/DestroyableType\";\n\n/**\n * An object that allows collecting all disposable objects and\n * disposing them later all together\n */\nexport function DestroyContainer() {\n  return new DestroyContainerImpl();\n}\n\nexport class DestroyContainerImpl implements DestroyableType {\n  private destructors: DestroyableType[] = [];\n  private _destroyed = false;\n\n  /**\n   * Add one destroyable\n   * @param e\n   * @returns\n   */\n  public add<R>(e: R): R {\n    this.destructors.push(Destroyable(e));\n    return e;\n  }\n\n  /**\n   * Add many destroyable objects\n   * @param destroyableList\n   * @returns\n   */\n  public many(destroyableList: unknown[]) {\n    destroyableList.forEach((d) => {\n      this.add(d);\n    });\n    return this;\n  }\n\n  public destroy() {\n    this._destroyed = true;\n    this.destructors.forEach((d) => d.destroy());\n    this.destructors.length = 0;\n    return this;\n  }\n\n  public destroyed() {\n    return this._destroyed;\n  }\n\n  public destructor() {\n    return this.destroy.bind(this);\n  }\n}\n","import { ConstructorType } from \"types/ConstructorType\";\n\n/**\n * Handles rejections collection\n */\nexport class Rejections {\n  private catchers: ConstructorType<[unknown]>[] = [];\n  private lastRejectReason: unknown = null;\n\n  public reject = (reason: unknown) => {\n    this.lastRejectReason = reason;\n    this.catchers.forEach((catcher) => {\n      catcher(reason);\n    });\n  };\n\n  public catch(rejected: ConstructorType<[unknown]>) {\n    if (this.lastRejectReason !== null) {\n      rejected(this.lastRejectReason);\n    }\n    this.catchers.push(rejected);\n    return this;\n  }\n\n  public destroy() {\n    this.catchers.length = 0;\n    return this;\n  }\n}\n","import { isFilled } from \"helpers/guards\";\nimport { ConstructorType } from \"types/ConstructorType\";\n\nexport const ResetSilenceCache = Symbol(\"reset-silence-cache\");\n\n/**\n * Silence is null or undefined or duplicated values\n * Everything else is not silence\n *\n * @url https://silentium.pw/article/silence/view\n */\nexport function Silence<T>(resolve: ConstructorType<[T]>) {\n  let lastValue: T | undefined;\n  return (v: T | undefined) => {\n    if (v === ResetSilenceCache) {\n      lastValue = undefined;\n      v = undefined;\n    }\n    if (isFilled(v) && v !== lastValue) {\n      lastValue = v;\n      resolve(v);\n    }\n  };\n}\n","import { isMessage } from \"helpers/guards\";\n\nexport function ensureFunction(v: unknown, label: string) {\n  if (typeof v !== \"function\") {\n    throw new Error(`${label}: is not function`);\n  }\n}\n\nexport function ensureMessage(v: unknown, label: string) {\n  if (!isMessage(v)) {\n    throw new Error(`${label}: is not message`);\n  }\n}\n","import { DestroyContainer } from \"base/DestroyContainer\";\nimport { Rejections } from \"base/Rejections\";\nimport { Silence } from \"base/Silence\";\nimport { ensureFunction } from \"helpers/ensures\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { DestroyableType } from \"types/DestroyableType\";\nimport { MessageType } from \"types/MessageType\";\n\nexport type MessageExecutorType<T> = (\n  resolve: ConstructorType<[T]>,\n  reject: ConstructorType<[unknown]>,\n) => MessageType | (() => void) | void;\n\n/**\n * A message created from an executor function.\n * The executor function can return a message destruction function.\n *\n * @url https://silentium.pw/article/message/view\n */\nexport function Message<T>(executor: MessageExecutorType<T>) {\n  return new MessageImpl<T>(executor);\n}\n\n/**\n * Reactive message implementation\n *\n * @url https://silentium.pw/article/message/view\n */\nexport class MessageImpl<T> implements MessageType<T>, DestroyableType {\n  private rejections = new Rejections();\n  private dc = DestroyContainer();\n\n  public constructor(private executor: MessageExecutorType<T>) {\n    ensureFunction(executor, \"Message: executor\");\n  }\n\n  public then(resolve: ConstructorType<[T]>) {\n    if (this.dc.destroyed()) {\n      return this;\n    }\n    try {\n      this.dc.add(this.executor(Silence(resolve), this.rejections.reject));\n    } catch (e: any) {\n      this.rejections.reject(e);\n    }\n    return this;\n  }\n\n  public catch(rejected: ConstructorType<[unknown]>) {\n    if (this.dc.destroyed()) {\n      return this;\n    }\n    this.rejections.catch(rejected);\n    return this;\n  }\n\n  public destroy() {\n    this.dc.destroy();\n    this.rejections.destroy();\n    return this;\n  }\n}\n","import { Message } from \"base/Message\";\n\n/**\n * Helps convert a value into a message\n */\nexport function Of<T>(value: T) {\n  return Message<T>(function OfImpl(r) {\n    r(value);\n  });\n}\n","import { Of } from \"base/Of\";\nimport { isMessage } from \"helpers/guards\";\nimport { MaybeMessage, MessageType } from \"types/MessageType\";\n\n/**\n * A function that helps to ensure that\n * the message is indeed a message object\n * and not just a value\n *\n * @url https://silentium.pw/article/actual/view\n */\nexport function Actual<T>(message: MaybeMessage<T>): MessageType<T> {\n  return isMessage(message) ? message : Of(message);\n}\n","import { DestroyContainer } from \"base/DestroyContainer\";\nimport { Message } from \"base/Message\";\nimport { MessageType } from \"types/MessageType\";\n\n/**\n * First message - is main\n * others will be destroyed when first\n * will be destroyed\n *\n * @url https://silentium.pw/article/connected/view\n */\nexport function Connected<T>(...m: MessageType[]) {\n  const dc = DestroyContainer();\n  dc.many(m);\n  return Message<T>((resolve, reject) => {\n    (m[0] as MessageType<T>).catch(reject).then(resolve);\n    m.slice(1).forEach((other) => {\n      other.catch(reject);\n    });\n\n    return dc.destructor();\n  });\n}\n","import { Actual } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { MaybeMessage } from \"types/MessageType\";\n\n/**\n * Create local copy of source what can be destroyed\n */\nexport function Local<T>(_base: MaybeMessage<T>) {\n  const $base = Actual(_base);\n  return Message<T>(function LocalImpl(resolve, reject) {\n    let destroyed = false;\n    $base.then((v) => {\n      if (!destroyed) {\n        resolve(v);\n      }\n    });\n    $base.catch(reject);\n    return () => {\n      destroyed = true;\n    };\n  });\n}\n","import { Message, MessageExecutorType, MessageImpl } from \"base/Message\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { MessageType } from \"types/MessageType\";\nimport { MessageSourceType } from \"types/SourceType\";\n\n/**\n * Base message source object\n * https://silentium.pw/article/message-source/view\n */\nexport function Source<T>(\n  messageExecutor: MessageExecutorType<T>,\n  sourceExecutor: ConstructorType<[T]>,\n) {\n  return new SourceImpl(messageExecutor, sourceExecutor);\n}\n\nexport class SourceImpl<T> implements MessageSourceType<T> {\n  private message: MessageImpl<T>;\n\n  public constructor(\n    messageExecutor: MessageExecutorType<T>,\n    private sourceExecutor: ConstructorType<[T]>,\n  ) {\n    this.message = Message(messageExecutor);\n  }\n\n  public use(value: T): this {\n    this.sourceExecutor(value);\n    return this;\n  }\n\n  public then(resolved: ConstructorType<[T]>): this {\n    this.message.then(resolved);\n    return this;\n  }\n\n  public catch(rejected: ConstructorType<[unknown]>): this {\n    this.message.catch(rejected);\n    return this;\n  }\n\n  public destroy() {\n    this.message.destroy();\n    return this;\n  }\n\n  public chain(m: MessageType<T>) {\n    m.then(this.use.bind(this));\n    return this;\n  }\n}\n","import { Message } from \"base/Message\";\nimport { ConstructorType } from \"types/ConstructorType\";\n\n/**\n * A component that, on each access, returns a new instance\n * of a reference type based on the constructor function\n *\n * @url https://silentium.pw/article/new-component/view\n */\nexport function New<T>(construct: ConstructorType<[], T>) {\n  return Message<T>(function NewImpl(resolve) {\n    resolve(construct());\n  });\n}\n","/**\n * Resolver that does nothing with the passed value,\n * needed for silent message triggering\n */\nexport function Void() {\n  return () => {};\n}\n","import { Actual } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { MaybeMessage } from \"types/MessageType\";\n\ntype ExtractTypeS<T> = T extends MaybeMessage<infer U> ? U : never;\n\ntype ExtractTypesFromArrayS<T extends MaybeMessage<any>[]> = {\n  [K in keyof T]: ExtractTypeS<T[K]>;\n};\n\nconst isAllFilled = (keysFilled: Set<string>, keysKnown: Set<string>) => {\n  return keysFilled.size > 0 && keysFilled.size === keysKnown.size;\n};\n\n/**\n * A message that represents values from\n * all provided messages as an array.\n * When all messages emit their values,\n * the combined value will be returned.\n * If at least one message later emits a new\n * value, the updated array with the new value\n * will be emitted by All.\n *\n * @url https://silentium.pw/article/all-component/view\n */\nexport function All<const T extends MaybeMessage[]>(...messages: T) {\n  const $messages = messages.map(Actual);\n  return Message<ExtractTypesFromArrayS<T>>(function AllImpl(resolve, reject) {\n    const known = new Set<string>(Object.keys(messages));\n    const filled = new Set<string>();\n    const result: unknown[] = [];\n    if (known.size === 0) {\n      resolve([] as ExtractTypesFromArrayS<T>);\n      return;\n    }\n    $messages.map((m, key) => {\n      m.catch(reject);\n      m.then((v) => {\n        filled.add(key.toString());\n        result[key] = v;\n        if (isAllFilled(filled, known)) {\n          resolve(result.slice() as ExtractTypesFromArrayS<T>);\n        }\n      });\n    });\n  });\n}\n","import { Actual } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { MaybeMessage } from \"types/MessageType\";\n\n/**\n * A message that emits values received from\n * any of its bound messages\n *\n * @url https://silentium.pw/article/any-component/view\n */\nexport function Any<const T>(...messages: MaybeMessage<T>[]) {\n  const $messages = messages.map(Actual);\n  return Message<T>(function AnyImpl(resolve, reject) {\n    $messages.forEach((message) => {\n      message.catch(reject);\n      message.then(resolve);\n    });\n  });\n}\n","import { Actual } from \"base/ActualMessage\";\nimport { DestroyContainer } from \"base/DestroyContainer\";\nimport { Message } from \"base/Message\";\nimport { isMessage } from \"helpers/guards\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { MaybeMessage } from \"types/MessageType\";\n\n/**\n * An message that applies a function\n * to the value of the base message\n *\n * @url https://silentium.pw/article/applied/view\n */\nexport function Applied<const T, R>(\n  base: MaybeMessage<T>,\n  applier: ConstructorType<[T], MaybeMessage<R>>,\n) {\n  const $base = Actual(base);\n  return Message<R>(function AppliedImpl(resolve, reject) {\n    const dc = DestroyContainer();\n    $base.catch(reject);\n    $base.then((v) => {\n      const result = applier(v);\n      if (isMessage(result)) {\n        dc.destroy();\n        dc.add(result);\n        result.catch(reject).then(resolve);\n      } else {\n        resolve(result);\n      }\n    });\n  });\n}\n","import { Applied } from \"components/Applied\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { MaybeMessage } from \"types/MessageType\";\n\n/**\n * Allows applying variables from an message that passes an array to a function,\n * where each element of the array will be passed as a separate argument\n *\n * @url https://silentium.pw/article/applied-destructured/view\n */\nexport function Destructured<const T extends any[], R>(\n  $base: MaybeMessage<T>,\n  applier: ConstructorType<any[], R>,\n) {\n  return Applied($base, function DestructuredImpl(args) {\n    return applier(...args);\n  });\n}\n","import { MessageType } from \"types/MessageType\";\n\n/**\n * Helps represent an message as a primitive type, which can be useful\n * for cases when you need to always have a reference to the current value\n * without updating the shared value when the current one changes.\n * For example, this could be used when passing an authorization token.\n * It can also be useful for testing or logging purposes.\n *\n * @url https://silentium.pw/article/primitive/view\n */\nexport function Primitive<T>($base: MessageType<T>, theValue: T | null = null) {\n  return new PrimitiveImpl<T>($base, theValue);\n}\n\nexport class PrimitiveImpl<T> {\n  private touched = false;\n\n  public constructor(\n    private $base: MessageType<T>,\n    private theValue: T | null = null,\n  ) {}\n\n  private ensureTouched() {\n    if (!this.touched) {\n      this.$base.then((v) => {\n        this.theValue = v;\n      });\n    }\n    this.touched = true;\n  }\n\n  public [Symbol.toPrimitive]() {\n    this.ensureTouched();\n    return this.theValue;\n  }\n\n  public primitive() {\n    this.ensureTouched();\n    return this.theValue;\n  }\n\n  public primitiveWithException() {\n    this.ensureTouched();\n    if (this.theValue === null) {\n      throw new Error(\"Primitive value is null\");\n    }\n    return this.theValue;\n  }\n}\n","import { MessageType } from \"types/MessageType\";\nimport { MessageSourceType, SourceType } from \"types/SourceType\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { isDestroyable, isFilled, isSource } from \"helpers/guards\";\nimport { Primitive } from \"components/Primitive\";\n\n/**\n * An information object that helps multiple owners access\n * a single another information object\n *\n * @url https://silentium.pw/article/shared/view\n */\nexport function Shared<T>($base: MessageType<T> | MessageSourceType<T>) {\n  return new SharedImpl<T>($base);\n}\n\nexport class SharedImpl<T> implements MessageSourceType<T> {\n  private resolver = (v: T) => {\n    this.lastV = v;\n    this.resolvers.forEach((r) => {\n      r(v);\n    });\n  };\n  private lastV: T | undefined;\n  private resolvers = new Set<ConstructorType<[T]>>();\n  private source?: SourceType<T>;\n\n  public constructor(private $base: MessageType<T> | MessageSourceType<T>) {\n    if (isSource($base)) {\n      this.source = $base;\n    }\n  }\n\n  public then(resolved: ConstructorType<[T]>) {\n    this.resolvers.add((v) => resolved(v));\n    if (this.resolvers.size === 1) {\n      this.$base.then(this.resolver);\n    } else if (isFilled(this.lastV)) {\n      resolved(this.lastV);\n    }\n    return this;\n  }\n\n  public use(value: T) {\n    if (this.source) {\n      this.source.use(value);\n    } else {\n      this.resolver(value);\n    }\n    return this;\n  }\n\n  public catch(rejected: ConstructorType<[unknown]>) {\n    this.$base.catch(rejected);\n    return this;\n  }\n\n  public destroy() {\n    this.resolvers.clear();\n    if (isDestroyable(this.$base)) {\n      this.$base.destroy();\n    }\n    return this;\n  }\n\n  public value() {\n    return Primitive(this);\n  }\n\n  public chain(m: MessageType<T>) {\n    m.then(this.use.bind(this));\n    return this;\n  }\n}\n","import { Rejections } from \"base/Rejections\";\nimport { Silence } from \"base/Silence\";\nimport { Shared } from \"components/Shared\";\nimport { isFilled } from \"helpers/guards\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { MessageType } from \"types/MessageType\";\nimport { MessageSourceType } from \"types/SourceType\";\n\n/**\n * A component that allows creating linked objects of information and its owner\n * in such a way that if a new value is assigned to the owner, this value\n * will become the value of the linked information source\n * https://silentium-lab.github.io/silentium/#/en/information/of\n */\nexport function Late<T>(v?: T) {\n  return Shared(new LateImpl<T>(v));\n}\n\nexport class LateImpl<T> implements MessageSourceType<T> {\n  private rejections = new Rejections();\n  private lateR: ConstructorType<[T]> | null = null;\n  private notify = () => {\n    if (isFilled(this.v) && this.lateR) {\n      try {\n        this.lateR(this.v);\n      } catch (e: any) {\n        this.rejections.reject(e);\n      }\n    }\n  };\n\n  public constructor(private v?: T) {}\n\n  public then(r: ConstructorType<[T]>): this {\n    if (this.lateR) {\n      throw new Error(\n        \"Late component gets new resolver, when another was already connected!\",\n      );\n    }\n    this.lateR = Silence(r);\n    this.notify();\n    return this;\n  }\n\n  public use(value: T): this {\n    this.v = value;\n    this.notify();\n    return this;\n  }\n\n  public catch(rejected: ConstructorType<[unknown]>) {\n    this.rejections.catch(rejected);\n    return this;\n  }\n\n  public chain(m: MessageType<T>) {\n    m.then(this.use.bind(this));\n    return this;\n  }\n}\n","import { Rejections } from \"base/Rejections\";\nimport { Late } from \"components/Late\";\nimport { MessageType } from \"types/MessageType\";\n\n/**\n * Message with error catched\n * inside another message\n *\n * @url https://silentium.pw/article/catch/view\n */\nexport function Catch<T>($base: MessageType) {\n  const rejections = new Rejections();\n  $base.catch(rejections.reject);\n  const $error = Late<T>();\n  rejections.catch((e) => {\n    $error.use(e as T);\n  });\n\n  return $error;\n}\n","import { Actual } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { MessageType, MessageTypeValue } from \"types/MessageType\";\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\ntype Last<T extends readonly any[]> = T extends readonly [...infer _, infer L]\n  ? L\n  : never;\n\n/**\n * Chains messages together and triggers\n * the last message only when all previous messages\n * have emitted their values. The value of Chain will be the value\n * of the last message. If any messages\n * emit a value again after the overall Chain response was already returned,\n * then Chain emits again with the value of the last message.\n */\nexport function Chain<T extends readonly MessageType[]>(...messages: T) {\n  const $messages = messages.map(Actual);\n  return Message<MessageTypeValue<Last<T>>>(\n    function ChainImpl(resolve, reject) {\n      let $latest: MessageTypeValue<Last<T>> | undefined;\n      const handleMessage = (index: number) => {\n        const message = $messages[index] as Last<T>;\n        message.catch(reject);\n        const next = $messages[index + 1] as Last<T> | undefined;\n        message.then((v) => {\n          oneMessage(v as MessageTypeValue<Last<T>>, next, index);\n        });\n      };\n      function oneMessage(\n        v: MessageTypeValue<Last<T>>,\n        next: Last<T> | undefined,\n        index: number,\n      ) {\n        if (!next) {\n          $latest = v as MessageTypeValue<Last<T>>;\n        }\n        if ($latest) {\n          resolve($latest);\n        }\n        if (next && !$latest) {\n          handleMessage(index + 1);\n        }\n      }\n      handleMessage(0);\n    },\n  );\n}\n","import { All } from \"components/All\";\nimport { Destructured } from \"components/AppliedDestructured\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { MaybeMessage } from \"types/MessageType\";\n\n/**\n * Component what helps to compute\n * poor functions, and represent result\n * as message\n *\n * @url https://silentium.pw/article/computed/view\n */\nexport function Computed<const T extends MaybeMessage<any>[], R>(\n  applier: ConstructorType<any[], R>,\n  ...messages: T\n) {\n  return Destructured(All(...messages), applier);\n}\n","import { Actual } from \"base/ActualMessage\";\nimport { Source } from \"base/MessageSource\";\nimport { All } from \"components/All\";\nimport { Destructured } from \"components/AppliedDestructured\";\nimport { Primitive } from \"components/Primitive\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { ContextType } from \"types/ContextType\";\nimport { MaybeMessage } from \"types/MessageType\";\n\nContext.transport = new Map<any, ConstructorType<[ContextType]>>();\n\n/**\n * The ability to call an external system through\n * sending a message in a standardized format\n * ContextType, the list of transport should be defined via\n * the Context.transport map object\n *\n * @url https://silentium.pw/article/context/view\n */\nexport function Context<T>(\n  name: MaybeMessage<string | symbol>,\n  params: MaybeMessage<ContextType[\"params\"]> = {},\n) {\n  const $msg = Destructured(\n    All(Actual(name), Actual(params)),\n    (name, params) =>\n      ({\n        transport: name,\n        params,\n        result: undefined,\n        error: undefined,\n      }) as ContextType,\n  );\n  return Source<T>(\n    (resolve, reject) => {\n      $msg.then((message) => {\n        const transport = Context.transport.get(message.transport);\n        if (transport === undefined) {\n          throw new Error(`Context: unknown transport ${message.transport}`);\n        }\n        if (!message.result) {\n          message.result = resolve;\n        }\n        if (!message.error) {\n          message.error = reject;\n        }\n        try {\n          transport(message);\n        } catch (error) {\n          reject(error);\n        }\n      });\n    },\n    (value) => {\n      const msg = Primitive($msg).primitive();\n      if (msg === null) {\n        throw new Error(\"Context: sourcing impossible message not existed\");\n      }\n      const transport = Context.transport.get(msg.transport);\n      if (transport === undefined) {\n        throw new Error(`Context: sourcing unknown transport ${msg.transport}`);\n      }\n      transport({\n        ...msg,\n        value,\n      });\n    },\n  );\n}\n","import { Actual } from \"base/ActualMessage\";\nimport { MaybeMessage } from \"types/MessageType\";\nimport { ContextType } from \"types/ContextType\";\nimport { isSource } from \"helpers/guards\";\n\n/**\n * Connects an external message to an Context message chain\n *\n * @url https://silentium.pw/article/context/view\n */\nexport function ContextChain(base: MaybeMessage) {\n  const $base = Actual(base);\n  return (context: ContextType) => {\n    if (context.value && isSource(base)) {\n      base.use(context.value);\n      return;\n    }\n    if (!context.result) {\n      throw new Error(\"ContextChain did not find result field in message\");\n    }\n    $base.then(context.result);\n  };\n}\n","import { Message } from \"base/Message\";\nimport { Context } from \"components/Context\";\nimport { Late } from \"components/Late\";\nimport { ContextType } from \"types/ContextType\";\n\n/**\n * Message for the arrival of a specific Context message\n * for specific transport\n *\n * @url https://silentium.pw/article/context/view\n */\nexport function ContextOf(transport: string) {\n  const $msg = Late<ContextType>();\n  Context.transport.set(transport, $msg.use.bind($msg));\n  return Message<ContextType>((resolve, reject) => {\n    $msg.catch(reject);\n    $msg.then(resolve);\n  });\n}\n","import { Actual } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { Applied } from \"components/Applied\";\nimport { Catch } from \"components/Catch\";\nimport { MaybeMessage, MessageType } from \"types/MessageType\";\n\n/**\n * If base returns error then\n * default will return default value\n *\n * @url https://silentium.pw/article/default/view\n */\nexport function Default<T>(\n  $base: MessageType<T>,\n  _default: MaybeMessage<unknown>,\n) {\n  const $default = Actual(_default);\n  const $defaultAfterError = Applied(Catch($base), () => $default);\n\n  return Message<T>((resolve) => {\n    $base.then(resolve);\n    $defaultAfterError.then(resolve as any);\n  });\n}\n","import { Message } from \"base/Message\";\nimport { Primitive } from \"components/Primitive\";\nimport { MessageType } from \"types/MessageType\";\n\n/**\n * When someone asks message for value\n * if there is no value in message return Error\n * if message exists return value\n *\n * @url https://silentium.pw/article/empty/view\n */\nexport function Empty<T>($base: MessageType<T>) {\n  const p = Primitive($base);\n  return Message<T>((resolve, reject) => {\n    try {\n      p.primitiveWithException();\n      $base.then(resolve).catch(reject);\n    } catch {\n      reject(\"Empty: no value in base message!\");\n    }\n  });\n}\n","import { Message } from \"base/Message\";\nimport { MessageType } from \"types/MessageType\";\n\ntype ExecutorApplier<T> = (executor: (v: T) => void) => (v: T) => void;\n\n/**\n * Applies a value transfer function to the resolver\n * and returns the same value transfer function for the resolver\n * Useful for applying functions like debounced or throttle\n */\nexport function ExecutorApplied<T>(\n  $base: MessageType<T>,\n  applier: ExecutorApplier<T>,\n) {\n  return Message<T>(function ExecutorAppliedImpl(resolve, reject) {\n    $base.catch(reject);\n    $base.then(applier(resolve));\n  });\n}\n","import { Actual } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { MaybeMessage, MessageType } from \"types/MessageType\";\n\n/**\n * Filters values from the source message based on a predicate function,\n * optionally providing a default value when the predicate fails.\n */\nexport function Filtered<T>(\n  base: MaybeMessage<T>,\n  predicate: ConstructorType<[T], boolean>,\n  defaultValue?: T,\n): MessageType<T> {\n  const $base = Actual(base);\n  return Message<T>(function FilteredImpl(resolve, reject) {\n    $base.catch(reject);\n    $base.then((v) => {\n      if (predicate(v)) {\n        resolve(v);\n      } else if (defaultValue !== undefined) {\n        resolve(defaultValue);\n      }\n    });\n  });\n}\n","import { Actual } from \"base/ActualMessage\";\nimport { Computed } from \"components/Computed\";\nimport { MaybeMessage } from \"types/MessageType\";\n\n/**\n * Reduces values of message data to one common value\n */\nexport function Fold<T extends any[], TG>(\n  data: MaybeMessage<T>,\n  reducer: (acc: TG, item: T[number], index: number) => TG,\n  initial: MaybeMessage<TG>,\n) {\n  const $data = Actual(data);\n  const $initial = Actual(initial);\n  return Computed(\n    (data, initial) => data.reduce(reducer, initial),\n    $data,\n    $initial,\n  );\n}\n","import { Message } from \"base/Message\";\nimport { MessageType } from \"types/MessageType\";\n\n/**\n * Message what freezes first known value\n */\nexport function Freeze<T>($base: MessageType<T>, $invalidate?: MessageType<T>) {\n  let freezedValue: T | null = null;\n  return Message<T>(function FreezeImpl(resolve, reject) {\n    $base.catch(reject);\n    $base.then((v) => {\n      if (freezedValue === null) {\n        freezedValue = v;\n      }\n      resolve(freezedValue as T);\n    });\n\n    $invalidate?.then(() => {\n      freezedValue = null;\n    });\n  });\n}\n","import { MaybeMessage } from \"types/MessageType\";\nimport { All } from \"components/All\";\nimport { Actual } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { ConstructorType } from \"types/ConstructorType\";\n\n/**\n * A message derived from event with a different\n * method call interface, based on callbacks.\n * Allows attaching a custom handler to an existing event source\n * and presenting it as a silentium message\n */\nexport function FromEvent<T>(\n  emitter: MaybeMessage<any>,\n  eventName: MaybeMessage<string>,\n  subscribeMethod: MaybeMessage<string>,\n  unsubscribeMethod?: MaybeMessage<string>,\n) {\n  const $emitter = Actual(emitter);\n  const $eventName = Actual(eventName);\n  const $subscribeMethod = Actual(subscribeMethod);\n  const $unsubscribeMethod = Actual(unsubscribeMethod);\n  return Message<T>((resolve, reject) => {\n    $emitter.catch(reject);\n    $eventName.catch(reject);\n    $subscribeMethod.catch(reject);\n    $unsubscribeMethod.catch(reject);\n    let lastR: ConstructorType<[T]> | null = null;\n    const handler = (v: T) => {\n      if (lastR) {\n        lastR(v);\n      }\n    };\n    All($emitter, $eventName, $subscribeMethod).then(\n      ([emitter, eventName, subscribe]) => {\n        lastR = resolve;\n        if (!emitter?.[subscribe]) {\n          return;\n        }\n        emitter[subscribe](eventName, handler);\n      },\n    );\n    return () => {\n      lastR = null;\n      if (!$unsubscribeMethod) {\n        return;\n      }\n      All($emitter, $eventName, $unsubscribeMethod).then(\n        ([emitter, eventName, unsubscribe]) => {\n          emitter?.[unsubscribe as string]?.(eventName, handler);\n        },\n      );\n    };\n  });\n}\n","import { Message } from \"base/Message\";\nimport { isDestroyable } from \"helpers/guards\";\nimport { MessageType } from \"types/MessageType\";\n\n/**\n * Ability to create new messages when they will be needed\n *\n * @url https://silentium.pw/article/lazy/view\n */\nexport function Lazy<T>(constructor: () => MessageType<T>) {\n  return Message((resolve, reject) => {\n    const inst = constructor();\n    inst.catch(reject).then(resolve);\n    return () => {\n      if (isDestroyable(inst)) {\n        inst.destroy();\n      }\n    };\n  });\n}\n","import { MaybeMessage, MessageType } from \"types/MessageType\";\nimport { All } from \"components/All\";\nimport { isMessage } from \"helpers/guards\";\nimport { Of } from \"base/Of\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { Message } from \"base/Message\";\nimport { Actual } from \"base/ActualMessage\";\nimport { DestroyContainer } from \"base/DestroyContainer\";\n\n/**\n * Component that applies an info object constructor to each data item,\n * producing an information source with new values\n *\n * @url https://silentium.pw/article/map/view\n */\nexport function Map<T, TG>(\n  base: MaybeMessage<T[]>,\n  target: ConstructorType<[any], MessageType<TG>>,\n) {\n  const $base = Actual(base);\n  return Message<TG[]>((resolve, reject) => {\n    $base.catch(reject);\n    const infos: MessageType<TG>[] = [];\n    const dc = DestroyContainer();\n    $base.then((v) => {\n      infos.length = 0;\n      dc.destroy();\n      v.forEach((val) => {\n        let $val: MessageType<T> | T = val;\n        if (!isMessage($val as object)) {\n          $val = Of($val);\n        }\n        const info = target($val);\n        dc.add(info);\n        infos.push(info);\n      });\n      All(...infos).then(resolve);\n    });\n  });\n}\n","import { Message } from \"base/Message\";\nimport { MessageType } from \"types/MessageType\";\n\n/**\n * Limits the number of values from the information source\n * to a single value - once the first value is emitted, no more\n * values are delivered from the source\n *\n * @url https://silentium.pw/article/once/view\n */\nexport function Once<T>($base: MessageType<T>) {\n  return Message<T>((resolve, reject) => {\n    let isFilled = false;\n    $base.catch(reject);\n    $base.then((v) => {\n      if (!isFilled) {\n        isFilled = true;\n        resolve(v);\n      }\n    });\n  });\n}\n","import { Actual } from \"base/ActualMessage\";\nimport { MaybeMessage } from \"types/MessageType\";\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\ntype Last<T extends readonly any[]> = T extends readonly [...infer _, infer L]\n  ? L extends (...args: any) => any\n    ? L\n    : never\n  : never;\n\n/**\n * Helps to pipe actors or functions to one common actor\n *\n * @url https://silentium.pw/article/piped/view\n */\nexport function Piped<T extends ((...vars: any) => MaybeMessage)[]>(\n  $m: MaybeMessage,\n  ...c: T\n) {\n  return c.reduce((msg, Constructor) => {\n    return Actual(Constructor(msg));\n  }, Actual($m)) as ReturnType<Last<T>>;\n}\n","import { DestroyContainer } from \"base/DestroyContainer\";\nimport { Message } from \"base/Message\";\nimport { Late } from \"components/Late\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { MessageType } from \"types/MessageType\";\n\nexport function Process<T, R = unknown>(\n  $base: MessageType<T>,\n  builder: ConstructorType<[T], MessageType<R>>,\n) {\n  return Message<R>((resolve, reject) => {\n    const $res = Late<R>();\n    const dc = DestroyContainer();\n\n    $base.then((v) => {\n      dc.destroy();\n      const $msg = builder(v);\n      dc.add($msg);\n      $res.chain($msg);\n      $msg.catch(reject);\n    });\n    $base.catch(reject);\n    $res.then(resolve);\n\n    return () => {\n      dc.destroy();\n    };\n  });\n}\n","import { Actual } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { MaybeMessage } from \"types/MessageType\";\n\n/**\n * First responded message\n *\n * @url https://silentium.pw/article/race/view\n */\nexport function Race<const T extends MaybeMessage[]>(...messages: T) {\n  const $messages = messages.map(Actual);\n  return Message((resolve, reject) => {\n    let responded = false;\n    $messages.forEach(($message) => {\n      $message.catch(reject).then((v) => {\n        if (responded === false) {\n          responded = true;\n          resolve(v);\n        }\n      });\n    });\n  });\n}\n","import { Message } from \"base/Message\";\nimport { MessageType } from \"types/MessageType\";\n\n/**\n * Creates a sequence that accumulates all values from the source into an array,\n * emitting the growing array with each new value.\n */\nexport function Sequence<T>($base: MessageType<T>) {\n  return Message<T[]>((resolve, reject) => {\n    const result: T[] = [];\n    $base.catch(reject);\n    $base.then((v) => {\n      result.push(v);\n      resolve(result.slice());\n    });\n  });\n}\n","import { Actual } from \"base/ActualMessage\";\nimport { Message } from \"base/Message\";\nimport { MaybeMessage } from \"types/MessageType\";\n\n/**\n * Component that receives a data array and yields values one by one\n */\nexport function Stream<T>(base: MaybeMessage<T[]>) {\n  const $base = Actual(base);\n  return Message<T>((resolve, reject) => {\n    $base.catch(reject);\n    $base.then((v) => {\n      v.forEach((cv) => {\n        resolve(cv);\n      });\n    });\n  });\n}\n","import { Void } from \"base/Void\";\nimport { Context } from \"components/Context\";\n\n/**\n * Track creation and destruction of components\n * uses Context component to send messages\n * when created sends action=created\n * when destroyed sends action=destroyed\n *\n * @url https://silentium.pw/article/trackable/view\n */\nexport function Trackable(name: string, target: object) {\n  Context(\"trackable\", { name, action: \"created\" }).then(Void());\n  return new Proxy(target, {\n    get(target, prop, receiver) {\n      if (prop === \"then\") {\n        Context(\"trackable\", { name, action: \"executed\" }).then(Void());\n      }\n      if (prop === \"destroy\") {\n        Context(\"trackable\", { name, action: \"destroyed\" }).then(Void());\n      }\n      return Reflect.get(target, prop, receiver);\n    },\n  });\n}\n","import { Primitive } from \"components/Primitive\";\nimport { MessageType } from \"types/MessageType\";\n\n/**\n * Component what will return same proxied object\n * but with value property\n *\n * @url https://silentium.pw/article/value/view\n */\nexport function Value<T>(\n  target: MessageType<T>,\n): MessageType<T> & { value: T | null } {\n  const p = Primitive(target);\n  return new Proxy(target, {\n    get(target, prop, receiver) {\n      if (prop === \"value\") {\n        return p.primitive();\n      }\n      return Reflect.get(target, prop, receiver);\n    },\n  }) as MessageType<T> & { value: T | null };\n}\n","import { All } from \"components/All\";\nimport { Applied } from \"components/Applied\";\nimport { Primitive } from \"components/Primitive\";\nimport { Shared } from \"components/Shared\";\nimport { ConstructorType } from \"types/ConstructorType\";\nimport { DestroyableType } from \"types/DestroyableType\";\nimport { MessageType } from \"types/MessageType\";\n\ndeclare global {\n  interface SilentiumDebug {\n    value: ($message: MessageType) => unknown;\n    print: (...messages: MessageType[]) => void;\n    destroyable: (onDestroy: () => void) => MessageType<any> & DestroyableType;\n  }\n\n  interface GlobalThis {\n    silentiumDebug: SilentiumDebug;\n  }\n\n  // @ts-expect-error global variable\n  const silentiumDebug: SilentiumDebug;\n}\n\n/**\n * Helps to print message value\n */\nconst silentiumPrint = (...messages: MessageType[]) => {\n  Applied(All(...messages.map((e) => Shared(e))), JSON.stringify).then(\n    console.log,\n  );\n};\n\n/**\n * Helps to debug current value of message\n */\nconst silentiumValue = ($message: MessageType) =>\n  Primitive($message).primitive();\n\nexport class MessageDestroyable implements MessageType<any>, DestroyableType {\n  public constructor(private onDestroy: () => void) {}\n\n  public then(resolve: ConstructorType<[string]>) {\n    resolve(`Wait destroy ${Date.now()}`);\n    return this;\n  }\n\n  public catch() {\n    return this;\n  }\n\n  public destroy() {\n    this.onDestroy();\n    return this;\n  }\n}\n\n/**\n * Helps to debug destroying\n */\nconst silentiumDestroyable = (onDestroy: () => void) =>\n  new MessageDestroyable(onDestroy);\n\n/**\n * global functions for debuging\n * silentium programs\n */\nexport function DevTools() {\n  if (typeof globalThis !== \"undefined\") {\n    (globalThis as any).silentiumDebug = {\n      value: silentiumValue,\n      print: silentiumPrint,\n      destroyable: silentiumDestroyable,\n    };\n  }\n}\n"],"names":["isFilled","value","isMessage","o","then","isSource","use","isDestroyable","destroy","isDestroyed","destroyed","Destroyable","base","DestroyableImpl","constructor","this","DestroyContainer","DestroyContainerImpl","__publicField","add","e","destructors","push","many","destroyableList","forEach","d","_destroyed","length","destructor","bind","Rejections","reason","lastRejectReason","catchers","catcher","rejected","ResetSilenceCache","Symbol","Silence","resolve","lastValue","v","ensureFunction","label","Error","ensureMessage","Message","executor","MessageImpl","dc","rejections","reject","catch","Of","r","Actual","message","Connected","m","slice","other","Local","_base","$base","Source","messageExecutor","sourceExecutor","SourceImpl","resolved","chain","New","construct","Void","All","messages","$messages","map","known","Set","Object","keys","filled","result","size","key","keysFilled","keysKnown","toString","Any","Applied","applier","Destructured","args","Primitive","theValue","PrimitiveImpl","ensureTouched","touched","toPrimitive","primitive","primitiveWithException","Shared","SharedImpl","lastV","resolvers","source","resolver","clear","Late","LateImpl","lateR","notify","Catch","$error","Chain","$latest","handleMessage","index","next","oneMessage","Computed","Context","name","params","$msg","transport","error","get","msg","ContextChain","context","ContextOf","set","Default","_default","$default","$defaultAfterError","Empty","p","ExecutorApplied","Filtered","predicate","defaultValue","Fold","data","reducer","initial","reduce","Freeze","$invalidate","freezedValue","FromEvent","emitter","eventName","subscribeMethod","unsubscribeMethod","$emitter","$eventName","$subscribeMethod","$unsubscribeMethod","lastR","handler","subscribe","unsubscribe","Lazy","inst","Map","target","infos","val","$val","info","Once","Piped","$m","c","Constructor","Process","builder","$res","Race","responded","$message","Sequence","Stream","cv","Trackable","action","Proxy","prop","receiver","Reflect","Value","silentiumPrint","JSON","stringify","console","log","silentiumValue","MessageDestroyable","onDestroy","Date","now","silentiumDestroyable","DevTools","globalThis","silentiumDebug","print","destroyable"],"mappings":"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"}