var silentium=function(t){"use strict";function e(t){return new r(t)}class r{constructor(t){this.value=t}to(t){return t.use(this.value),this}}const s=t=>null!=t;function n(t){return null!==t&&"object"==typeof t&&"to"in t&&"function"==typeof t.to}function i(t){return null!==t&&"object"==typeof t&&"destroy"in t&&"function"==typeof t.destroy}function o(t){return null!==t&&"object"==typeof t&&"destroyed"in t&&"function"==typeof t.destroy}function a(t){return null!==t&&"object"==typeof t&&"use"in t&&"function"==typeof t.use}function u(t){return n(t)?t:e(t)}class h{constructor(t){this.base=t}destroy(){return i(this.base)&&this.base.destroy(),this}}var l=Object.defineProperty,c=(t,e,r)=>((t,e,r)=>e in t?l(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class p{constructor(){c(this,"destructors",[])}add(t){return i(t)&&this.destructors.push(t),t}destroy(){return this.destructors.forEach((t=>t.destroy())),this.destructors.length=0,this}}function b(t,e){if("function"!=typeof t)throw new Error(`${e}: is not function`)}function f(t,e){if(!n(t))throw new Error(`${e}: is not message`)}function d(t,e){if(!a(t))throw new Error(`${e}: is not transport`)}function m(t){return new y(t)}class y{constructor(t){this.executor=t,b(t,"Transport: transport executor")}use(t){return this.executor(t),this}}class w{constructor(t){this.executor=t,b(t,"TransportMessage: transport executor")}use(t){return this.executor(t)}}function g(t,...e){return new $(t,e)}class ${constructor(t,e=[],r){this.executor=t,this.args=e,this._child=r,b(t,"TransportParent: executor")}use(t){if(void 0===this._child)throw new Error("no base transport");return this.executor.call(this._child,t,...this.args),this}child(t,...e){return new $(this.executor,[...this.args,...e],t)}}var v=Object.defineProperty,T=(t,e,r)=>((t,e,r)=>e in t?v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class P{constructor(t){this.$base=t,T(this,"destroyed",!1),T(this,"transport",g((function(t,e){e.destroyed||this.use(t)}),this)),f(t,"Local: $base")}to(t){return this.$base.to(this.transport.child(t)),this}destroy(){return this.destroyed=!0,this}}var I=Object.defineProperty,O=(t,e,r)=>((t,e,r)=>e in t?I(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);function j(t){return new M(t)}class M{constructor(t){this.executor=t,O(this,"mbDestructor"),b(t,"Message: executor")}to(t){return this.mbDestructor=this.executor(t),this}destroy(){return"function"==typeof this.mbDestructor&&this.mbDestructor?.(),this}}class E{constructor(t){this.base=t}wait(t){return void 0!==this.base&&t.to(this.base),this}}class A{use(){return this}}var x=Object.defineProperty,C=(t,e,r)=>((t,e,r)=>e in t?x(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function S(...t){return new V(...t)}class V{constructor(...t){C(this,"known"),C(this,"filled",new Set),C(this,"$messages"),C(this,"result",[]),C(this,"transport",g((function(t,e,r){var s,n;e.filled.add(r),e.result[parseInt(r)]=t,s=e.filled,n=e.known,s.size>0&&s.size===n.size&&this.use(e.result)}),this)),this.known=new Set(Object.keys(t)),this.$messages=t.map(u)}to(t){return Object.entries(this.$messages).forEach((([e,r])=>{f(r,"All: item"),r.to(this.transport.child(t,e))})),0===this.known.size&&t.use([]),this}}var D=Object.defineProperty,F=(t,e,r)=>((t,e,r)=>e in t?D(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class L{constructor(...t){F(this,"$messages"),this.$messages=t}to(t){return this.$messages.forEach((e=>{f(e,"Any: item"),e.to(t)})),this}}var z=Object.defineProperty,R=(t,e,r)=>((t,e,r)=>e in t?z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);function k(t,e){return new B(u(t),e)}class B{constructor(t,e){this.$base=t,this.applier=e,R(this,"transport",g((function(t,e){this.use(e.applier(t))}),this)),f(t,"Applied: base")}to(t){return this.$base.to(this.transport.child(t)),this}}class N{constructor(t,e,r){this.$base=t,this.errorMessage=e,this.errorOriginal=r,f(t,"Catch: base"),d(e,"Catch: errorMessage"),void 0!==r&&d(r,"Catch: errorOriginal")}to(t){try{this.$base.to(t)}catch(t){t instanceof Error?this.errorMessage.use(t.message):this.errorMessage.use(String(t)),this.errorOriginal&&this.errorOriginal.use(t)}return this}}var _=Object.defineProperty,q=(t,e,r)=>((t,e,r)=>e in t?_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class W{constructor(...t){q(this,"$messages"),q(this,"$latest"),q(this,"handleMessage",((t,e)=>{const r=this.$messages[t],s=this.$messages[t+1];r.to(this.oneMessageTransport.child(e,s,t))})),q(this,"oneMessageTransport",g((function(t,e,r,s){r||(e.$latest=t),e.$latest&&this.use(e.$latest),r&&!e.$latest&&e.handleMessage(s+1,this)}),this)),this.$messages=t}to(t){return this.handleMessage(0,t),this}}class G{constructor(t,e){this.$base=t,this.applier=e,f(t,"ExecutorApplied: base")}to(t){const e=this.applier(t.use.bind(t));return this.$base.to(m(e)),this}}var H=Object.defineProperty,J=(t,e,r)=>((t,e,r)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class K{constructor(t,e,r){this.$base=t,this.predicate=e,this.defaultValue=r,J(this,"parent",g((function(t,e){e.predicate(t)?this.use(t):void 0!==e.defaultValue&&this.use(e.defaultValue)}),this))}to(t){return this.$base.to(this.parent.child(t)),this}}var Q=Object.defineProperty,U=(t,e,r)=>((t,e,r)=>e in t?Q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class X{constructor(t,e,r,s){this.$emitter=t,this.$eventName=e,this.$subscribeMethod=r,this.$unsubscribeMethod=s,U(this,"lastTransport",null),U(this,"handler",(t=>{this.lastTransport&&this.lastTransport.use(t)})),U(this,"parent",g((function([t,e,r],s){s.lastTransport=this,t?.[r]&&t[r](e,s.handler)}),this))}to(t){return S(this.$emitter,this.$eventName,this.$subscribeMethod).to(this.parent.child(t)),this}destroy(){return this.lastTransport=null,this.$unsubscribeMethod?(S(this.$emitter,this.$eventName,this.$unsubscribeMethod).to(m((([t,e,r])=>{t?.[r]?.(e,this.handler)}))),this):this}}class Y{constructor(t,e){this.p=t,this.error=e}to(t){return this.p.then((e=>{t.use(e)})).catch((t=>{this.error?.use(t)})),this}}var Z=Object.defineProperty,tt=(t,e,r)=>((t,e,r)=>e in t?Z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function et(t){return new rt(t)}class rt{constructor(t){this.v=t,tt(this,"lateTransport",null),tt(this,"notify",(t=>{s(t)&&this.lateTransport&&this.lateTransport.use(t)}))}to(t){if(this.lateTransport)throw new Error("Late component gets new transport, when another was already connected!");return this.lateTransport=t,this.notify(this.v),this}use(t){return this.notify(t),this}}var st=Object.defineProperty,nt=(t,e,r)=>((t,e,r)=>e in t?st(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function it(t){return new ot(t)}class ot{constructor(t){this.$base=t,nt(this,"isFilled",!1),nt(this,"parent",g((function(t,e){e.isFilled||(e.isFilled=!0,this.use(t))}),this))}to(t){return this.$base.to(this.parent.child(t)),this}}var at=Object.defineProperty,ut=(t,e,r)=>((t,e,r)=>e in t?at(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class ht{constructor(){ut(this,"transports"),ut(this,"innerTransport"),this.transports=new Set,this.innerTransport=m((t=>{this.transports.forEach((e=>{o(e)&&e.destroyed()?this.transports.delete(e):e.use(t)}))}))}transport(){return this.innerTransport}size(){return this.transports.size}has(t){return this.transports.has(t)}add(t){return this.transports.add(t),this}remove(t){return this.transports.delete(t),this}destroy(){return this.transports.forEach((t=>{this.remove(t)})),this}}var lt=Object.defineProperty,ct=(t,e,r)=>((t,e,r)=>e in t?lt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function pt(t,e=!1){return new bt(t,e)}class bt{constructor(t,e=!1){this.$base=t,this.stateless=e,ct(this,"transportPool",new ht),ct(this,"lastValue"),ct(this,"calls",et()),ct(this,"firstCallTransport",m((t=>{this.lastValue=t,this.transportPool.transport().use(t)}))),it(this.calls).to(m((()=>{this.$base.to(this.firstCallTransport)})))}to(t){return this.calls.use(1),this.stateless||!s(this.lastValue)||this.transportPool.has(t)||t.use(this.lastValue),this.transportPool.add(t),this}use(t){return this.calls.use(1),this.lastValue=t,this.transportPool.transport().use(t),this}touched(){this.calls.use(1)}pool(){return this.transportPool}destroy(){return this.transportPool.destroy()}}var ft=Object.defineProperty,dt=(t,e,r)=>((t,e,r)=>e in t?ft(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);function mt(t,e=!1){return new yt(t,e)}class yt{constructor(t,e=!1){this.$base=t,dt(this,"$sharedBase"),this.$sharedBase=pt(this.$base,e)}to(t){return this.$sharedBase.to(t),this}use(t){return this.$sharedBase.touched(),this.$base.use(t),this}}var wt=Object.defineProperty,gt=(t,e,r)=>((t,e,r)=>e in t?wt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);function $t(t,e=null){return new vt(t,e)}class vt{constructor(t,e=null){this.$base=t,this.theValue=e,gt(this,"touched",!1)}ensureTouched(){this.touched||this.$base.to(m((t=>{this.theValue=t}))),this.touched=!0}[Symbol.toPrimitive](){return this.ensureTouched(),this.theValue}primitive(){return this.ensureTouched(),this.theValue}primitiveWithException(){if(this.ensureTouched(),null===this.theValue)throw new Error("Primitive value is null");return this.theValue}}var Tt=Object.defineProperty,Pt=(t,e,r)=>((t,e,r)=>e in t?Tt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function It(t){return new Ot(t)}class Ot{constructor(t){Pt(this,"$msg"),Pt(this,"primitive"),this.$msg=mt(et(t)),this.primitive=$t(this,t)}to(t){return this.$msg.to(t),this}use(t){return this.$msg.use(t),this}value(){return this.primitive}}var jt=Object.defineProperty,Mt=(t,e,r)=>((t,e,r)=>e in t?jt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class Et{constructor(t,r){this.$base=t,this.$target=r,Mt(this,"parent",g((function(t,r){const s=[];t.forEach((t=>{let i=t;n(i)||(i=e(i));const o=r.$target.use(i);s.push(o)})),S(...s).to(this)}),this))}to(t){return this.$base.to(this.parent.child(t)),this}}var At=Object.defineProperty,xt=(t,e,r)=>((t,e,r)=>e in t?At(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function Ct(t){return new St(u(t))}Ct.transport={};class St{constructor(t){this.$rpc=t,xt(this,"$result",It()),xt(this,"$error",It())}result(){return this.$rpc.to(m((t=>{const e=void 0===t.transport?Ct.transport.default:Ct.transport[t.transport]||Ct.transport.default;if(!e)throw new Error(`RPCImpl: Transport not found ${t.transport}`);t.result||(t.result=this.$result),t.error||(t.error=this.$error),e.use(t)}))),this.$result}error(){return this.$error}}var Vt=Object.defineProperty,Dt=(t,e,r)=>((t,e,r)=>e in t?Vt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class Ft{constructor(t){this.$base=t,Dt(this,"result",[]),Dt(this,"parent",g((function(t,e){e.result.push(t),this.use(e.result)}),this))}to(t){return this.$base.to(this.parent.child(t)),this}}var Lt=Object.defineProperty,zt=(t,e,r)=>((t,e,r)=>e in t?Lt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class Rt{constructor(t){this.$base=t,zt(this,"parent",g((function(t){t.forEach((t=>{this.use(t)}))})))}to(t){return this.$base.to(this.parent.child(t)),this}}class kt{constructor(t,e){this.baseTransport=t,this.applier=e}use(t){return this.applier(this.baseTransport.use(t))}}class Bt{constructor(t,e,r=0){this.baseTransport=t,this.args=e,this.startFromArgIndex=r}use(t){return this.baseTransport.use(function(t,e,r){const s=t.slice(0,r);for(;s.length<r;)s.push(void 0);return s.concat(e)}(t,this.args,this.startFromArgIndex))}}var Nt=Object.defineProperty,_t=(t,e,r)=>((t,e,r)=>e in t?Nt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class qt{constructor(t){this.baseTransport=t,_t(this,"destructors",[])}use(t){const e=this.baseTransport.use(t);return i(e)&&this.destructors.push(e),e}destroy(){return this.destructors.forEach((t=>t.destroy())),this}}return t.ActualMessage=u,t.All=S,t.AllImpl=V,t.Any=function(...t){return new L(...t.map(u))},t.AnyImpl=L,t.Applied=k,t.AppliedDestructured=function(t,e){return k(t,(t=>e(...t)))},t.AppliedImpl=B,t.Catch=function(t,e,r){return new N(t,e,r)},t.CatchImpl=N,t.Chain=function(...t){return new W(...t)},t.ChainImpl=W,t.DestroyContainer=function(){return new p},t.DestroyContainerImpl=p,t.Destroyable=function(t){return new h(t)},t.DestroyableImpl=h,t.ExecutorApplied=function(t,e){return new G(t,e)},t.ExecutorAppliedImpl=G,t.Filtered=function(t,e,r){return new K(u(t),e,r)},t.FilteredImpl=K,t.FromEvent=function(t,e,r,s){return new X(u(t),u(e),u(r),u(s))},t.FromEventImpl=X,t.FromPromise=function(t,e){return new Y(t,e)},t.FromPromiseImpl=Y,t.Late=et,t.LateImpl=rt,t.LateShared=It,t.LateSharedImpl=Ot,t.Local=function(t){return new P(u(t))},t.LocalImpl=P,t.Map=function(t,e){return new Et(u(t),e)},t.MapImpl=Et,t.Message=j,t.MessageImpl=M,t.New=function(t){return j((e=>{e.use(t())}))},t.Of=e,t.OfImpl=r,t.Once=it,t.OnceImpl=ot,t.Primitive=$t,t.PrimitiveImpl=vt,t.RPC=Ct,t.RPCChain=function(t){return m((e=>{if(!e.result)throw new Error("RPCChain did not find result in rpc message");u(t).to(e.result)}))},t.RPCImpl=St,t.RPCOf=function(t){const e=It();return Ct.transport[t]=e,j((t=>{e.to(t)}))},t.Sequence=function(t){return new Ft(t)},t.SequenceImpl=Ft,t.Shared=pt,t.SharedImpl=bt,t.SharedSource=mt,t.SharedSourceImpl=yt,t.Stream=function(t){return new Rt(t)},t.StreamImpl=Rt,t.Transport=m,t.TransportApplied=function(t,e){return new kt(t,e)},t.TransportAppliedImpl=kt,t.TransportArgs=function(t,e,r=0){return new Bt(t,e,r)},t.TransportArgsImpl=Bt,t.TransportDestroyable=function(t){return new qt(t)},t.TransportDestroyableImpl=qt,t.TransportImpl=y,t.TransportMessage=function(t){return new w(t)},t.TransportMessageImpl=w,t.TransportOptional=function(t){return new E(t)},t.TransportOptionalImpl=E,t.TransportParent=g,t.TransportParentImpl=$,t.TransportPool=ht,t.Void=function(){return new A},t.VoidImpl=A,t.ensureFunction=b,t.ensureMessage=f,t.ensureTransport=d,t.isDestroyable=i,t.isDestroyed=o,t.isFilled=s,t.isMessage=n,t.isTransport=a,t}({});
