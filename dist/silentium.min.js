!function(e){"use strict";const t=(e,t)=>{if(null==e)throw new Error("value didn't receive source argument");if(void 0===t||null===e)throw new Error("value didn't receive guest argument");return"function"==typeof e?e(t):"object"==typeof e&&"value"in e&&"function"==typeof e.value?e.value(t):n(e,t),e},r=(e,r)=>{if(null==e)throw new Error("value didn't receive source argument");if(void 0===r||null===e)throw new Error("value didn't receive guest argument");return Array.isArray(r)?r.forEach((r=>{t(e,r)})):t(e,r),e},o=e=>null!==e&&"object"==typeof e&&"value"in e&&"function"==typeof e.value||null!=e,i=e=>{if(void 0===e)throw new Error("Source constructor didn't receive executor function");return t=>{r(e,t)}},n=(e,t)=>{if(void 0===e)throw new Error("give didn't receive data argument");return void 0===t?i(e):("function"==typeof t?t(e):t.give(e),t)},s=e=>{if(!e)throw new Error("receiver function was not passed to Guest constructor");const t={give:r=>(e(r),t)};return t},u=e=>{let t=!1;return()=>{t||e(),t=!0}},c=(e,t)=>{if(void 0===e)throw new Error("GuestCast didn't receive sourceGuest argument");if(void 0===t)throw new Error("GuestCast didn't receive targetGuest argument");const r={disposed(t){const r=e;return!!r.disposed&&r.disposed(t)},give:e=>(n(e,t),r),introduction:()=>"function"==typeof e?"guest":e.introduction?e.introduction():"guest"};return r},a=e=>{const t={give:r=>(e=r,t),value(){if(void 0===e)throw new Error("no value in GuestSync!");return e}};return t},d=(e,t)=>{const r={give:o=>(n(t(o),e),r)};return r},l=(e,t)=>({give:t((t=>n(t,e)))}),h=e=>{let t=100;return"priority"in e&&"function"==typeof e.priority&&(t=e.priority()),t},v=e=>"object"==typeof e&&null!==e&&"patron"===e?.introduction?.(),p=()=>"patron",f=e=>{if(void 0===e)throw new Error("Patron didn't receive willBePatron argument");const t={give:r=>(n(r,e),t),disposed(t){const r=e;return r?.disposed?.(t)||!1},introduction:p};return t},g=e=>({...f(e),priority:()=>200}),m=e=>{if(void 0===e)throw new Error("PatronOnce didn't receive baseGuest argument");let t=!1;const r={give:o=>(t||(t=!0,n(o,e)),r),disposed(r){if(t)return!0;const o=e;return!!o.disposed&&o.disposed(r)},introduction:p};return r};var y=Object.defineProperty,w=(e,t,r)=>((e,t,r)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class E{constructor(){w(this,"items"),w(this,"sortedItems"),this.items=new Map,this.sortedItems=[]}findInsertPosition(e){let t=0,r=this.sortedItems.length;for(;t<r;){const o=Math.floor((t+r)/2);this.sortedItems[o].priority>=e?t=o+1:r=o}return t}findItemIndex(e){return this.sortedItems.findIndex((t=>t.value===e))}add(e,t=100){const r=this.items.get(e);if(r){if(r.priority!==t){const o=this.findItemIndex(e);-1!==o&&this.sortedItems.splice(o,1),r.priority=t;const i=this.findInsertPosition(t);this.sortedItems.splice(i,0,r)}}else{const r={value:e,priority:t};this.items.set(e,r);const o=this.findInsertPosition(t);this.sortedItems.splice(o,0,r)}return this}delete(e){if(!this.items.get(e))return!1;this.items.delete(e);const t=this.findItemIndex(e);return-1!==t&&this.sortedItems.splice(t,1),!0}has(e){return this.items.has(e)}get size(){return this.items.size}clear(){this.items.clear(),this.sortedItems=[]}getPriority(e){const t=this.items.get(e);return t?.priority}setPriority(e,t){return!!this.items.has(e)&&(this.add(e,t),!0)}forEach(e){this.sortedItems.forEach((t=>{e(t.value,t.priority,this)}))}values(){return this.sortedItems.map((e=>e.value))[Symbol.iterator]()}entries(){return this.sortedItems.map((e=>[e.value,e.priority]))[Symbol.iterator]()}[Symbol.iterator](){return this.values()}toArray(){return this.sortedItems.map((e=>e.value))}toArrayWithPriorities(){return[...this.sortedItems]}debug(){console.log("Map size:",this.items.size),console.log("Sorted array length:",this.sortedItems.length),console.log("Sorted items:",this.sortedItems)}}var b=Object.defineProperty,S=(e,t,r)=>((e,t,r)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const P=new Map,I=new Map,G=new Map,z=new Map,A=[],M=()=>{A.forEach((e=>e()))},C={poolsCount:0,patronsCount:0},j=i((e=>{n(C,e),A.push((()=>{let t=0;P.forEach((e=>{t+=e.size})),C.poolsCount=P.size,C.patronsCount=t,n(C,e)}))})),D=(e,t)=>(G.has(t)||G.set(t,[]),z.has(e)||z.set(e,[]),G.get(t)?.push(e),z.get(e)?.push(t),e),O=(e,t)=>(t.forEach((t=>{D(e,t)})),e),x=e=>"object"==typeof e&&null!==e&&"destroy"in e&&"function"==typeof e.destroy,F=(...e)=>{e.forEach((e=>{x(e)&&e.destroy();const t=I.get(e);t?.destroy();const r=G.get(e);G.delete(e),r&&F(...r)}))},V=(...e)=>{e.forEach((e=>{F(e);const t=z.get(e);t&&V(...t)}))},k=e=>{if(void 0===e)throw new Error("removePatronFromPools didn't receive patron argument");P.forEach((t=>{t.delete(e)})),M()};class q{constructor(e){this.initiator=e,S(this,"patrons"),S(this,"give"),this.patrons=new E,P.set(this,this.patrons),I.set(this.initiator,this);const t=e=>{this.patrons.forEach((t=>{this.sendValueToGuest(e,t)}))};this.give=e=>(t(e),this),M()}size(){return this.patrons.size}add(e){if(void 0===e)throw new Error("PatronPool add method received nothing!");return"function"!=typeof e&&e.introduction&&"patron"===e.introduction()&&this.patrons.add(e,h(e)),M(),this}remove(e){return this.patrons.delete(e),M(),this}distribute(e,t){return this.add(t),this.sendValueToGuest(e,t),this}destroy(){return this.patrons.forEach((e=>{this.remove(e)})),P.delete(this),I.delete(this.initiator),M(),this}sendValueToGuest(e,t){return this.guestDisposed(e,t)||n(e,t),this}guestDisposed(e,t){return!!t.disposed?.(e)&&(this.remove(t),!0)}}const R=(e,t)=>new Proxy(e,{get:(e,r)=>"name"===r?t:e[r]}),T=(e,t)=>{const o=a(t);r(e,g(o));const i={value(t){return r(e,t),this},syncValue(){try{return o.value()}catch{throw new Error("No value in SourceSync")}}};return D(i,e),i},N=e=>null==e,W=e=>{const t={},i=new q(t);let n=N(e);return!n&&o(e)&&r(e,m((t=>{n=N(t),e=t}))),t.value=r=>n?(v(r)&&i.add(r),t):("function"==typeof r?i.distribute(e,s(r)):i.distribute(e,r),t),t.give=r=>(n=N(r),e=r,n||i.give(e),t),t},B=e=>{const t=new Set(Object.keys(e)),o=new Set,i=W({}),a=[],d=u((()=>{Object.entries(e).forEach((([e,n])=>{D(i,n),t.add(e);const u=R(g((t=>{i.value(s((r=>{o.add(e);const n={...r,[e]:t};i.give(n)})))})),"all_key-patron");a.push(u),r(n,u)}))}));return{value(e){d();const r=R(c(e,(r=>{o.size>0&&o.size===t.size&&n(Object.values(r),e)})),"mb-patron");a.push(r),i.value(r)},destroy(){a.forEach((e=>{k(e)})),F(i)}}},L=(e,t)=>{if(void 0===e)throw new Error("SourceDynamic didn't receive baseGuest argument");if(void 0===t)throw new Error("SourceDynamic didn't receive baseSource argument");const o={value:e=>(r(t,e),o),give(t){return n(t,e),this}};return o},_=(e,t)=>{const o=W(),i=u((()=>{r(t,g((()=>{n(null,o)}))),r(e,g(o)),D(o,e)}));return L(o.give,(e=>{i(),o.value(e)}))};e.PatronPool=q,e.allPatrons=()=>{let e=[];return P.forEach((t=>{e=e.concat(Array.from(t.values()))})),e},e.destroy=F,e.destroyFromSubSource=V,e.firstVisit=u,e.give=n,e.guest=s,e.guestApplied=d,e.guestCast=c,e.guestDisposable=(e,t)=>{if(void 0===e)throw new Error("GuestDisposable didn't receive guest argument");if(void 0===t)throw new Error("GuestDisposable didn't receive disposeCheck argument");const r={disposed:e=>t(e),give:t=>(n(t,e),r)};return r},e.guestExecutorApplied=l,e.guestSync=a,e.introduction=p,e.isDestroyable=x,e.isGuest=e=>{if(void 0===e)throw new Error("isGuest didnt receive mbGuest argument");return"function"==typeof e||"function"==typeof e?.give},e.isPatron=v,e.isPatronInPools=e=>{if(void 0===e)throw new Error("isPatronInPools didn't receive patron argument");let t=!1;return P.forEach((r=>{t||(t=r.has(e))})),t},e.isSource=o,e.lazy=e=>{if(void 0===e)throw new Error("lazy didn't receive buildingFn argument");return{get:(...t)=>e(...t)}},e.lazyClass=(e,t={})=>{if(void 0===e)throw new Error("PrivateClass didn't receive constructorFn argument");return{get:(...r)=>new e(...r,t)}},e.patron=f,e.patronApplied=(e,t)=>{const r=d(e,t),o={give:e=>(r.give(e),o),introduction:p};return o},e.patronExecutorApplied=(e,t)=>{const r=l(e,t),o={give:e=>(r.give(e),o),introduction:p};return o},e.patronOnce=m,e.patronPools=e=>{const t=[];return P.forEach(((r,o)=>{r.has(e)&&t.push(o)})),t},e.patronPoolsStatistic=j,e.patronPriority=h,e.removePatronFromPools=k,e.source=i,e.sourceAll=B,e.sourceAny=e=>{const t=W(),o=u((()=>{e.forEach((e=>{r(e,g(t)),D(t,e)}))})),i=e=>{o(),t.value(e)};return O(i,e),i},e.sourceApplied=(e,t)=>{const o=o=>{r(e,c(o,(e=>{n(t(e),o)})))};return D(o,e),o},e.sourceChain=(...e)=>{const t=W(),o=new WeakMap,i=n=>{const s=e[n],u=e[n+1];r(s,g((e=>{let c=s;"object"==typeof s&&null!==s||"function"==typeof s||Array.isArray(s)||(c={source:s}),u&&r(t,t),u?o.has(c)||i(n+1):t.give(e),o.set(c,1)})))},n=u((()=>{i(0)})),s=e=>{n(),t.value(e)};return O(s,e),O(t,e),s},e.sourceCombined=(...e)=>t=>{const o=W();return O(o,e),r(B(e),g((e=>{t(o.give,...e)}))),o.value},e.sourceDestroyable=e=>{let t=null;const r={value(r){return t=e(r),this},destroy(){return null!==t&&"function"==typeof t&&t(),this}};return D(r,e),r},e.sourceDynamic=L,e.sourceExecutorApplied=(e,t)=>o=>{r(e,c(o,t((e=>{n(e,o)}))))},e.sourceFiltered=(e,t,o)=>i=>{r(e,c(i,(e=>{!0===t(e)?n(e,i):void 0!==o&&n(o,i)})))},e.sourceLazy=(e,t,o)=>{let i=null;const n=W(),s=_(n,o??W());let u=!1;o&&r(o,g((()=>{F(i),i=null})));const c=o=>{var a;a=c,u||(u=!0,r(B(t),g((()=>{i||(i=e.get(...t),r(i,g(n)),D(n,a),D(s,a))})))),r(s,o)};return c},e.sourceMap=(e,t)=>{if(void 0===e)throw new Error("SourceMap didn't receive baseSource argument");if(void 0===t)throw new Error("SourceMap didn't receive targetSource argument");const o=W(),i=u((()=>{r(e,g((i=>{const s=[];i.forEach((r=>{const o=t.get(r);D(o,e),s.push(o)})),r(B(s),m((e=>{F(...s),n(e,o)})))})))})),s=e=>{i(),o.value(e)};return D(o,s),s},e.sourceMemoOf=e=>{const t=W(e),r=T(t,null),o={value:t.value,give:e=>(r.syncValue()!==e&&n(e,t.give),o)};return e?(D(o,e),D(r,e),D(t,e)):(D(t,o),D(r,o)),o},e.sourceOf=W,e.sourceOnce=e=>{let t=void 0!==e;const o=W(e);return{value(e){return r(o,e),this},give(e){return t||(o.give(e),t=!0),this},destroy(){F(o)}}},e.sourceRace=e=>{if(void 0===e)throw new Error("SourceRace didnt receive sources argument");return t=>{let o=null;e.forEach((e=>{r(e,c(t,(r=>{o&&o!==e||(n(r,t),o=e)})))}))}},e.sourceResettable=_,e.sourceSequence=(e,t)=>{if(void 0===e)throw new Error("SourceSequence didn't receive baseSource argument");if(void 0===t)throw new Error("SourceSequence didn't receive targetSource argument");const i=i=>{const s=W(),u=t.get(s);D(s,e),r(e,c(i,(t=>{let c=0;const a=[];t.forEach((()=>{const t=W();a.push(t),D(t,e)}));const d=()=>{void 0!==t[c+1]&&(c+=1,l())};function l(){const e=a[c],i=t[c];o(i)?r(i,m((t=>{s.give(t),r(u,e),d()}))):(s.give(i),r(u,e),d())}void 0!==t[c]?(l(),r(B(a),i)):n([],i)})))};return D(i,e),i},e.sourceSync=T,e.subSource=D,e.subSourceMany=O,e.systemPatron=g,e.value=r,e.withName=R,e.withPriority=(e,t)=>({...e,priority:()=>t})}({});
