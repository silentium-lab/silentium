var silentium=function(t){"use strict";var e=Object.defineProperty,r=(t,r,s)=>((t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s)(t,r+"",s);class s{constructor(){r(this,"destructors",[])}add(t){return this.destructors.push(t),t}destroy(){return this.destructors.forEach((t=>t.destroy())),this}}const n=t=>null!=t;function i(t){return null!==t&&"object"==typeof t&&"event"in t&&"function"==typeof t.event}function o(t){return null!==t&&"object"==typeof t&&"destroy"in t&&"function"==typeof t.destroy}function a(t){return null!==t&&"object"==typeof t&&"destroyed"in t&&"function"==typeof t.destroy}function u(t){return null!==t&&"object"==typeof t&&"use"in t&&"function"==typeof t.use}function h(t,e){if("function"!=typeof t)throw new Error(`${e}: is not function`)}function l(t,e){if(!i(t))throw new Error(`${e}: is not event`)}function c(t,e){if(!u(t))throw new Error(`${e}: is not transport`)}var p=Object.defineProperty,v=(t,e,r)=>((t,e,r)=>e in t?p(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class b{constructor(t){this.eventExecutor=t,v(this,"mbDestructor"),h(t,"Event: eventExecutor")}event(t){return this.mbDestructor=this.eventExecutor(t),this}destroy(){return"function"==typeof this.mbDestructor&&this.mbDestructor?.(),this}}function f(t){return new d(t)}class d{constructor(t){this.transportExecutor=t,h(t,"Transport: transport executor")}use(t){return this.transportExecutor(t),this}}class y{constructor(t){this.executor=t,h(t,"TransportEvent: transport executor")}use(t){return this.executor(t)}}function m(t,...e){return new w(t,e)}class w{constructor(t,e=[],r){this.executor=t,this.args=e,this._child=r,h(t,"TransportParent: executor")}use(t){if(void 0===this._child)throw new Error("no base transport");return this.executor.call(this._child,t,...this.args),this}child(t,...e){return new w(this.executor,[...this.args,...e],t)}}var $=Object.defineProperty,E=(t,e,r)=>((t,e,r)=>e in t?$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class g{constructor(t){this.$base=t,E(this,"destroyed",!1),E(this,"transport",m((function(t,e){e.destroyed||this.use(t)}),this)),l(t,"Local: $base")}event(t){return this.$base.event(this.transport.child(t)),this}destroy(){return this}}function T(t){return new P(t)}class P{constructor(t){this.value=t}event(t){return t.use(this.value),this}}class O{use(){return this}}var j=Object.defineProperty,x=(t,e,r)=>((t,e,r)=>e in t?j(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function A(...t){return new C(...t)}class C{constructor(...t){x(this,"known"),x(this,"filled",new Set),x(this,"$events"),x(this,"result",[]),x(this,"transport",m((function(t,e,r){var s,n;e.filled.add(r),e.result[parseInt(r)]=t,s=e.filled,n=e.known,s.size>0&&s.size===n.size&&this.use(e.result)}),this)),this.known=new Set(Object.keys(t)),this.$events=t}event(t){return Object.entries(this.$events).forEach((([e,r])=>{l(r,"All: item"),r.event(this.transport.child(t,e))})),0===this.known.size&&t.use([]),this}}var S=Object.defineProperty,V=(t,e,r)=>((t,e,r)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class F{constructor(...t){V(this,"$events"),this.$events=t}event(t){return this.$events.forEach((e=>{l(e,"Any: item"),e.event(t)})),this}}var I=Object.defineProperty,M=(t,e,r)=>((t,e,r)=>e in t?I(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class D{constructor(t,e){this.$base=t,this.applier=e,M(this,"transport",m((function(t,e){this.use(e.applier(t))}),this)),l(t,"Applied: base")}event(t){return this.$base.event(this.transport.child(t)),this}}class L{constructor(t,e,r){this.$base=t,this.errorMessage=e,this.errorOriginal=r,l(t,"Catch: base"),c(e,"Catch: errorMessage"),void 0!==r&&c(r,"Catch: errorOriginal")}event(t){try{this.$base.event(t)}catch(t){t instanceof Error?this.errorMessage.use(t.message):this.errorMessage.use(String(t)),this.errorOriginal&&this.errorOriginal.use(t)}return this}}var z=Object.defineProperty,k=(t,e,r)=>((t,e,r)=>e in t?z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class B{constructor(...t){k(this,"$events"),k(this,"$latest"),k(this,"handleEvent",((t,e)=>{const r=this.$events[t],s=this.$events[t+1];r.event(this.oneEventTransport.child(e,s,t))})),k(this,"oneEventTransport",m((function(t,e,r,s){r||(e.$latest=t),e.$latest&&this.use(e.$latest),r&&!e.$latest&&e.handleEvent(s+1,this)}),this)),this.$events=t}event(t){return this.handleEvent(0,t),this}}class R{constructor(t,e){this.$base=t,this.applier=e,l(t,"ExecutorApplied: base")}event(t){const e=this.applier(t.use.bind(t));return this.$base.event(f(e)),this}}var N=Object.defineProperty,_=(t,e,r)=>((t,e,r)=>e in t?N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);function q(t,e,r){return new W(t,e,r)}class W{constructor(t,e,r){this.$base=t,this.predicate=e,this.defaultValue=r,_(this,"parent",m((function(t,e){e.predicate(t)?this.use(t):void 0!==e.defaultValue&&this.use(e.defaultValue)}),this))}event(t){return this.$base.event(this.parent.child(t)),this}}var G=Object.defineProperty,H=(t,e,r)=>((t,e,r)=>e in t?G(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class J{constructor(t,e,r,s){this.$emitter=t,this.$eventName=e,this.$subscribeMethod=r,this.$unsubscribeMethod=s,H(this,"lastTransport",null),H(this,"handler",(t=>{this.lastTransport&&this.lastTransport.use(t)})),H(this,"parent",m((function([t,e,r],s){s.lastTransport=this,t?.[r]&&t[r](e,s.handler)}),this))}event(t){return A(this.$emitter,this.$eventName,this.$subscribeMethod).event(this.parent.child(t)),this}destroy(){return this.lastTransport=null,this.$unsubscribeMethod?(A(this.$emitter,this.$eventName,this.$unsubscribeMethod).event(f((([t,e,r])=>{t?.[r]?.(e,this.handler)}))),this):this}}class K{constructor(t,e){this.p=t,this.error=e}event(t){return this.p.then((e=>{t.use(e)})).catch((t=>{this.error?.use(t)})),this}}var Q=Object.defineProperty,U=(t,e,r)=>((t,e,r)=>e in t?Q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function X(t){return new Y(t)}class Y{constructor(t){this.v=t,U(this,"lateTransport",null),U(this,"notify",(t=>{n(t)&&this.lateTransport&&this.lateTransport.use(t)}))}event(t){if(this.lateTransport)throw new Error("Late component gets new transport, when another was already connected!");return this.lateTransport=t,this.notify(this.v),this}use(t){return this.notify(t),this}}var Z=Object.defineProperty,tt=(t,e,r)=>((t,e,r)=>e in t?Z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function et(t){return new rt(t)}class rt{constructor(t){this.$base=t,tt(this,"isFilled",!1),tt(this,"parent",m((function(t,e){e.isFilled||(e.isFilled=!0,this.use(t))}),this))}event(t){return this.$base.event(this.parent.child(t)),this}}var st=Object.defineProperty,nt=(t,e,r)=>((t,e,r)=>e in t?st(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class it{constructor(){nt(this,"transports"),nt(this,"innerTransport"),this.transports=new Set,this.innerTransport=f((t=>{this.transports.forEach((e=>{a(e)&&e.destroyed()?this.transports.delete(e):e.use(t)}))}))}transport(){return this.innerTransport}size(){return this.transports.size}has(t){return this.transports.has(t)}add(t){return this.transports.add(t),this}remove(t){return this.transports.delete(t),this}destroy(){return this.transports.forEach((t=>{this.remove(t)})),this}}var ot=Object.defineProperty,at=(t,e,r)=>((t,e,r)=>e in t?ot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function ut(t,e=!1){return new ht(t,e)}class ht{constructor(t,e=!1){this.$base=t,this.stateless=e,at(this,"transportPool",new it),at(this,"lastValue"),at(this,"calls",X()),at(this,"firstCallTransport",f((t=>{this.lastValue=t,this.transportPool.transport().use(t)}))),et(this.calls).event(f((()=>{this.$base.event(this.firstCallTransport)})))}event(t){return this.calls.use(1),this.stateless||!n(this.lastValue)||this.transportPool.has(t)||t.use(this.lastValue),this.transportPool.add(t),this}use(t){return this.calls.use(1),this.lastValue=t,this.transportPool.transport().use(t),this}touched(){this.calls.use(1)}pool(){return this.transportPool}destroy(){return this.transportPool.destroy()}}var lt=Object.defineProperty,ct=(t,e,r)=>((t,e,r)=>e in t?lt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);function pt(t,e=!1){return new vt(t,e)}class vt{constructor(t,e=!1){this.$base=t,ct(this,"$sharedBase"),this.$sharedBase=ut(this.$base,e)}event(t){return this.$sharedBase.event(t),this}use(t){return this.$sharedBase.touched(),this.$base.use(t),this}}var bt=Object.defineProperty,ft=(t,e,r)=>((t,e,r)=>e in t?bt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);function dt(t,e=null){return new yt(t,e)}class yt{constructor(t,e=null){this.$base=t,this.theValue=e,ft(this,"touched",!1)}ensureTouched(){this.touched||this.$base.event(f((t=>{this.theValue=t}))),this.touched=!0}[Symbol.toPrimitive](){return this.ensureTouched(),this.theValue}primitive(){return this.ensureTouched(),this.theValue}primitiveWithException(){if(this.ensureTouched(),null===this.theValue)throw new Error("Primitive value is null");return this.theValue}}var mt=Object.defineProperty,wt=(t,e,r)=>((t,e,r)=>e in t?mt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function $t(t){return new Et(t)}class Et{constructor(t){wt(this,"$event"),wt(this,"primitive"),this.$event=pt(X(t)),this.primitive=dt(this,t)}event(t){return this.$event.event(t),this}use(t){return this.$event.use(t),this}value(){return this.primitive}}var gt=Object.defineProperty,Tt=(t,e,r)=>((t,e,r)=>e in t?gt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class Pt{constructor(t,e){this.$base=t,this.$target=e,Tt(this,"parent",m((function(t,e){const r=[];t.forEach((t=>{let s=t;i(s)||(s=T(s));const n=e.$target.use(s);r.push(n)})),A(...r).event(this)}),this))}event(t){return this.$base.event(this.parent.child(t)),this}}var Ot=Object.defineProperty,jt=(t,e,r)=>((t,e,r)=>e in t?Ot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class xt{constructor(t){this.$base=t,jt(this,"result",[]),jt(this,"parent",m((function(t,e){e.result.push(t),this.use(e.result)}),this))}event(t){return this.$base.event(this.parent.child(t)),this}}var At=Object.defineProperty,Ct=(t,e,r)=>((t,e,r)=>e in t?At(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class St{constructor(t){this.$base=t,Ct(this,"parent",m((function(t){t.forEach((t=>{this.use(t)}))})))}event(t){return this.$base.event(this.parent.child(t)),this}}class Vt{constructor(t,e){this.baseTransport=t,this.applier=e}use(t){return this.applier(this.baseTransport.use(t))}}class Ft{constructor(t,e,r=0){this.baseTransport=t,this.args=e,this.startFromArgIndex=r}use(t){return this.baseTransport.use(function(t,e,r){const s=t.slice(0,r);for(;s.length<r;)s.push(void 0);return s.concat(e)}(t,this.args,this.startFromArgIndex))}}var It=Object.defineProperty,Mt=(t,e,r)=>((t,e,r)=>e in t?It(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class Dt{constructor(t){this.baseTransport=t,Mt(this,"destructors",[])}use(t){const e=this.baseTransport.use(t);return o(e)&&this.destructors.push(e),e}destroy(){return this.destructors.forEach((t=>t.destroy())),this}}var Lt=Object.defineProperty,zt=(t,e,r)=>((t,e,r)=>e in t?Lt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function kt(t){return new Bt(t)}kt.transport={};class Bt{constructor(t){this.$rpc=t,zt(this,"$result",$t()),zt(this,"$error",$t())}result(){return this.$rpc.event(f((t=>{const e=void 0===t.transport?kt.transport.default:kt.transport[t.transport]||kt.transport.default;if(!e)throw new Error(`RPCImpl: Transport not found ${t.transport}`);t.result||(t.result=this.$result),t.error||(t.error=this.$error),e.use(t)}))),this.$result}error(){return this.$error}}return t.All=A,t.AllEvent=C,t.Any=function(...t){return new F(...t)},t.AnyEvent=F,t.Applied=function(t,e){return new D(t,e)},t.AppliedEvent=D,t.Catch=function(t,e,r){return new L(t,e,r)},t.CatchEvent=L,t.Chain=function(...t){return new B(...t)},t.ChainEvent=B,t.Component=function(t){return(...e)=>{let r;return{event(s){return r=t.call(s,...e),this},destroy(){return void 0!==r&&r(),this}}}},t.ComponentClass=function(t){return(...e)=>new t(...e)},t.DestroyContainer=function(){return new s},t.DestroyContainerImpl=s,t.Event=function(t){return new b(t)},t.EventImpl=b,t.ExecutorApplied=function(t,e){return new R(t,e)},t.ExecutorAppliedEvent=R,t.Filtered=q,t.FilteredEvent=W,t.FromEvent=function(t,e,r,s){return new J(t,e,r,s)},t.FromEventAdapter=J,t.FromPromise=function(t,e){return new K(t,e)},t.FromPromiseEvent=K,t.Late=X,t.LateEvent=Y,t.LateShared=$t,t.LateSharedEvent=Et,t.Local=function(t){return new g(t)},t.LocalEvent=g,t.Map=function(t,e){return new Pt(t,e)},t.MapEvent=Pt,t.Of=T,t.OfEvent=P,t.Once=et,t.OnceEvent=rt,t.Primitive=dt,t.PrimitiveImpl=yt,t.RPC=kt,t.RPCImpl=Bt,t.RPCOf=function(t,e){return q(t,(t=>t.transport===e))},t.Sequence=function(t){return new xt(t)},t.SequenceEvent=xt,t.Shared=ut,t.SharedEvent=ht,t.SharedSource=pt,t.SharedSourceEvent=vt,t.Stream=function(t){return new St(t)},t.StreamEvent=St,t.Transport=f,t.TransportApplied=function(t,e){return new Vt(t,e)},t.TransportAppliedImpl=Vt,t.TransportArgs=function(t,e,r=0){return new Ft(t,e,r)},t.TransportArgsImpl=Ft,t.TransportDestroyable=function(t){return new Dt(t)},t.TransportDestroyableEvent=Dt,t.TransportEvent=function(t){return new y(t)},t.TransportParent=m,t.TransportParentImpl=w,t.TransportPool=it,t.Void=function(){return new O},t.VoidImpl=O,t.ensureEvent=l,t.ensureFunction=h,t.ensureTransport=c,t.isDestroyable=o,t.isDestroyed=a,t.isEvent=i,t.isFilled=n,t.isTransport=u,t}({});
