var silentium=function(t){"use strict";var e=Object.defineProperty,n=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);class r{constructor(){n(this,"catchers",[]),n(this,"lastRejectReason",null),n(this,"reject",(t=>{this.lastRejectReason=t,this.catchers.forEach((e=>{e(t)}))}))}catch(t){return null!==this.lastRejectReason&&t(this.lastRejectReason),this.catchers.push(t),this}destroy(){return this.catchers.length=0,this}}const s=t=>null!=t;function i(t){return null!==t&&"object"==typeof t&&"then"in t&&"function"==typeof t.then}function o(t){return null!==t&&"object"==typeof t&&"destroy"in t&&"function"==typeof t.destroy}function c(t,e){if("function"!=typeof t)throw new Error(`${e}: is not function`)}var u=Object.defineProperty,h=(t,e,n)=>((t,e,n)=>e in t?u(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n);function a(t){return new l(t)}class l{constructor(t){this.executor=t,h(this,"mbDestructor"),h(this,"rejections",new r),c(t,"Message: executor")}then(t){try{this.mbDestructor=this.executor(t,this.rejections.reject)}catch(t){this.rejections.reject(t)}return this}catch(t){return this.rejections.catch(t),this}destroy(){return"function"==typeof this.mbDestructor&&this.mbDestructor?.(),this.rejections.destroy(),this}}function f(t){return a((function(e){e(t)}))}function d(t){return i(t)?t:f(t)}class b{constructor(t){this.base=t}destroy(){return o(this.base)&&this.base.destroy(),this}}var p=Object.defineProperty,y=(t,e,n)=>((t,e,n)=>e in t?p(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,e+"",n);function m(){return new v}class v{constructor(){y(this,"destructors",[])}add(t){return o(t)&&this.destructors.push(t),t}destroy(){return this.destructors.forEach((t=>t.destroy())),this.destructors.length=0,this}}var w=Object.defineProperty,j=(t,e,n)=>((t,e,n)=>e in t?w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,e+"",n);class g{constructor(t,e){this.sourceExecutor=e,j(this,"message"),this.message=a(t)}use(t){return this.sourceExecutor(t),this}then(t){return this.message.then(t),this}catch(t){return this.message.catch(t),this}}function E(...t){const e=t.map(d);return a((function(n){const r=new Set(Object.keys(t)),s=new Set,i=[];0!==r.size?e.map(((t,e)=>{t.then((t=>{var o,c;s.add(e.toString()),i[e]=t,c=r,(o=s).size>0&&o.size===c.size&&n(i)}))})):n([])}))}function R(t,e){const n=d(t);return a((function(t){n.then((n=>{t(e(n))}))}))}var x=Object.defineProperty,S=(t,e,n)=>((t,e,n)=>e in t?x(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n);function C(t){return new D(t)}class D{constructor(t){this.v=t,S(this,"rejections",new r),S(this,"lateR",null),S(this,"notify",(()=>{if(s(this.v)&&this.lateR)try{this.lateR(this.v)}catch(t){this.rejections.reject(t)}}))}then(t){if(this.lateR)throw new Error("Late component gets new resolver, when another was already connected!");return this.lateR=t,this.notify(),this}use(t){return this.v=t,this.notify(),this}catch(t){return this.rejections.catch(t),this}}function O(t){const e=d(t);return a(((t,n)=>{e.then((e=>{const r=O.transport.get(e.transport);if(void 0===r)throw new Error(`Context: unknown transport ${e.transport}`);e.result||(e.result=t),e.error||(e.error=n);try{r(e)}catch(t){n(t)}}))}))}O.transport=new Map;var P=Object.defineProperty,V=(t,e,n)=>((t,e,n)=>e in t?P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,e+"",n);function M(t,e=null){return new $(t,e)}class ${constructor(t,e=null){this.$base=t,this.theValue=e,V(this,"touched",!1)}ensureTouched(){this.touched||this.$base.then((t=>{this.theValue=t})),this.touched=!0}[Symbol.toPrimitive](){return this.ensureTouched(),this.theValue}primitive(){return this.ensureTouched(),this.theValue}primitiveWithException(){if(this.ensureTouched(),null===this.theValue)throw new Error("Primitive value is null");return this.theValue}}var A=Object.defineProperty,I=(t,e,n)=>((t,e,n)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n);function z(t,e){return new L(t,e)}class L{constructor(t,e){this.$base=t,this.source=e,I(this,"resolver",(t=>{this.lastV=t,this.resolvers.forEach((e=>{e(t)}))})),I(this,"lastV"),I(this,"resolvers",new Set)}then(t){return this.resolvers.add(t),1===this.resolvers.size?this.$base.then(this.resolver):s(this.lastV)&&t(this.lastV),this}use(t){return this.source?this.source.use(t):this.resolver(t),this}catch(t){return this.$base.catch(t),this}destroy(){return this.resolvers.clear(),this}value(){return M(this)}chain(t){return t.then(this.use.bind(this)),this}}function F(t){const e=C(t);return z(e,e)}return t.ActualMessage=d,t.All=E,t.Any=function(...t){const e=t.map(d);return a((function(t){e.forEach((e=>{e.then(t)}))}))},t.Applied=R,t.AppliedDestructured=function(t,e){return R(t,(function(t){return e(...t)}))},t.Catch=function(t){const e=new r;t.catch(e.reject);const n=C();return e.catch((t=>{n.use(t)})),n},t.Chain=function(...t){const e=t.map(d);return a((function(t){let n;const r=s=>{const i=e[s],o=e[s+1];i.then((e=>{!function(e,s,i){s||(n=e);n&&t(n);s&&!n&&r(i+1)}(e,o,s)}))};r(0)}))},t.Context=O,t.ContextChain=function(t){return e=>{if(!e.result)throw new Error("ContextChain did not find result in rpc message");d(t).then(e.result)}},t.ContextOf=function(t){const e=F();return O.transport.set(t,e.use.bind(e)),a((t=>{e.then(t)}))},t.DestroyContainer=m,t.DestroyContainerImpl=v,t.Destroyable=function(t){return new b(t)},t.DestroyableImpl=b,t.ExecutorApplied=function(t,e){return a((function(n){t.then(e(n))}))},t.Filtered=function(t,e,n){const r=d(t);return a((function(t){r.then((r=>{e(r)?t(r):void 0!==n&&t(n)}))}))},t.FromEvent=function(t,e,n,r){const s=d(t),i=d(e),o=d(n),c=d(r);return a((t=>{let e=null;const n=t=>{e&&e(t)};return E(s,i,o).then((([r,s,i])=>{e=t,r?.[i]&&r[i](s,n)})),()=>{e=null,c&&E(s,i,c).then((([t,e,r])=>{t?.[r]?.(e,n)}))}}))},t.Late=C,t.LateImpl=D,t.LateShared=F,t.Local=function(t){const e=d(t);return a((function(t){let n=!1;return e.then((e=>{n||t(e)})),()=>{n=!0}}))},t.Map=function(t,e){const n=d(t);return a((t=>{const r=[],s=m();n.then((n=>{s.destroy(),n.forEach((t=>{let n=t;i(n)||(n=f(n));const o=e(n);s.add(o),r.push(o)})),E(...r).then(t)}))}))},t.Message=a,t.MessageRx=l,t.MessageSource=function(t,e){return new g(t,e)},t.MessageSourceImpl=g,t.New=function(t){return a((function(e){e(t())}))},t.Of=f,t.Once=function(t){return a((e=>{let n=!1;t.then((t=>{n||(n=!0,e(t))}))}))},t.Primitive=M,t.PrimitiveImpl=$,t.Rejections=r,t.Sequence=function(t){return a((e=>{const n=[];t.then((t=>{n.push(t),e(n)}))}))},t.Shared=z,t.SharedImpl=L,t.Stream=function(t){const e=d(t);return a((t=>{e.then((e=>{e.forEach((e=>{t(e)}))}))}))},t.Void=function(){return()=>{}},t.ensureFunction=c,t.ensureMessage=function(t,e){if(!i(t))throw new Error(`${e}: is not message`)},t.isDestroyable=o,t.isDestroyed=function(t){return null!==t&&"object"==typeof t&&"destroyed"in t&&"function"==typeof t.destroyed},t.isFilled=s,t.isMessage=i,t}({});
