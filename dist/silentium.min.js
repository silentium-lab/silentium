!function(e,t){"use strict";const s=e=>null!=e;function r(e){return null!==e&&"object"==typeof e&&"event"in e&&"function"==typeof e.event}function i(e){return null!==e&&"object"==typeof e&&"destroy"in e&&"function"==typeof e.destroy}function n(e){return null!==e&&"object"==typeof e&&"use"in e&&"function"==typeof e.use}function h(e,t){if("function"!=typeof e)throw new Error(`${t}: is not function`)}function o(e,t){if(!r(e))throw new Error(`${t}: is not event`)}function a(e,t){if(!n(e))throw new Error(`${t}: is not user`)}var u=Object.defineProperty,l=(e,t,s)=>((e,t,s)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);var c=Object.defineProperty,b=(e,t,s)=>((e,t,s)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);var v=Object.defineProperty,d=(e,t,s)=>((e,t,s)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class f{constructor(e){this.value=e}event(e){return e.use(this.value),this}}var p=Object.defineProperty,w=(e,t,s)=>((e,t,s)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class y{constructor(){w(this,"owners"),w(this,"innerOwner"),this.owners=new Set,this.innerOwner=new $((e=>{this.owners.forEach((t=>{t.use(e)}))}))}owner(){return this.innerOwner}size(){return this.owners.size}has(e){return this.owners.has(e)}add(e){return this.owners.add(e),this}remove(e){return this.owners.delete(e),this}destroy(){return this.owners.forEach((e=>{this.remove(e)})),this}}class ${constructor(e){this.userExecutor=e,h(e,"User: user executor")}use(e){return this.userExecutor(e),this}}class m{constructor(e,t=[],s){this.userExecutor=e,this.args=t,this.childUser=s,h(e,"ParentUser: executor")}use(e){if(void 0===this.childUser)throw new Error("no base user");return this.userExecutor(e,this.childUser,...this.args),this}child(e,...t){return new m(this.userExecutor,[...this.args,...t],e)}}var g=Object.defineProperty,E=(e,t,s)=>((e,t,s)=>t in e?g(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class O{constructor(...e){E(this,"keysKnown"),E(this,"keysFilled",new Set),E(this,"$events"),E(this,"result",{}),E(this,"user",new m(((e,t,s)=>{var r,i;this.keysFilled.add(s),this.result[s]=e,r=this.keysFilled,i=this.keysKnown,r.size>0&&r.size===i.size&&t.use(Object.values(this.result))}))),this.keysKnown=new Set(Object.keys(e)),this.$events=e}event(e){return Object.entries(this.$events).forEach((([t,s])=>{o(s,"All: item"),this.keysKnown.add(t),s.event(this.user.child(e,t))})),this}}var P=Object.defineProperty,j=(e,t,s)=>((e,t,s)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);var U=Object.defineProperty,V=(e,t,s)=>((e,t,s)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);var x=Object.defineProperty,T=(e,t,s)=>((e,t,s)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);var F=Object.defineProperty,A=(e,t,s)=>((e,t,s)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);var M=Object.defineProperty,S=(e,t,s)=>((e,t,s)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);var C=Object.defineProperty,k=(e,t,s)=>((e,t,s)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class D{constructor(e){this.v=e,k(this,"lateUser",null),k(this,"notify",(e=>{s(e)&&this.lateUser&&this.lateUser.use(e)}))}event(e){if(this.lateUser)throw new Error("Late component gets new user, when another was already connected!");return this.lateUser=e,this.notify(this.v),this}use(e){return this.notify(e),this}}var z=Object.defineProperty,L=(e,t,s)=>((e,t,s)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class B{constructor(e){this.$base=e,L(this,"isFilled",!1),L(this,"parent",new m(((e,t)=>{this.isFilled||(this.isFilled=!0,t.use(e))})))}event(e){return this.$base.event(this.parent.child(e)),this}}var K=Object.defineProperty,N=(e,t,s)=>((e,t,s)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class I{constructor(e,t=!1){this.$base=e,this.stateless=t,N(this,"ownersPool",new y),N(this,"lastValue"),N(this,"calls",new D),N(this,"firstCall",new B(this.calls).event(new $((()=>{this.$base.event(this.firstCallUser)})))),N(this,"firstCallUser",new $((e=>{this.lastValue=e,this.ownersPool.owner().use(e)})))}event(e){return this.calls.use(1),this.stateless||!s(this.lastValue)||this.ownersPool.has(e)||e.use(this.lastValue),this.ownersPool.add(e),this}use(e){return this.calls.use(1),this.lastValue=e,this.ownersPool.owner().use(e),this}touched(){this.calls.use(1)}pool(){return this.ownersPool}destroy(){return this.ownersPool.destroy()}}var q=Object.defineProperty,W=(e,t,s)=>((e,t,s)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);class G{constructor(e,t=!1){this.$base=e,W(this,"$sharedBase"),this.$sharedBase=new I(this.$base,t)}event(e){return this.$sharedBase.event(e),this}use(e){return this.$sharedBase.touched(),this.$base.use(e),this}}var H=Object.defineProperty,J=(e,t,s)=>((e,t,s)=>t in e?H(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);var Q=Object.defineProperty,R=(e,t,s)=>((e,t,s)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);var X=Object.defineProperty,Y=(e,t,s)=>((e,t,s)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);class Z{constructor(e,t=null){this.$base=e,this.theValue=t,Y(this,"touched",!1)}ensureTouched(){this.touched||this.$base.event(new $((e=>{this.theValue=e}))),this.touched=!0}[Symbol.toPrimitive](){return this.ensureTouched(),this.theValue}primitive(){return this.ensureTouched(),this.theValue}primitiveWithException(){if(this.ensureTouched(),null===this.theValue)throw new Error("Primitive value is null");return this.theValue}}var _=Object.defineProperty,ee=(e,t,s)=>((e,t,s)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);var te=Object.defineProperty,se=(e,t,s)=>((e,t,s)=>t in e?te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);var re=Object.defineProperty,ie=(e,t,s)=>((e,t,s)=>t in e?re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);e.All=O,e.Any=class{constructor(...e){j(this,"$events"),this.$events=e}event(e){return this.$events.forEach((t=>{o(t,"Any: item"),t.event(e)})),this}},e.Applied=class{constructor(e,t){this.$base=e,this.applier=t,V(this,"user",new m(((e,t)=>{t.use(this.applier(e))}))),o(e,"Applied: base")}event(e){return this.$base.event(this.user.child(e)),this}},e.Catch=class{constructor(e,t,s){this.$base=e,this.errorMessage=t,this.errorOriginal=s,o(e,"Catch: base"),a(t,"Catch: errorMessage"),void 0!==s&&a(s,"Catch: errorOriginal")}event(e){try{this.$base.event(e)}catch(e){e instanceof Error?this.errorMessage.use(e.message):this.errorMessage.use(e),this.errorOriginal&&this.errorOriginal.use(e)}return this}},e.Chain=class{constructor(...e){T(this,"$events"),T(this,"lastValue"),T(this,"handleEvent",((e,t)=>{const s=this.$events[e],r=this.$events[e+1];s.event(this.oneEventUser.child(t,r,e))})),T(this,"oneEventUser",new m(((e,t,s,r)=>{s||(this.lastValue=e),this.lastValue&&t.use(this.lastValue),s&&!this.lastValue&&this.handleEvent(r+1,t)}))),this.$events=e}event(e){return this.handleEvent(0,e),this}},e.DestroyContainer=class{constructor(){l(this,"destructors",[])}add(e){return this.destructors.push(e),this}destroy(){return this.destructors.forEach((e=>e.destroy())),this}},e.Event=class{constructor(e){this.eventExecutor=e,b(this,"mbDestructor"),h(e,"Event: eventExecutor")}event(e){return this.mbDestructor=this.eventExecutor(e),this}destroy(){return"function"==typeof this.mbDestructor&&this.mbDestructor?.(),this}},e.ExecutorApplied=class{constructor(e,t){this.$base=e,this.applier=t,o(e,"ExecutorApplied: base")}event(e){const t=this.applier(e);return this.$base.event(t),this}},e.Filtered=class{constructor(e,t,s){this.$base=e,this.predicate=t,this.defaultValue=s,A(this,"parent",new m(((e,t)=>{this.predicate(e)?t.use(e):void 0!==this.defaultValue&&t.use(this.defaultValue)})))}event(e){return this.$base.event(this.parent.child(e)),this}},e.FromEvent=class{constructor(e,t,s,r){this.$emitter=e,this.$eventName=t,this.$subscribeMethod=s,this.$unsubscribeMethod=r,S(this,"lastUser",null),S(this,"handler",(e=>{this.lastUser&&this.lastUser.use(e)})),S(this,"parent",new m((([e,t,s],r)=>{this.lastUser=r,e?.[s]&&e[s](t,this.handler)})))}event(e){return new O(this.$emitter,this.$eventName,this.$subscribeMethod).event(this.parent.child(e)),this}destroy(){if(this.lastUser=null,!this.$unsubscribeMethod)return this;return new O(this.$emitter,this.$eventName,this.$unsubscribeMethod).event(new $((([e,t,s])=>{e?.[s]?.(t,this.handler)}))),this}},e.FromPromise=class{constructor(e,t){this.p=e,this.errorOwner=t}event(e){return this.p.then((function(t){e.use(t)})).catch((e=>{this.errorOwner?.use(e)})),this}},e.Late=D,e.LateShared=class{constructor(e){J(this,"$event"),this.$event=new G(new D(e))}event(e){return this.$event.event(e),this}use(e){return this.$event.use(e),this}},e.Local=class{constructor(e){this.$base=e,d(this,"destroyed",!1),d(this,"user",new m(((e,t)=>{this.destroyed||t.use(e)}))),o(e,"Local: $base")}event(e){return this.$base.event(this.user.child(e)),this}destroy(){return this}},e.Map=class{constructor(e,s){this.$base=e,this.$target=s,R(this,"parent",new m(((e,s)=>{const r=[];e.forEach((e=>{let s=e;t.isEvent(s)||(s=new f(s));const i=this.$target.of(s);r.push(i)}));new O(...r).event(s)})))}event(e){return this.$base.event(this.parent.child(e)),this}},e.Of=f,e.Once=B,e.OwnerPool=y,e.ParentUser=m,e.Primitive=Z,e.Sequence=class{constructor(e){this.$base=e,ee(this,"result",[]),ee(this,"parent",new m(((e,t)=>{this.result.push(e),t.use(this.result)})))}event(e){return this.$base.event(this.parent.child(e)),this}},e.Shared=I,e.SharedSource=G,e.Stream=class{constructor(e){this.$base=e,se(this,"parent",new m(((e,t)=>{e.forEach((e=>{t.use(e)}))})))}event(e){return this.$base.event(this.parent.child(e)),this}},e.Transport=class{constructor(e){this.executor=e}of(...e){return this.executor(...e)}},e.TransportApplied=class{constructor(e,t){this.baseTransport=e,this.applier=t}of(...e){return this.applier(this.baseTransport.of(...e))}},e.TransportArgs=class{constructor(e,t,s=0){this.baseTransport=e,this.args=t,this.startFromArgIndex=s}of(...e){return this.baseTransport.of(...function(e,t,s){const r=e.slice(0,s);for(;r.length<s;)r.push(void 0);return r.concat(t)}(e,this.args,this.startFromArgIndex))}},e.TransportDestroyable=class{constructor(e){this.baseTransport=e,ie(this,"destructors",[])}of(...e){const t=this.baseTransport.of(...e);return i(t)&&this.destructors.push(t),t}destroy(){return this.destructors.forEach((e=>e.destroy())),this}},e.User=$,e.Void=class{use(){return this}},e.ensureEvent=o,e.ensureFunction=h,e.ensureUser=a,e.isDestroyable=i,e.isEvent=r,e.isFilled=s,e.isTransport=function(e){return null!==e&&"object"==typeof e&&"of"in e&&"function"==typeof e.of},e.isUser=n}({},helpers);
