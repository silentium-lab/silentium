!function(e){"use strict";const t=(e,t)=>{if(null==e)throw new Error("value didn't receive source argument");if(void 0===t||null===e)throw new Error("value didn't receive guest argument");return"function"==typeof e?e(t):"object"==typeof e&&"value"in e&&"function"==typeof e.value?e.value(t):n(e,t),e},r=e=>null!==e&&"object"==typeof e&&"value"in e&&"function"==typeof e.value||null!=e,o=e=>{if(void 0===e)throw new Error("Source constructor didn't receive executor function");return r=>{t(e,r)}},n=(e,t)=>{if(void 0===e)throw new Error("give didn't receive data argument");return void 0===t?o(e):("function"==typeof t?t(e):t.give(e),t)},i=e=>{if(!e)throw new Error("receiver function was not passed to Guest constructor");const t={give:r=>(e(r),t)};return t},s=e=>{let t=!1;return()=>{t||e(),t=!0}},u=(e,t)=>{if(void 0===e)throw new Error("GuestCast didn't receive sourceGuest argument");if(void 0===t)throw new Error("GuestCast didn't receive targetGuest argument");const r={disposed(t){const r=e;return!!r.disposed&&r.disposed(t)},give:e=>(n(e,t),r),introduction:()=>"function"==typeof e?"guest":e.introduction?e.introduction():"guest"};return r},c=e=>{const t={give:r=>(e=r,t),value(){if(void 0===e)throw new Error("no value in GuestSync!");return e}};return t},a=(e,t)=>{const r={give:o=>(n(t(o),e),r)};return r},d=(e,t)=>({give:t((t=>n(t,e)))}),l=e=>"object"==typeof e&&null!==e&&"patron"===e?.introduction?.(),v=()=>"patron",h=e=>{if(void 0===e)throw new Error("Patron didn't receive willBePatron argument");const t={give:r=>(n(r,e),t),disposed(t){const r=e;return r?.disposed?.(t)||!1},introduction:v};return t},p=e=>{if(void 0===e)throw new Error("PatronOnce didn't receive baseGuest argument");let t=!1;const r={give:o=>(t||(t=!0,n(o,e)),r),disposed(r){if(t)return!0;const o=e;return!!o.disposed&&o.disposed(r)},introduction:v};return r};var g=Object.defineProperty,f=(e,t,r)=>((e,t,r)=>t in e?g(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const w=new Map,y=new Map,E=new Map,m=[],b=()=>{m.forEach((e=>e()))},S={poolsCount:0,patronsCount:0},P=o((e=>{n(S,e),m.push((()=>{let t=0;w.forEach((e=>{t+=e.size})),S.poolsCount=w.size,S.patronsCount=t,n(S,e)}))})),G=(e,t)=>(E.has(t)||E.set(t,[]),E.get(t)?.push(e),e),z=(e,t)=>(t.forEach((t=>{G(e,t)})),e),C=e=>"object"==typeof e&&null!==e&&"destroy"in e&&"function"==typeof e.destroy,D=(...e)=>{e.forEach((e=>{C(e)&&e.destroy();const t=y.get(e);t?.destroy();const r=E.get(e);E.delete(e),r&&D(...r)}))},O=e=>{if(void 0===e)throw new Error("removePatronFromPools didn't receive patron argument");w.forEach((t=>{t.delete(e)})),b()};class j{constructor(e){this.initiator=e,f(this,"patrons"),f(this,"give"),this.patrons=new Set,w.set(this,this.patrons),y.set(this.initiator,this);const t=e=>{this.patrons.forEach((t=>{this.sendValueToGuest(e,t)}))};this.give=e=>(t(e),this),b()}size(){return this.patrons.size}add(e){if(!e)throw new Error("PatronPool add method received nothing!");return"function"!=typeof e&&e.introduction&&"patron"===e.introduction()&&this.patrons.add(e),b(),this}remove(e){return this.patrons.delete(e),b(),this}distribute(e,t){return this.add(t),this.sendValueToGuest(e,t),this}destroy(){return this.patrons.forEach((e=>{this.remove(e)})),w.delete(this),y.delete(this.initiator),b(),this}sendValueToGuest(e,t){return this.guestDisposed(e,t)||n(e,t),this}guestDisposed(e,t){return!!t.disposed?.(e)&&(this.remove(t),!0)}}const A=(e,r)=>{const o=c(r);t(e,h(o));const n={value(r){return t(e,r),this},syncValue(){try{return o.value()}catch{throw new Error("No value in SourceSync")}}};return G(n,e),n},M=e=>null==e,V=e=>{const o={},n=new j(o);let s=M(e);return!s&&r(e)&&t(e,p((t=>{s=M(t),e=t}))),o.value=t=>s?(l(t)&&n.add(t),o):("function"==typeof t?n.distribute(e,i(t)):n.distribute(e,t),o),o.give=t=>(s=M(t),e=t,s||n.give(e),o),o},F=e=>{const r=new Set(Object.keys(e)),o=new Set,c=V({}),a=[],d=s((()=>{Object.entries(e).forEach((([e,n])=>{G(c,n),r.add(e);const s=h((t=>{c.value(i((r=>{o.add(e);const n={...r,[e]:t};c.give(n)})))}));a.push(s),t(n,s)}))}));return{value(e){d();const t=u(e,(t=>{o.size>0&&o.size===r.size&&n(Object.values(t),e)}));a.push(t),c.value(t)},destroy(){a.forEach((e=>{O(e)}))}}},x=(e,r)=>{if(void 0===e)throw new Error("SourceDynamic didn't receive baseGuest argument");if(void 0===r)throw new Error("SourceDynamic didn't receive baseSource argument");const o={value:e=>(t(r,e),o),give(t){return n(t,e),this}};return o},q=(e,r)=>{const o=V(),i=s((()=>{t(r,h((()=>{n(null,o)}))),t(e,h(o)),G(o,e)}));return x(o.give,(e=>{i(),o.value(e)}))};e.PatronPool=j,e.destroy=D,e.firstVisit=s,e.give=n,e.guest=i,e.guestApplied=a,e.guestCast=u,e.guestDisposable=(e,t)=>{if(void 0===e)throw new Error("GuestDisposable didn't receive guest argument");if(void 0===t)throw new Error("GuestDisposable didn't receive disposeCheck argument");const r={disposed:e=>t(e),give:t=>(n(t,e),r)};return r},e.guestExecutorApplied=d,e.guestSync=c,e.introduction=v,e.isDestroyable=C,e.isGuest=e=>{if(void 0===e)throw new Error("isGuest didnt receive mbGuest argument");return"function"==typeof e||"function"==typeof e?.give},e.isPatron=l,e.isPatronInPools=e=>{if(void 0===e)throw new Error("isPatronInPools didn't receive patron argument");let t=!1;return w.forEach((r=>{t||(t=r.has(e))})),t},e.isSource=r,e.lazy=e=>{if(void 0===e)throw new Error("lazy didn't receive buildingFn argument");return{get:(...t)=>e(...t)}},e.lazyClass=(e,t={})=>{if(void 0===e)throw new Error("PrivateClass didn't receive constructorFn argument");return{get:(...r)=>new e(...r,t)}},e.patron=h,e.patronApplied=(e,t)=>{const r=a(e,t),o={give:e=>(r.give(e),o),introduction:v};return o},e.patronExecutorApplied=(e,t)=>{const r=d(e,t),o={give:e=>(r.give(e),o),introduction:v};return o},e.patronOnce=p,e.patronPools=e=>{const t=[];return w.forEach(((r,o)=>{r.has(e)&&t.push(o)})),t},e.patronPoolsStatistic=P,e.removePatronFromPools=O,e.source=o,e.sourceAll=F,e.sourceAny=e=>{const r=V(),o=s((()=>{e.forEach((e=>{t(e,h(r))}))}));return e=>{o(),r.value(e)}},e.sourceApplied=(e,r)=>o=>{t(e,u(o,(e=>{n(r(e),o)})))},e.sourceChain=(...e)=>{const r=V(),o=new Set;let n=null;const i=s((()=>{e.forEach(((i,s)=>{t(i,h((t=>{o.add(s),s===e.length-1&&(n=t),o.size===e.length&&null!==n&&r.give(n)})))}))}));return e=>{i(),r.value(e)}},e.sourceCombined=(...e)=>r=>{const o=V();return z(o,e),t(F(e),h((e=>{r(o.give,...e)}))),o.value},e.sourceDestroyable=e=>{let t=null;return{value(r){return t=e(r),this},destroy(){return null!==t&&"function"==typeof t&&t(),this}}},e.sourceDynamic=x,e.sourceExecutorApplied=(e,r)=>r((r=>{t(e,r)})),e.sourceFiltered=(e,r,o)=>i=>{t(e,u(i,(e=>{!0===r(e)?n(e,i):void 0!==o&&n(o,i)})))},e.sourceLazy=(e,r,o)=>{let n=null;const i=V(),s=q(i,o??V());let u=!1;return o&&t(o,h((()=>{D(n),n=null}))),o=>{u||(u=!0,t(F(r),h((()=>{n||(n=e.get(...r),t(n,h(i)))})))),t(s,o)}},e.sourceMap=(e,r)=>{if(void 0===e)throw new Error("SourceMap didn't receive baseSource argument");if(void 0===r)throw new Error("SourceMap didn't receive targetSource argument");const o=V(),i=s((()=>{t(e,h((i=>{const s=[];i.forEach((t=>{const o=r.get(t);G(o,e),s.push(o)})),t(F(s),p((e=>{D(...s),n(e,o)})))})))}));return e=>{i(),o.value(e)}},e.sourceMemoOf=e=>{const t=V(e),r=A(t,null),o={value:t.value,give:e=>(r.syncValue()!==e&&n(e,t.give),o)};return o},e.sourceOf=V,e.sourceOnce=e=>{let r=void 0!==e;const o=V(e);return{value(e){return t(o,e),this},give(e){return r||(o.give(e),r=!0),this}}},e.sourceRace=e=>{if(void 0===e)throw new Error("SourceRace didnt receive sources argument");return r=>{let o=null;e.forEach((e=>{t(e,u(r,(t=>{o&&o!==e||(n(t,r),o=e)})))}))}},e.sourceResettable=q,e.sourceSequence=(e,o)=>{if(void 0===e)throw new Error("SourceSequence didn't receive baseSource argument");if(void 0===o)throw new Error("SourceSequence didn't receive targetSource argument");return i=>{const s=V(),c=o.get(s);t(e,u(i,(e=>{let o=0;const u=[];e.forEach((()=>{u.push(V())}));const a=()=>{void 0!==e[o+1]&&(o+=1,d())};function d(){const n=u[o],i=e[o];r(i)?t(i,p((e=>{s.give(e),t(c,n),a()}))):(s.give(i),t(c,n),a())}void 0!==e[o]?(d(),t(F(u),i)):n([],i)})))}},e.sourceSync=A,e.subSource=G,e.subSourceMany=z,e.value=t}({});
