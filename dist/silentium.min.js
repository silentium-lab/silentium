!function(e){"use strict";const t=e=>null!=e;function r(e){return null!==e&&"object"==typeof e&&"event"in e&&"function"==typeof e.event}function s(e){return null!==e&&"object"==typeof e&&"destroy"in e&&"function"==typeof e.destroy}function n(e){return null!==e&&"object"==typeof e&&"use"in e&&"function"==typeof e.use}function i(e,t){if("function"!=typeof e)throw new Error(`${t}: is not function`)}function o(e,t){if(!r(e))throw new Error(`${t}: is not event`)}function u(e,t){if(!n(e))throw new Error(`${t}: is not transport`)}var a=Object.defineProperty,h=(e,t,r)=>((e,t,r)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class c{constructor(){h(this,"destructors",[])}add(e){return this.destructors.push(e),this}destroy(){return this.destructors.forEach((e=>e.destroy())),this}}var l=Object.defineProperty,b=(e,t,r)=>((e,t,r)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class f{constructor(e){this.eventExecutor=e,b(this,"mbDestructor"),i(e,"Event: eventExecutor")}event(e){return this.mbDestructor=this.eventExecutor(e),this}destroy(){return"function"==typeof this.mbDestructor&&this.mbDestructor?.(),this}}var p=Object.defineProperty,v=(e,t,r)=>((e,t,r)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class d{constructor(e){this.$base=e,v(this,"destroyed",!1),v(this,"transport",j((function(e,t){t.destroyed||this.use(e)}),this)),o(e,"Local: $base")}event(e){return this.$base.event(this.transport.child(e)),this}destroy(){return this}}function w(e){return new y(e)}class y{constructor(e){this.value=e}event(e){return e.use(this.value),this}}class ${use(){return this}}var m=Object.defineProperty,g=(e,t,r)=>((e,t,r)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class T{constructor(){g(this,"owners"),g(this,"innerOwner"),this.owners=new Set,this.innerOwner=E((e=>{this.owners.forEach((t=>{t.use(e)}))}))}owner(){return this.innerOwner}size(){return this.owners.size}has(e){return this.owners.has(e)}add(e){return this.owners.add(e),this}remove(e){return this.owners.delete(e),this}destroy(){return this.owners.forEach((e=>{this.remove(e)})),this}}function E(e){return new O(e)}class O{constructor(e){this.transportExecutor=e,i(e,"Transport: transport executor")}use(e){return this.transportExecutor(e),this}}class P{constructor(e){this.executor=e,i(e,"TheTransportEvent: transport executor")}use(e){return this.executor(e)}}function j(e,...t){return new x(e,t)}class x{constructor(e,t=[],r){this.executor=e,this.args=t,this._child=r,i(e,"ParentTransport: executor")}use(e){if(void 0===this._child)throw new Error("no base transport");return this.executor.call(this._child,e,...this.args),this}child(e,...t){return new x(this.executor,[...this.args,...t],e)}}var V=Object.defineProperty,A=(e,t,r)=>((e,t,r)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);function C(...e){return new F(...e)}class F{constructor(...e){A(this,"known"),A(this,"filled",new Set),A(this,"$events"),A(this,"result",{}),A(this,"transport",j((function(e,t,r){var s,n;t.filled.add(r),t.result[r]=e,s=t.filled,n=t.known,s.size>0&&s.size===n.size&&this.use(Object.values(t.result))}),this)),this.known=new Set(Object.keys(e)),this.$events=e}event(e){return Object.entries(this.$events).forEach((([t,r])=>{o(r,"All: item"),this.known.add(t),r.event(this.transport.child(e,t))})),this}}var M=Object.defineProperty,S=(e,t,r)=>((e,t,r)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class D{constructor(...e){S(this,"$events"),this.$events=e}event(e){return this.$events.forEach((t=>{o(t,"Any: item"),t.event(e)})),this}}var k=Object.defineProperty,z=(e,t,r)=>((e,t,r)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class L{constructor(e,t){this.$base=e,this.applier=t,z(this,"transport",j((function(e,t){this.use(t.applier(e))}),this)),o(e,"Applied: base")}event(e){return this.$base.event(this.transport.child(e)),this}}class B{constructor(e,t,r){this.$base=e,this.errorMessage=t,this.errorOriginal=r,o(e,"Catch: base"),u(t,"Catch: errorMessage"),void 0!==r&&u(r,"Catch: errorOriginal")}event(e){try{this.$base.event(e)}catch(e){e instanceof Error?this.errorMessage.use(e.message):this.errorMessage.use(e),this.errorOriginal&&this.errorOriginal.use(e)}return this}}var N=Object.defineProperty,_=(e,t,r)=>((e,t,r)=>t in e?N(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class I{constructor(...e){_(this,"$events"),_(this,"$latest"),_(this,"handleEvent",((e,t)=>{const r=this.$events[e],s=this.$events[e+1];r.event(this.oneEventTransport.child(t,s,e))})),_(this,"oneEventTransport",j((function(e,t,r,s){r||(t.$latest=e),t.$latest&&this.use(t.$latest),r&&!t.$latest&&t.handleEvent(s+1,this)}),this)),this.$events=e}event(e){return this.handleEvent(0,e),this}}class q{constructor(e,t){this.$base=e,this.applier=t,o(e,"ExecutorApplied: base")}event(e){const t=this.applier(e.use.bind(e));return this.$base.event(E(t)),this}}var W=Object.defineProperty,G=(e,t,r)=>((e,t,r)=>t in e?W(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class H{constructor(e,t,r){this.$base=e,this.predicate=t,this.defaultValue=r,G(this,"parent",j((function(e,t){t.predicate(e)?this.use(e):void 0!==t.defaultValue&&this.use(t.defaultValue)}),this))}event(e){return this.$base.event(this.parent.child(e)),this}}var J=Object.defineProperty,K=(e,t,r)=>((e,t,r)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class Q{constructor(e,t,r,s){this.$emitter=e,this.$eventName=t,this.$subscribeMethod=r,this.$unsubscribeMethod=s,K(this,"lastTransport",null),K(this,"handler",(e=>{this.lastTransport&&this.lastTransport.use(e)})),K(this,"parent",j((function([e,t,r],s){s.lastTransport=this,e?.[r]&&e[r](t,s.handler)}),this))}event(e){return C(this.$emitter,this.$eventName,this.$subscribeMethod).event(this.parent.child(e)),this}destroy(){if(this.lastTransport=null,!this.$unsubscribeMethod)return this;return C(this.$emitter,this.$eventName,this.$unsubscribeMethod).event(E((([e,t,r])=>{e?.[r]?.(t,this.handler)}))),this}}class R{constructor(e,t){this.p=e,this.errorOwner=t}event(e){return this.p.then((function(t){e.use(t)})).catch((e=>{this.errorOwner?.use(e)})),this}}var U=Object.defineProperty,X=(e,t,r)=>((e,t,r)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);function Y(e){return new Z(e)}class Z{constructor(e){this.v=e,X(this,"lateTransport",null),X(this,"notify",(e=>{t(e)&&this.lateTransport&&this.lateTransport.use(e)}))}event(e){if(this.lateTransport)throw new Error("Late component gets new transport, when another was already connected!");return this.lateTransport=e,this.notify(this.v),this}use(e){return this.notify(e),this}}var ee=Object.defineProperty,te=(e,t,r)=>((e,t,r)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);function re(e){return new se(e)}class se{constructor(e){this.$base=e,te(this,"isFilled",!1),te(this,"parent",j((function(e,t){t.isFilled||(t.isFilled=!0,this.use(e))}),this))}event(e){return this.$base.event(this.parent.child(e)),this}}var ne=Object.defineProperty,ie=(e,t,r)=>((e,t,r)=>t in e?ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);function oe(e,t=!1){return new ue(e,t)}class ue{constructor(e,t=!1){this.$base=e,this.stateless=t,ie(this,"ownersPool",new T),ie(this,"lastValue"),ie(this,"calls",Y()),ie(this,"firstCallTransport",E((e=>{this.lastValue=e,this.ownersPool.owner().use(e)}))),re(this.calls).event(E((()=>{this.$base.event(this.firstCallTransport)})))}event(e){return this.calls.use(1),this.stateless||!t(this.lastValue)||this.ownersPool.has(e)||e.use(this.lastValue),this.ownersPool.add(e),this}use(e){return this.calls.use(1),this.lastValue=e,this.ownersPool.owner().use(e),this}touched(){this.calls.use(1)}pool(){return this.ownersPool}destroy(){return this.ownersPool.destroy()}}var ae=Object.defineProperty,he=(e,t,r)=>((e,t,r)=>t in e?ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);function ce(e,t=!1){return new le(e,t)}class le{constructor(e,t=!1){this.$base=e,he(this,"$sharedBase"),this.$sharedBase=oe(this.$base,t)}event(e){return this.$sharedBase.event(e),this}use(e){return this.$sharedBase.touched(),this.$base.use(e),this}}var be=Object.defineProperty,fe=(e,t,r)=>((e,t,r)=>t in e?be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class pe{constructor(e){fe(this,"$event"),this.$event=ce(Y(e))}event(e){return this.$event.event(e),this}use(e){return this.$event.use(e),this}}var ve=Object.defineProperty,de=(e,t,r)=>((e,t,r)=>t in e?ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class we{constructor(e,t){this.$base=e,this.$target=t,de(this,"parent",j((function(e,t){const s=[];e.forEach((e=>{let n=e;r(n)||(n=w(n));const i=t.$target.use(n);s.push(i)})),C(...s).event(this)}),this))}event(e){return this.$base.event(this.parent.child(e)),this}}var ye=Object.defineProperty,$e=(e,t,r)=>((e,t,r)=>t in e?ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class me{constructor(e,t=null){this.$base=e,this.theValue=t,$e(this,"touched",!1)}ensureTouched(){this.touched||this.$base.event(E((e=>{this.theValue=e}))),this.touched=!0}[Symbol.toPrimitive](){return this.ensureTouched(),this.theValue}primitive(){return this.ensureTouched(),this.theValue}primitiveWithException(){if(this.ensureTouched(),null===this.theValue)throw new Error("Primitive value is null");return this.theValue}}var ge=Object.defineProperty,Te=(e,t,r)=>((e,t,r)=>t in e?ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class Ee{constructor(e){this.$base=e,Te(this,"result",[]),Te(this,"parent",j((function(e,t){t.result.push(e),this.use(t.result)}),this))}event(e){return this.$base.event(this.parent.child(e)),this}}var Oe=Object.defineProperty,Pe=(e,t,r)=>((e,t,r)=>t in e?Oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class je{constructor(e){this.$base=e,Pe(this,"parent",j((function(e){e.forEach((e=>{this.use(e)}))})))}event(e){return this.$base.event(this.parent.child(e)),this}}class xe{constructor(e,t){this.baseTransport=e,this.applier=t}use(e){return this.applier(this.baseTransport.use(e))}}class Ve{constructor(e,t,r=0){this.baseTransport=e,this.args=t,this.startFromArgIndex=r}use(e){return this.baseTransport.use(function(e,t,r){const s=e.slice(0,r);for(;s.length<r;)s.push(void 0);return s.concat(t)}(e,this.args,this.startFromArgIndex))}}var Ae=Object.defineProperty,Ce=(e,t,r)=>((e,t,r)=>t in e?Ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class Fe{constructor(e){this.baseTransport=e,Ce(this,"destructors",[])}use(e){const t=this.baseTransport.use(e);return s(t)&&this.destructors.push(t),t}destroy(){return this.destructors.forEach((e=>e.destroy())),this}}e.All=C,e.Any=function(...e){return new D(...e)},e.Applied=function(e,t){return new L(e,t)},e.Catch=function(e,t,r){return new B(e,t,r)},e.Chain=function(...e){return new I(...e)},e.Component=function(e){return(...t)=>{let r;return{event(s){return r=e.call(s,...t),this},destroy(){return void 0!==r&&r(),this}}}},e.ComponentClass=function(e){return(...t)=>new e(...t)},e.DestroyContainer=function(){return new c},e.Event=function(e){return new f(e)},e.ExecutorApplied=function(e,t){return new q(e,t)},e.Filtered=function(e,t,r){return new H(e,t,r)},e.FromEvent=function(e,t,r,s){return new Q(e,t,r,s)},e.FromPromise=function(e,t){return new R(e,t)},e.Late=Y,e.LateShared=function(e){return new pe(e)},e.Local=function(e){return new d(e)},e.Map=function(e,t){return new we(e,t)},e.Of=w,e.Once=re,e.OwnerPool=T,e.Primitive=function(e,t=null){return new me(e,t)},e.Sequence=function(e){return new Ee(e)},e.Shared=oe,e.SharedSource=ce,e.Stream=function(e){return new je(e)},e.TheChain=I,e.TheFromPromise=R,e.TheTransportApplied=xe,e.TheTransportArgs=Ve,e.Transport=E,e.TransportApplied=function(e,t){return new xe(e,t)},e.TransportArgs=function(e,t,r=0){return new Ve(e,t,r)},e.TransportDestroyable=function(e){return new Fe(e)},e.TransportEvent=function(e){return new P(e)},e.TransportParent=j,e.Void=function(){return new $},e.ensureEvent=o,e.ensureFunction=i,e.ensureTransport=u,e.isDestroyable=s,e.isEvent=r,e.isFilled=t,e.isTransport=n}({});
