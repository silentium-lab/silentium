!function(t){"use strict";const e=t=>null!=t;function r(t){return null!==t&&"object"==typeof t&&"event"in t&&"function"==typeof t.event}function s(t){return null!==t&&"object"==typeof t&&"destroy"in t&&"function"==typeof t.destroy}function n(t){return null!==t&&"object"==typeof t&&"use"in t&&"function"==typeof t.use}function i(t,e){if("function"!=typeof t)throw new Error(`${e}: is not function`)}function o(t,e){if(!r(t))throw new Error(`${e}: is not event`)}function u(t,e){if(!n(t))throw new Error(`${e}: is not transport`)}var a=Object.defineProperty,h=(t,e,r)=>((t,e,r)=>e in t?a(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class c{constructor(){h(this,"destructors",[])}add(t){return this.destructors.push(t),t}destroy(){return this.destructors.forEach((t=>t.destroy())),this}}var l=Object.defineProperty,b=(t,e,r)=>((t,e,r)=>e in t?l(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class f{constructor(t){this.eventExecutor=t,b(this,"mbDestructor"),i(t,"Event: eventExecutor")}event(t){return this.mbDestructor=this.eventExecutor(t),this}destroy(){return"function"==typeof this.mbDestructor&&this.mbDestructor?.(),this}}var p=Object.defineProperty,v=(t,e,r)=>((t,e,r)=>e in t?p(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class d{constructor(t){this.$base=t,v(this,"destroyed",!1),v(this,"transport",j((function(t,e){e.destroyed||this.use(t)}),this)),o(t,"Local: $base")}event(t){return this.$base.event(this.transport.child(t)),this}destroy(){return this}}function w(t){return new y(t)}class y{constructor(t){this.value=t}event(t){return t.use(this.value),this}}class ${use(){return this}}var m=Object.defineProperty,g=(t,e,r)=>((t,e,r)=>e in t?m(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class E{constructor(){g(this,"owners"),g(this,"innerOwner"),this.owners=new Set,this.innerOwner=T((t=>{this.owners.forEach((e=>{e.use(t)}))}))}owner(){return this.innerOwner}size(){return this.owners.size}has(t){return this.owners.has(t)}add(t){return this.owners.add(t),this}remove(t){return this.owners.delete(t),this}destroy(){return this.owners.forEach((t=>{this.remove(t)})),this}}function T(t){return new P(t)}class P{constructor(t){this.transportExecutor=t,i(t,"Transport: transport executor")}use(t){return this.transportExecutor(t),this}}class O{constructor(t){this.executor=t,i(t,"TransportEvent: transport executor")}use(t){return this.executor(t)}}function j(t,...e){return new x(t,e)}class x{constructor(t,e=[],r){this.executor=t,this.args=e,this._child=r,i(t,"TransportParent: executor")}use(t){if(void 0===this._child)throw new Error("no base transport");return this.executor.call(this._child,t,...this.args),this}child(t,...e){return new x(this.executor,[...this.args,...e],t)}}var V=Object.defineProperty,A=(t,e,r)=>((t,e,r)=>e in t?V(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function C(...t){return new F(...t)}class F{constructor(...t){A(this,"known"),A(this,"filled",new Set),A(this,"$events"),A(this,"result",[]),A(this,"transport",j((function(t,e,r){var s,n;e.filled.add(r),e.result[parseInt(r)]=t,s=e.filled,n=e.known,s.size>0&&s.size===n.size&&this.use(e.result)}),this)),this.known=new Set(Object.keys(t)),this.$events=t}event(t){return Object.entries(this.$events).forEach((([e,r])=>{o(r,"All: item"),r.event(this.transport.child(t,e))})),0===this.known.size&&t.use([]),this}}var S=Object.defineProperty,M=(t,e,r)=>((t,e,r)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class D{constructor(...t){M(this,"$events"),this.$events=t}event(t){return this.$events.forEach((e=>{o(e,"Any: item"),e.event(t)})),this}}var z=Object.defineProperty,k=(t,e,r)=>((t,e,r)=>e in t?z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class I{constructor(t,e){this.$base=t,this.applier=e,k(this,"transport",j((function(t,e){this.use(e.applier(t))}),this)),o(t,"Applied: base")}event(t){return this.$base.event(this.transport.child(t)),this}}class L{constructor(t,e,r){this.$base=t,this.errorMessage=e,this.errorOriginal=r,o(t,"Catch: base"),u(e,"Catch: errorMessage"),void 0!==r&&u(r,"Catch: errorOriginal")}event(t){try{this.$base.event(t)}catch(t){t instanceof Error?this.errorMessage.use(t.message):this.errorMessage.use(String(t)),this.errorOriginal&&this.errorOriginal.use(t)}return this}}var B=Object.defineProperty,N=(t,e,r)=>((t,e,r)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class _{constructor(...t){N(this,"$events"),N(this,"$latest"),N(this,"handleEvent",((t,e)=>{const r=this.$events[t],s=this.$events[t+1];r.event(this.oneEventTransport.child(e,s,t))})),N(this,"oneEventTransport",j((function(t,e,r,s){r||(e.$latest=t),e.$latest&&this.use(e.$latest),r&&!e.$latest&&e.handleEvent(s+1,this)}),this)),this.$events=t}event(t){return this.handleEvent(0,t),this}}class q{constructor(t,e){this.$base=t,this.applier=e,o(t,"ExecutorApplied: base")}event(t){const e=this.applier(t.use.bind(t));return this.$base.event(T(e)),this}}var W=Object.defineProperty,G=(t,e,r)=>((t,e,r)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class H{constructor(t,e,r){this.$base=t,this.predicate=e,this.defaultValue=r,G(this,"parent",j((function(t,e){e.predicate(t)?this.use(t):void 0!==e.defaultValue&&this.use(e.defaultValue)}),this))}event(t){return this.$base.event(this.parent.child(t)),this}}var J=Object.defineProperty,K=(t,e,r)=>((t,e,r)=>e in t?J(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class Q{constructor(t,e,r,s){this.$emitter=t,this.$eventName=e,this.$subscribeMethod=r,this.$unsubscribeMethod=s,K(this,"lastTransport",null),K(this,"handler",(t=>{this.lastTransport&&this.lastTransport.use(t)})),K(this,"parent",j((function([t,e,r],s){s.lastTransport=this,t?.[r]&&t[r](e,s.handler)}),this))}event(t){return C(this.$emitter,this.$eventName,this.$subscribeMethod).event(this.parent.child(t)),this}destroy(){return this.lastTransport=null,this.$unsubscribeMethod?(C(this.$emitter,this.$eventName,this.$unsubscribeMethod).event(T((([t,e,r])=>{t?.[r]?.(e,this.handler)}))),this):this}}class R{constructor(t,e){this.p=t,this.error=e}event(t){return this.p.then((e=>{t.use(e)})).catch((t=>{this.error?.use(t)})),this}}var U=Object.defineProperty,X=(t,e,r)=>((t,e,r)=>e in t?U(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function Y(t){return new Z(t)}class Z{constructor(t){this.v=t,X(this,"lateTransport",null),X(this,"notify",(t=>{e(t)&&this.lateTransport&&this.lateTransport.use(t)}))}event(t){if(this.lateTransport)throw new Error("Late component gets new transport, when another was already connected!");return this.lateTransport=t,this.notify(this.v),this}use(t){return this.notify(t),this}}var tt=Object.defineProperty,et=(t,e,r)=>((t,e,r)=>e in t?tt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function rt(t){return new st(t)}class st{constructor(t){this.$base=t,et(this,"isFilled",!1),et(this,"parent",j((function(t,e){e.isFilled||(e.isFilled=!0,this.use(t))}),this))}event(t){return this.$base.event(this.parent.child(t)),this}}var nt=Object.defineProperty,it=(t,e,r)=>((t,e,r)=>e in t?nt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function ot(t,e=!1){return new ut(t,e)}class ut{constructor(t,e=!1){this.$base=t,this.stateless=e,it(this,"ownersPool",new E),it(this,"lastValue"),it(this,"calls",Y()),it(this,"firstCallTransport",T((t=>{this.lastValue=t,this.ownersPool.owner().use(t)}))),rt(this.calls).event(T((()=>{this.$base.event(this.firstCallTransport)})))}event(t){return this.calls.use(1),this.stateless||!e(this.lastValue)||this.ownersPool.has(t)||t.use(this.lastValue),this.ownersPool.add(t),this}use(t){return this.calls.use(1),this.lastValue=t,this.ownersPool.owner().use(t),this}touched(){this.calls.use(1)}pool(){return this.ownersPool}destroy(){return this.ownersPool.destroy()}}var at=Object.defineProperty,ht=(t,e,r)=>((t,e,r)=>e in t?at(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);function ct(t,e=!1){return new lt(t,e)}class lt{constructor(t,e=!1){this.$base=t,ht(this,"$sharedBase"),this.$sharedBase=ot(this.$base,e)}event(t){return this.$sharedBase.event(t),this}use(t){return this.$sharedBase.touched(),this.$base.use(t),this}}var bt=Object.defineProperty,ft=(t,e,r)=>((t,e,r)=>e in t?bt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class pt{constructor(t){ft(this,"$event"),this.$event=ct(Y(t))}event(t){return this.$event.event(t),this}use(t){return this.$event.use(t),this}}var vt=Object.defineProperty,dt=(t,e,r)=>((t,e,r)=>e in t?vt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class wt{constructor(t,e){this.$base=t,this.$target=e,dt(this,"parent",j((function(t,e){const s=[];t.forEach((t=>{let n=t;r(n)||(n=w(n));const i=e.$target.use(n);s.push(i)})),C(...s).event(this)}),this))}event(t){return this.$base.event(this.parent.child(t)),this}}var yt=Object.defineProperty,$t=(t,e,r)=>((t,e,r)=>e in t?yt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class mt{constructor(t,e=null){this.$base=t,this.theValue=e,$t(this,"touched",!1)}ensureTouched(){this.touched||this.$base.event(T((t=>{this.theValue=t}))),this.touched=!0}[Symbol.toPrimitive](){return this.ensureTouched(),this.theValue}primitive(){return this.ensureTouched(),this.theValue}primitiveWithException(){if(this.ensureTouched(),null===this.theValue)throw new Error("Primitive value is null");return this.theValue}}var gt=Object.defineProperty,Et=(t,e,r)=>((t,e,r)=>e in t?gt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class Tt{constructor(t){this.$base=t,Et(this,"result",[]),Et(this,"parent",j((function(t,e){e.result.push(t),this.use(e.result)}),this))}event(t){return this.$base.event(this.parent.child(t)),this}}var Pt=Object.defineProperty,Ot=(t,e,r)=>((t,e,r)=>e in t?Pt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class jt{constructor(t){this.$base=t,Ot(this,"parent",j((function(t){t.forEach((t=>{this.use(t)}))})))}event(t){return this.$base.event(this.parent.child(t)),this}}class xt{constructor(t,e){this.baseTransport=t,this.applier=e}use(t){return this.applier(this.baseTransport.use(t))}}class Vt{constructor(t,e,r=0){this.baseTransport=t,this.args=e,this.startFromArgIndex=r}use(t){return this.baseTransport.use(function(t,e,r){const s=t.slice(0,r);for(;s.length<r;)s.push(void 0);return s.concat(e)}(t,this.args,this.startFromArgIndex))}}var At=Object.defineProperty,Ct=(t,e,r)=>((t,e,r)=>e in t?At(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class Ft{constructor(t){this.baseTransport=t,Ct(this,"destructors",[])}use(t){const e=this.baseTransport.use(t);return s(e)&&this.destructors.push(e),e}destroy(){return this.destructors.forEach((t=>t.destroy())),this}}t.All=C,t.Any=function(...t){return new D(...t)},t.Applied=function(t,e){return new I(t,e)},t.Catch=function(t,e,r){return new L(t,e,r)},t.Chain=function(...t){return new _(...t)},t.ChainEvent=_,t.Component=function(t){return(...e)=>{let r;return{event(s){return r=t.call(s,...e),this},destroy(){return void 0!==r&&r(),this}}}},t.ComponentClass=function(t){return(...e)=>new t(...e)},t.DestroyContainer=function(){return new c},t.Event=function(t){return new f(t)},t.ExecutorApplied=function(t,e){return new q(t,e)},t.Filtered=function(t,e,r){return new H(t,e,r)},t.FromEvent=function(t,e,r,s){return new Q(t,e,r,s)},t.FromPromise=function(t,e){return new R(t,e)},t.FromPromiseEvent=R,t.Late=Y,t.LateShared=function(t){return new pt(t)},t.Local=function(t){return new d(t)},t.Map=function(t,e){return new wt(t,e)},t.Of=w,t.Once=rt,t.OwnerPool=E,t.Primitive=function(t,e=null){return new mt(t,e)},t.Sequence=function(t){return new Tt(t)},t.Shared=ot,t.SharedSource=ct,t.Stream=function(t){return new jt(t)},t.Transport=T,t.TransportApplied=function(t,e){return new xt(t,e)},t.TransportAppliedImpl=xt,t.TransportArgs=function(t,e,r=0){return new Vt(t,e,r)},t.TransportArgsImpl=Vt,t.TransportDestroyable=function(t){return new Ft(t)},t.TransportEvent=function(t){return new O(t)},t.TransportParent=j,t.Void=function(){return new $},t.ensureEvent=o,t.ensureFunction=i,t.ensureTransport=u,t.isDestroyable=s,t.isEvent=r,t.isFilled=e,t.isTransport=n}({});
