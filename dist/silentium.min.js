!function(e){"use strict";const t=e=>null!=e;function r(e){return null!==e&&"object"==typeof e&&"event"in e&&"function"==typeof e.event}function s(e){return null!==e&&"object"==typeof e&&"destroy"in e&&"function"==typeof e.destroy}function n(e){return null!==e&&"object"==typeof e&&"use"in e&&"function"==typeof e.use}function i(e,t){if("function"!=typeof e)throw new Error(`${t}: is not function`)}function o(e,t){if(!r(e))throw new Error(`${t}: is not event`)}function a(e,t){if(!n(e))throw new Error(`${t}: is not transport`)}var u=Object.defineProperty,h=(e,t,r)=>((e,t,r)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class l{constructor(){h(this,"destructors",[])}add(e){return this.destructors.push(e),this}destroy(){return this.destructors.forEach((e=>e.destroy())),this}}var c=Object.defineProperty,b=(e,t,r)=>((e,t,r)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class p{constructor(e){this.eventExecutor=e,b(this,"mbDestructor"),i(e,"Event: eventExecutor")}event(e){return this.mbDestructor=this.eventExecutor(e),this}destroy(){return"function"==typeof this.mbDestructor&&this.mbDestructor?.(),this}}var v=Object.defineProperty,f=(e,t,r)=>((e,t,r)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class d{constructor(e){this.$base=e,f(this,"destroyed",!1),f(this,"transport",new j(((e,t)=>{this.destroyed||t.use(e)}))),o(e,"Local: $base")}event(e){return this.$base.event(this.transport.child(e)),this}destroy(){return this}}function w(e){return new y(e)}class y{constructor(e){this.value=e}event(e){return e.use(this.value),this}}class m{use(){return this}}var $=Object.defineProperty,g=(e,t,r)=>((e,t,r)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class T{constructor(){g(this,"owners"),g(this,"innerOwner"),this.owners=new Set,this.innerOwner=E((e=>{this.owners.forEach((t=>{t.use(e)}))}))}owner(){return this.innerOwner}size(){return this.owners.size}has(e){return this.owners.has(e)}add(e){return this.owners.add(e),this}remove(e){return this.owners.delete(e),this}destroy(){return this.owners.forEach((e=>{this.remove(e)})),this}}function E(e){return new O(e)}class O{constructor(e){this.transportExecutor=e,i(e,"Transport: transport executor")}use(e){return this.transportExecutor(e),this}}class P{constructor(e){this.executor=e,i(e,"TheTransportEvent: transport executor")}use(e){return this.executor(e)}}class j{constructor(e,t=[],r){this.executor=e,this.args=t,this._child=r,i(e,"ParentTransport: executor")}use(e){if(void 0===this._child)throw new Error("no base transport");return this.executor(e,this._child,...this.args),this}child(e,...t){return new j(this.executor,[...this.args,...t],e)}}var V=Object.defineProperty,x=(e,t,r)=>((e,t,r)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);function A(...e){return new F(...e)}class F{constructor(...e){x(this,"keysKnown"),x(this,"keysFilled",new Set),x(this,"$events"),x(this,"result",{}),x(this,"transport",new j(((e,t,r)=>{var s,n;this.keysFilled.add(r),this.result[r]=e,s=this.keysFilled,n=this.keysKnown,s.size>0&&s.size===n.size&&t.use(Object.values(this.result))}))),this.keysKnown=new Set(Object.keys(e)),this.$events=e}event(e){return Object.entries(this.$events).forEach((([t,r])=>{o(r,"All: item"),this.keysKnown.add(t),r.event(this.transport.child(e,t))})),this}}var C=Object.defineProperty,M=(e,t,r)=>((e,t,r)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class S{constructor(...e){M(this,"$events"),this.$events=e}event(e){return this.$events.forEach((t=>{o(t,"Any: item"),t.event(e)})),this}}var k=Object.defineProperty,D=(e,t,r)=>((e,t,r)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class z{constructor(e,t){this.$base=e,this.applier=t,D(this,"transport",new j(((e,t)=>{t.use(this.applier(e))}))),o(e,"Applied: base")}event(e){return this.$base.event(this.transport.child(e)),this}}class L{constructor(e,t,r){this.$base=e,this.errorMessage=t,this.errorOriginal=r,o(e,"Catch: base"),a(t,"Catch: errorMessage"),void 0!==r&&a(r,"Catch: errorOriginal")}event(e){try{this.$base.event(e)}catch(e){e instanceof Error?this.errorMessage.use(e.message):this.errorMessage.use(e),this.errorOriginal&&this.errorOriginal.use(e)}return this}}var B=Object.defineProperty,K=(e,t,r)=>((e,t,r)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class N{constructor(...e){K(this,"$events"),K(this,"lastValue"),K(this,"handleEvent",((e,t)=>{const r=this.$events[e],s=this.$events[e+1];r.event(this.oneEventTransport.child(t,s,e))})),K(this,"oneEventTransport",new j(((e,t,r,s)=>{r||(this.lastValue=e),this.lastValue&&t.use(this.lastValue),r&&!this.lastValue&&this.handleEvent(s+1,t)}))),this.$events=e}event(e){return this.handleEvent(0,e),this}}class _{constructor(e,t){this.$base=e,this.applier=t,o(e,"ExecutorApplied: base")}event(e){const t=this.applier(e.use.bind(e));return this.$base.event(E(t)),this}}var I=Object.defineProperty,q=(e,t,r)=>((e,t,r)=>t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class W{constructor(e,t,r){this.$base=e,this.predicate=t,this.defaultValue=r,q(this,"parent",new j(((e,t)=>{this.predicate(e)?t.use(e):void 0!==this.defaultValue&&t.use(this.defaultValue)})))}event(e){return this.$base.event(this.parent.child(e)),this}}var G=Object.defineProperty,H=(e,t,r)=>((e,t,r)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class J{constructor(e,t,r,s){this.$emitter=e,this.$eventName=t,this.$subscribeMethod=r,this.$unsubscribeMethod=s,H(this,"lastTransport",null),H(this,"handler",(e=>{this.lastTransport&&this.lastTransport.use(e)})),H(this,"parent",new j((([e,t,r],s)=>{this.lastTransport=s,e?.[r]&&e[r](t,this.handler)})))}event(e){return A(this.$emitter,this.$eventName,this.$subscribeMethod).event(this.parent.child(e)),this}destroy(){if(this.lastTransport=null,!this.$unsubscribeMethod)return this;return A(this.$emitter,this.$eventName,this.$unsubscribeMethod).event(E((([e,t,r])=>{e?.[r]?.(t,this.handler)}))),this}}class Q{constructor(e,t){this.p=e,this.errorOwner=t}event(e){return this.p.then((function(t){e.use(t)})).catch((e=>{this.errorOwner?.use(e)})),this}}var R=Object.defineProperty,U=(e,t,r)=>((e,t,r)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);function X(e){return new Y(e)}class Y{constructor(e){this.v=e,U(this,"lateTransport",null),U(this,"notify",(e=>{t(e)&&this.lateTransport&&this.lateTransport.use(e)}))}event(e){if(this.lateTransport)throw new Error("Late component gets new transport, when another was already connected!");return this.lateTransport=e,this.notify(this.v),this}use(e){return this.notify(e),this}}var Z=Object.defineProperty,ee=(e,t,r)=>((e,t,r)=>t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);function te(e){return new re(e)}class re{constructor(e){this.$base=e,ee(this,"isFilled",!1),ee(this,"parent",new j(((e,t)=>{this.isFilled||(this.isFilled=!0,t.use(e))})))}event(e){return this.$base.event(this.parent.child(e)),this}}var se=Object.defineProperty,ne=(e,t,r)=>((e,t,r)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);function ie(e,t=!1){return new oe(e,t)}class oe{constructor(e,t=!1){this.$base=e,this.stateless=t,ne(this,"ownersPool",new T),ne(this,"lastValue"),ne(this,"calls",X()),ne(this,"firstCallTransport",E((e=>{this.lastValue=e,this.ownersPool.owner().use(e)}))),te(this.calls).event(E((()=>{this.$base.event(this.firstCallTransport)})))}event(e){return this.calls.use(1),this.stateless||!t(this.lastValue)||this.ownersPool.has(e)||e.use(this.lastValue),this.ownersPool.add(e),this}use(e){return this.calls.use(1),this.lastValue=e,this.ownersPool.owner().use(e),this}touched(){this.calls.use(1)}pool(){return this.ownersPool}destroy(){return this.ownersPool.destroy()}}var ae=Object.defineProperty,ue=(e,t,r)=>((e,t,r)=>t in e?ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);function he(e,t=!1){return new le(e,t)}class le{constructor(e,t=!1){this.$base=e,ue(this,"$sharedBase"),this.$sharedBase=ie(this.$base,t)}event(e){return this.$sharedBase.event(e),this}use(e){return this.$sharedBase.touched(),this.$base.use(e),this}}var ce=Object.defineProperty,be=(e,t,r)=>((e,t,r)=>t in e?ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class pe{constructor(e){be(this,"$event"),this.$event=he(X(e))}event(e){return this.$event.event(e),this}use(e){return this.$event.use(e),this}}var ve=Object.defineProperty,fe=(e,t,r)=>((e,t,r)=>t in e?ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class de{constructor(e,t){this.$base=e,this.$target=t,fe(this,"parent",new j(((e,t)=>{const s=[];e.forEach((e=>{let t=e;r(t)||(t=w(t));const n=this.$target.use(t);s.push(n)}));A(...s).event(t)})))}event(e){return this.$base.event(this.parent.child(e)),this}}var we=Object.defineProperty,ye=(e,t,r)=>((e,t,r)=>t in e?we(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class me{constructor(e,t=null){this.$base=e,this.theValue=t,ye(this,"touched",!1)}ensureTouched(){this.touched||this.$base.event(E((e=>{this.theValue=e}))),this.touched=!0}[Symbol.toPrimitive](){return this.ensureTouched(),this.theValue}primitive(){return this.ensureTouched(),this.theValue}primitiveWithException(){if(this.ensureTouched(),null===this.theValue)throw new Error("Primitive value is null");return this.theValue}}var $e=Object.defineProperty,ge=(e,t,r)=>((e,t,r)=>t in e?$e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class Te{constructor(e){this.$base=e,ge(this,"result",[]),ge(this,"parent",new j(((e,t)=>{this.result.push(e),t.use(this.result)})))}event(e){return this.$base.event(this.parent.child(e)),this}}var Ee=Object.defineProperty,Oe=(e,t,r)=>((e,t,r)=>t in e?Ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class Pe{constructor(e){this.$base=e,Oe(this,"parent",new j(((e,t)=>{e.forEach((e=>{t.use(e)}))})))}event(e){return this.$base.event(this.parent.child(e)),this}}class je{constructor(e,t){this.baseTransport=e,this.applier=t}use(e){return this.applier(this.baseTransport.use(e))}}class Ve{constructor(e,t,r=0){this.baseTransport=e,this.args=t,this.startFromArgIndex=r}use(e){return this.baseTransport.use(function(e,t,r){const s=e.slice(0,r);for(;s.length<r;)s.push(void 0);return s.concat(t)}(e,this.args,this.startFromArgIndex))}}var xe=Object.defineProperty,Ae=(e,t,r)=>((e,t,r)=>t in e?xe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class Fe{constructor(e){this.baseTransport=e,Ae(this,"destructors",[])}use(e){const t=this.baseTransport.use(e);return s(t)&&this.destructors.push(t),t}destroy(){return this.destructors.forEach((e=>e.destroy())),this}}e.All=A,e.Any=function(...e){return new S(...e)},e.Applied=function(e,t){return new z(e,t)},e.Catch=function(e,t,r){return new L(e,t,r)},e.Chain=function(...e){return new N(...e)},e.Component=function(e){return(...t)=>{let r;return{event(s){return r=e.call(s,...t),this},destroy(){return void 0!==r&&r(),this}}}},e.ComponentClass=function(e){return(...t)=>new e(...t)},e.DestroyContainer=function(){return new l},e.Event=function(e){return new p(e)},e.ExecutorApplied=function(e,t){return new _(e,t)},e.Filtered=function(e,t,r){return new W(e,t,r)},e.FromEvent=function(e,t,r,s){return new J(e,t,r,s)},e.FromPromise=function(e,t){return new Q(e,t)},e.Late=X,e.LateShared=function(e){return new pe(e)},e.Local=function(e){return new d(e)},e.Map=function(e,t){return new de(e,t)},e.Of=w,e.Once=te,e.OwnerPool=T,e.ParentTransport=j,e.Primitive=function(e,t=null){return new me(e,t)},e.Sequence=function(e){return new Te(e)},e.Shared=ie,e.SharedSource=he,e.Stream=function(e){return new Pe(e)},e.TheChain=N,e.TheFromPromise=Q,e.TheTransportApplied=je,e.TheTransportArgs=Ve,e.Transport=E,e.TransportApplied=function(e,t){return new je(e,t)},e.TransportArgs=function(e,t,r=0){return new Ve(e,t,r)},e.TransportDestroyable=function(e){return new Fe(e)},e.TransportEvent=function(e){return new P(e)},e.Void=function(){return new m},e.ensureEvent=o,e.ensureFunction=i,e.ensureTransport=a,e.isDestroyable=s,e.isEvent=r,e.isFilled=t,e.isTransport=n}({});
