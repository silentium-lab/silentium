var silentium=function(t){"use strict";const e=t=>null!=t;function r(t){return null!==t&&"object"==typeof t&&"to"in t&&"function"==typeof t.to}function s(t){return null!==t&&"object"==typeof t&&"destroy"in t&&"function"==typeof t.destroy}function n(t){return null!==t&&"object"==typeof t&&"destroyed"in t&&"function"==typeof t.destroy}function i(t){return null!==t&&"object"==typeof t&&"use"in t&&"function"==typeof t.use}class o{constructor(t){this.base=t}destroy(){return s(this.base)&&this.base.destroy(),this}}var a=Object.defineProperty,u=(t,e,r)=>((t,e,r)=>e in t?a(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class h{constructor(){u(this,"destructors",[])}add(t){return s(t)&&this.destructors.push(t),t}destroy(){return this.destructors.forEach((t=>t.destroy())),this.destructors.length=0,this}}function l(t,e){if("function"!=typeof t)throw new Error(`${e}: is not function`)}function c(t,e){if(!r(t))throw new Error(`${e}: is not message`)}function p(t,e){if(!i(t))throw new Error(`${e}: is not transport`)}var b=Object.defineProperty,f=(t,e,r)=>((t,e,r)=>e in t?b(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);function d(t){return new m(t)}class m{constructor(t){this.executor=t,f(this,"mbDestructor"),l(t,"Message: executor")}to(t){return this.mbDestructor=this.executor(t),this}destroy(){return"function"==typeof this.mbDestructor&&this.mbDestructor?.(),this}}function y(t){return new w(t)}class w{constructor(t){this.executor=t,l(t,"Transport: transport executor")}use(t){return this.executor(t),this}}class g{constructor(t){this.executor=t,l(t,"TransportMessage: transport executor")}use(t){return this.executor(t)}}function $(t,...e){return new v(t,e)}class v{constructor(t,e=[],r){this.executor=t,this.args=e,this._child=r,l(t,"TransportParent: executor")}use(t){if(void 0===this._child)throw new Error("no base transport");return this.executor.call(this._child,t,...this.args),this}child(t,...e){return new v(this.executor,[...this.args,...e],t)}}var T=Object.defineProperty,P=(t,e,r)=>((t,e,r)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class I{constructor(t){this.$base=t,P(this,"destroyed",!1),P(this,"transport",$((function(t,e){e.destroyed||this.use(t)}),this)),c(t,"Local: $base")}to(t){return this.$base.to(this.transport.child(t)),this}destroy(){return this.destroyed=!0,this}}function O(t){return new j(t)}class j{constructor(t){this.value=t}to(t){return t.use(this.value),this}}class M{constructor(t){this.base=t}wait(t){return void 0!==this.base&&t.to(this.base),this}}class E{use(){return this}}var x=Object.defineProperty,A=(t,e,r)=>((t,e,r)=>e in t?x(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function C(...t){return new S(...t)}class S{constructor(...t){A(this,"known"),A(this,"filled",new Set),A(this,"$messages"),A(this,"result",[]),A(this,"transport",$((function(t,e,r){var s,n;e.filled.add(r),e.result[parseInt(r)]=t,s=e.filled,n=e.known,s.size>0&&s.size===n.size&&this.use(e.result)}),this)),this.known=new Set(Object.keys(t)),this.$messages=t}to(t){return Object.entries(this.$messages).forEach((([e,r])=>{c(r,"All: item"),r.to(this.transport.child(t,e))})),0===this.known.size&&t.use([]),this}}var V=Object.defineProperty,D=(t,e,r)=>((t,e,r)=>e in t?V(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class F{constructor(...t){D(this,"$messages"),this.$messages=t}to(t){return this.$messages.forEach((e=>{c(e,"Any: item"),e.to(t)})),this}}var L=Object.defineProperty,z=(t,e,r)=>((t,e,r)=>e in t?L(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);function R(t,e){return new k(t,e)}class k{constructor(t,e){this.$base=t,this.applier=e,z(this,"transport",$((function(t,e){this.use(e.applier(t))}),this)),c(t,"Applied: base")}to(t){return this.$base.to(this.transport.child(t)),this}}class B{constructor(t,e,r){this.$base=t,this.errorMessage=e,this.errorOriginal=r,c(t,"Catch: base"),p(e,"Catch: errorMessage"),void 0!==r&&p(r,"Catch: errorOriginal")}to(t){try{this.$base.to(t)}catch(t){t instanceof Error?this.errorMessage.use(t.message):this.errorMessage.use(String(t)),this.errorOriginal&&this.errorOriginal.use(t)}return this}}var N=Object.defineProperty,_=(t,e,r)=>((t,e,r)=>e in t?N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class q{constructor(...t){_(this,"$messages"),_(this,"$latest"),_(this,"handleMessage",((t,e)=>{const r=this.$messages[t],s=this.$messages[t+1];r.to(this.oneMessageTransport.child(e,s,t))})),_(this,"oneMessageTransport",$((function(t,e,r,s){r||(e.$latest=t),e.$latest&&this.use(e.$latest),r&&!e.$latest&&e.handleMessage(s+1,this)}),this)),this.$messages=t}to(t){return this.handleMessage(0,t),this}}class W{constructor(t,e){this.$base=t,this.applier=e,c(t,"ExecutorApplied: base")}to(t){const e=this.applier(t.use.bind(t));return this.$base.to(y(e)),this}}var G=Object.defineProperty,H=(t,e,r)=>((t,e,r)=>e in t?G(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class J{constructor(t,e,r){this.$base=t,this.predicate=e,this.defaultValue=r,H(this,"parent",$((function(t,e){e.predicate(t)?this.use(t):void 0!==e.defaultValue&&this.use(e.defaultValue)}),this))}to(t){return this.$base.to(this.parent.child(t)),this}}var K=Object.defineProperty,Q=(t,e,r)=>((t,e,r)=>e in t?K(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class U{constructor(t,e,r,s){this.$emitter=t,this.$eventName=e,this.$subscribeMethod=r,this.$unsubscribeMethod=s,Q(this,"lastTransport",null),Q(this,"handler",(t=>{this.lastTransport&&this.lastTransport.use(t)})),Q(this,"parent",$((function([t,e,r],s){s.lastTransport=this,t?.[r]&&t[r](e,s.handler)}),this))}to(t){return C(this.$emitter,this.$eventName,this.$subscribeMethod).to(this.parent.child(t)),this}destroy(){return this.lastTransport=null,this.$unsubscribeMethod?(C(this.$emitter,this.$eventName,this.$unsubscribeMethod).to(y((([t,e,r])=>{t?.[r]?.(e,this.handler)}))),this):this}}class X{constructor(t,e){this.p=t,this.error=e}to(t){return this.p.then((e=>{t.use(e)})).catch((t=>{this.error?.use(t)})),this}}var Y=Object.defineProperty,Z=(t,e,r)=>((t,e,r)=>e in t?Y(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function tt(t){return new et(t)}class et{constructor(t){this.v=t,Z(this,"lateTransport",null),Z(this,"notify",(t=>{e(t)&&this.lateTransport&&this.lateTransport.use(t)}))}to(t){if(this.lateTransport)throw new Error("Late component gets new transport, when another was already connected!");return this.lateTransport=t,this.notify(this.v),this}use(t){return this.notify(t),this}}var rt=Object.defineProperty,st=(t,e,r)=>((t,e,r)=>e in t?rt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function nt(t){return new it(t)}class it{constructor(t){this.$base=t,st(this,"isFilled",!1),st(this,"parent",$((function(t,e){e.isFilled||(e.isFilled=!0,this.use(t))}),this))}to(t){return this.$base.to(this.parent.child(t)),this}}var ot=Object.defineProperty,at=(t,e,r)=>((t,e,r)=>e in t?ot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class ut{constructor(){at(this,"transports"),at(this,"innerTransport"),this.transports=new Set,this.innerTransport=y((t=>{this.transports.forEach((e=>{n(e)&&e.destroyed()?this.transports.delete(e):e.use(t)}))}))}transport(){return this.innerTransport}size(){return this.transports.size}has(t){return this.transports.has(t)}add(t){return this.transports.add(t),this}remove(t){return this.transports.delete(t),this}destroy(){return this.transports.forEach((t=>{this.remove(t)})),this}}var ht=Object.defineProperty,lt=(t,e,r)=>((t,e,r)=>e in t?ht(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function ct(t,e=!1){return new pt(t,e)}class pt{constructor(t,e=!1){this.$base=t,this.stateless=e,lt(this,"transportPool",new ut),lt(this,"lastValue"),lt(this,"calls",tt()),lt(this,"firstCallTransport",y((t=>{this.lastValue=t,this.transportPool.transport().use(t)}))),nt(this.calls).to(y((()=>{this.$base.to(this.firstCallTransport)})))}to(t){return this.calls.use(1),this.stateless||!e(this.lastValue)||this.transportPool.has(t)||t.use(this.lastValue),this.transportPool.add(t),this}use(t){return this.calls.use(1),this.lastValue=t,this.transportPool.transport().use(t),this}touched(){this.calls.use(1)}pool(){return this.transportPool}destroy(){return this.transportPool.destroy()}}var bt=Object.defineProperty,ft=(t,e,r)=>((t,e,r)=>e in t?bt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);function dt(t,e=!1){return new mt(t,e)}class mt{constructor(t,e=!1){this.$base=t,ft(this,"$sharedBase"),this.$sharedBase=ct(this.$base,e)}to(t){return this.$sharedBase.to(t),this}use(t){return this.$sharedBase.touched(),this.$base.use(t),this}}var yt=Object.defineProperty,wt=(t,e,r)=>((t,e,r)=>e in t?yt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);function gt(t,e=null){return new $t(t,e)}class $t{constructor(t,e=null){this.$base=t,this.theValue=e,wt(this,"touched",!1)}ensureTouched(){this.touched||this.$base.to(y((t=>{this.theValue=t}))),this.touched=!0}[Symbol.toPrimitive](){return this.ensureTouched(),this.theValue}primitive(){return this.ensureTouched(),this.theValue}primitiveWithException(){if(this.ensureTouched(),null===this.theValue)throw new Error("Primitive value is null");return this.theValue}}var vt=Object.defineProperty,Tt=(t,e,r)=>((t,e,r)=>e in t?vt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function Pt(t){return new It(t)}class It{constructor(t){Tt(this,"$msg"),Tt(this,"primitive"),this.$msg=dt(tt(t)),this.primitive=gt(this,t)}to(t){return this.$msg.to(t),this}use(t){return this.$msg.use(t),this}value(){return this.primitive}}var Ot=Object.defineProperty,jt=(t,e,r)=>((t,e,r)=>e in t?Ot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class Mt{constructor(t,e){this.$base=t,this.$target=e,jt(this,"parent",$((function(t,e){const s=[];t.forEach((t=>{let n=t;r(n)||(n=O(n));const i=e.$target.use(n);s.push(i)})),C(...s).to(this)}),this))}to(t){return this.$base.to(this.parent.child(t)),this}}var Et=Object.defineProperty,xt=(t,e,r)=>((t,e,r)=>e in t?Et(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);function At(t){return new Ct(t)}At.transport={};class Ct{constructor(t){this.$rpc=t,xt(this,"$result",Pt()),xt(this,"$error",Pt())}result(){return this.$rpc.to(y((t=>{const e=void 0===t.transport?At.transport.default:At.transport[t.transport]||At.transport.default;if(!e)throw new Error(`RPCImpl: Transport not found ${t.transport}`);t.result||(t.result=this.$result),t.error||(t.error=this.$error),e.use(t)}))),this.$result}error(){return this.$error}}var St=Object.defineProperty,Vt=(t,e,r)=>((t,e,r)=>e in t?St(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r);class Dt{constructor(t){this.$base=t,Vt(this,"result",[]),Vt(this,"parent",$((function(t,e){e.result.push(t),this.use(e.result)}),this))}to(t){return this.$base.to(this.parent.child(t)),this}}var Ft=Object.defineProperty,Lt=(t,e,r)=>((t,e,r)=>e in t?Ft(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class zt{constructor(t){this.$base=t,Lt(this,"parent",$((function(t){t.forEach((t=>{this.use(t)}))})))}to(t){return this.$base.to(this.parent.child(t)),this}}class Rt{constructor(t,e){this.baseTransport=t,this.applier=e}use(t){return this.applier(this.baseTransport.use(t))}}class kt{constructor(t,e,r=0){this.baseTransport=t,this.args=e,this.startFromArgIndex=r}use(t){return this.baseTransport.use(function(t,e,r){const s=t.slice(0,r);for(;s.length<r;)s.push(void 0);return s.concat(e)}(t,this.args,this.startFromArgIndex))}}var Bt=Object.defineProperty,Nt=(t,e,r)=>((t,e,r)=>e in t?Bt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,e+"",r);class _t{constructor(t){this.baseTransport=t,Nt(this,"destructors",[])}use(t){const e=this.baseTransport.use(t);return s(e)&&this.destructors.push(e),e}destroy(){return this.destructors.forEach((t=>t.destroy())),this}}return t.All=C,t.AllImpl=S,t.Any=function(...t){return new F(...t)},t.AnyImpl=F,t.Applied=R,t.AppliedDestructured=function(t,e){return R(t,(t=>e(...t)))},t.AppliedImpl=k,t.Catch=function(t,e,r){return new B(t,e,r)},t.CatchImpl=B,t.Chain=function(...t){return new q(...t)},t.ChainImpl=q,t.DestroyContainer=function(){return new h},t.DestroyContainerImpl=h,t.Destroyable=function(t){return new o(t)},t.DestroyableImpl=o,t.ExecutorApplied=function(t,e){return new W(t,e)},t.ExecutorAppliedImpl=W,t.Filtered=function(t,e,r){return new J(t,e,r)},t.FilteredImpl=J,t.FromEvent=function(t,e,r,s){return new U(t,e,r,s)},t.FromEventImpl=U,t.FromPromise=function(t,e){return new X(t,e)},t.FromPromiseImpl=X,t.Late=tt,t.LateImpl=et,t.LateShared=Pt,t.LateSharedImpl=It,t.Local=function(t){return new I(t)},t.LocalImpl=I,t.Map=function(t,e){return new Mt(t,e)},t.MapImpl=Mt,t.Message=d,t.MessageImpl=m,t.New=function(t){return d((e=>{e.use(t())}))},t.Of=O,t.OfImpl=j,t.Once=nt,t.OnceImpl=it,t.Primitive=gt,t.PrimitiveImpl=$t,t.RPC=At,t.RPCChain=function(t){return y((e=>{if(!e.result)throw new Error("RPCChain did not find result in rpc message");t.to(e.result)}))},t.RPCImpl=Ct,t.RPCOf=function(t){const e=Pt();return At.transport[t]=e,d((t=>{e.to(t)}))},t.Sequence=function(t){return new Dt(t)},t.SequenceImpl=Dt,t.Shared=ct,t.SharedImpl=pt,t.SharedSource=dt,t.SharedSourceImpl=mt,t.Stream=function(t){return new zt(t)},t.StreamImpl=zt,t.Transport=y,t.TransportApplied=function(t,e){return new Rt(t,e)},t.TransportAppliedImpl=Rt,t.TransportArgs=function(t,e,r=0){return new kt(t,e,r)},t.TransportArgsImpl=kt,t.TransportDestroyable=function(t){return new _t(t)},t.TransportDestroyableImpl=_t,t.TransportImpl=w,t.TransportMessage=function(t){return new g(t)},t.TransportMessageImpl=g,t.TransportOptional=function(t){return new M(t)},t.TransportOptionalImpl=M,t.TransportParent=$,t.TransportParentImpl=v,t.TransportPool=ut,t.Void=function(){return new E},t.VoidImpl=E,t.ensureFunction=l,t.ensureMessage=c,t.ensureTransport=p,t.isDestroyable=s,t.isDestroyed=n,t.isFilled=e,t.isMessage=r,t.isTransport=i,t}({});
